<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HP goes FE</title>
  
  
  <link href="http://hikerpig.github.io/atom.xml" rel="self"/>
  
  <link href="http://hikerpig.github.io/"/>
  <updated>2020-10-16T13:22:11.675Z</updated>
  <id>http://hikerpig.github.io/</id>
  
  <author>
    <name>Hikerpig</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä½¿ç”¨ zimfw ä½œä¸º zsh é…ç½®æ¡†æ¶</title>
    <link href="http://hikerpig.github.io/2020/10/14/2020-10-14-zsh-zimfw-setup/"/>
    <id>http://hikerpig.github.io/2020/10/14/2020-10-14-zsh-zimfw-setup/</id>
    <published>2020-10-13T16:00:00.000Z</published>
    <updated>2020-10-16T13:22:11.675Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ä½¿ç”¨ oh-my-zsh çš„è‡ªå¸¦ git/nvm ç­‰æ’ä»¶æœ‰æ—¶å€™æœ‰æ€§èƒ½é—®é¢˜ï¼ŒåŒæ—¶æ®è¯´å…¶æ¡†æ¶æœ¬èº«ç›¸æ¯”å…¶ä»–ä¸€äº›ä¸»æ‰“é€Ÿåº¦çš„é…ç½®æ¡†æ¶(prezto/zimfw ç­‰)ä¹Ÿä¼šæ…¢ä¸€ç‚¹ã€‚</p><p>ç¨å¾®æŠ˜è…¾äº†ä¸€ä¸‹ï¼Œä½¿ç”¨ <a href="https://github.com/zimfw/zimfw">zimfw</a> ä½œä¸º zsh é…ç½®æ¡†æ¶ï¼Œå®ƒåœ¨<a href="https://github.com/zimfw/zimfw/wiki/Speed">é€Ÿåº¦</a>å’Œå¯é…ç½®æ€§é—´è¾¾åˆ°äº†å¾ˆå¥½çš„å¹³è¡¡ã€‚</p><p>ä¸ªäººåˆ‡æ¢åï¼Œè¯•äº†ä¸‹è·‘ zprofï¼Œå¯åŠ¨æ—¶é—´åªæœ‰åŸå…ˆçš„ä¸€åŠï¼Œåº¦é‡æ–¹å¼å‚è€ƒ <a href="https://stevenvanbael.com/profiling-zsh-startup">Profiling zsh startup time</a>ã€‚</p><h2 id="æ’ä»¶åŠ è½½">æ’ä»¶åŠ è½½</h2><p>ç”¨ä¸Š<a href="https://github.com/zimfw/zimfw/wiki/Modules">è‡ªå¸¦çš„æ¨¡å—</a>å’Œ<a href="https://github.com/zsh-users/">zsh-users</a>é‡Œä¸€äº›ä¼˜ç§€çš„æ’ä»¶ï¼Œå°±å·²ç»æœ‰å¾ˆå¥½çš„è¡¨ç°ï¼Œå…¶ä¸­ zsh-users/zsh-autosuggestions å’Œ zsh-users/zsh-syntax-highlighting èƒ½è®© zsh ä¹Ÿæœ‰ç±»ä¼¼äº fish ä¸€æ ·å‹å¥½çš„ä»£ç é«˜äº®åé¦ˆå’Œè¾“å…¥è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚zimfw æ¯”è¾ƒå‹å¥½çš„ä¸€ç‚¹å°±åœ¨äºé»˜è®¤é…ç½®ï¼ˆä½¿ç”¨å…¶æä¾›çš„å®‰è£…è„šæœ¬ï¼‰é‡Œç»™å‡ºçš„ç»„åˆå°±å·²ç»å¾ˆæ£’äº†ã€‚</p><p>æ·»åŠ æ’ä»¶çš„æ–¹å¼ä¸ oh-my-zsh ä¸å¤ªä¸€æ ·ï¼Œåè€…éœ€è¦æŠŠæ’ä»¶æ·»åŠ åˆ°æŒ‡å®šçš„ plugins ç›®å½•ï¼ˆä¸€èˆ¬ä¸º clone repo æˆ–è€…æ‹·è´æ–‡ä»¶ï¼‰ï¼Œç„¶ååœ¨ <code>.zshrc</code> æ–‡ä»¶é‡Œ <code>plugins=()</code> æ•°ç»„é‡Œæ·»åŠ æ’ä»¶åã€‚</p><p>è€Œ zimfw çš„æ–¹å¼åˆ™ç¨å¾®æ–¹ä¾¿ä¸€ç‚¹ï¼Œé™¤äº†ç±»ä¼¼åè€…çš„æ–¹å¼å¤–ï¼Œè¿˜å¯ä»¥ä¸ç”¨æ‰‹åŠ¨æ“ä½œç›®å½•è€Œæ˜¯åœ¨ <code>.zimrc</code> æ–‡ä»¶ä¸­æ·»åŠ æ¨¡å—åï¼ˆä¸€èˆ¬ä¸º github ä¸Šçš„ user/repo åï¼‰ï¼Œå¯åœ¨ <a href="https://github.com/unixorn/awesome-zsh-plugins">awesome-zsh-plugins</a> é‡Œå¯»æ‰¾åˆé€‚æ’ä»¶ï¼Œå¤šæ•°ä¸é…ç½®æ¡†æ¶æ— å…³(å¯ä»¥ä¸å±€é™åœ¨ oh-my-zsh æä¾›çš„æ’ä»¶ç›®å½•é‡Œ)ã€‚</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿ç”¨å‘½ä»¤ <code>zimfw install</code> ä¸‹è½½å¹¶ç¼–è¯‘æ’ä»¶(ä¼šä½¿ç”¨ zsh builtin çš„ <code>zcompile</code> å°† <code>.zsh</code> æ–‡ä»¶ç¼–è¯‘ä¸º <code>.zwc</code> å­—èŠ‚ç ï¼Œæé«˜ä¸‹æ¬¡åŠ è½½çš„é€Ÿåº¦)ï¼Œæ‰“å¼€æ–° shell æ—¶æ–°æ’ä»¶ç”Ÿæ•ˆã€‚</p><h2 id="å¤–è§‚å’Œä¸»é¢˜">å¤–è§‚å’Œä¸»é¢˜</h2><p>zimfw çš„ä¸»é¢˜è¿œä¸å¦‚ oh-my-zsh ä¸°å¯Œï¼Œè‡ªå·±çš„ gallery é‡Œéƒ½æ˜¯åå‘æç®€çš„é£æ ¼ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥è‡ªå·±æ‰¾ä¸€äº›æˆç†Ÿçš„ä¸»é¢˜ <a href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a> ä½¿ç”¨ï¼Œå¸¦æœ‰é—®ç­”å¼çš„æ–°æ‰‹é…ç½®æŒ‡å¯¼ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œæ¨èä½¿ç”¨ã€‚</p><h2 id="ä¸€äº›é…ç½®">ä¸€äº›é…ç½®</h2><p><code>~/.zimrc</code></p><figure class="highlight zsh"><table><tr><td class="code"><pre><code class="hljs zsh"><span class="hljs-comment"># Start configuration added by Zim install &#123;&#123;&#123;</span><br><span class="hljs-comment"># -------</span><br><span class="hljs-comment"># Modules</span><br><span class="hljs-comment"># -------</span><br><span class="hljs-comment"># Sets sane Zsh built-in environment options.</span><br>zmodule environment<br><span class="hljs-comment"># Applies correct bindkeys for input events.</span><br>zmodule input<br><span class="hljs-comment"># Sets a custom terminal title.</span><br>zmodule termtitle<br><span class="hljs-comment"># Utility aliases and functions. Adds colour to ls, grep and less.</span><br>zmodule utility<br>zmodule directory<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Prompt</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Exposes git repository status information to prompts.</span><br>zmodule git-info<br><br><span class="hljs-comment"># Theme</span><br>zmodule romkatv/powerlevel10k<br><br><span class="hljs-comment"># Additional completion definitions for Zsh.</span><br>zmodule zsh-users/zsh-completions<br><span class="hljs-comment"># Enables and configures smart and extensive tab completion.</span><br><span class="hljs-comment"># completion must be sourced after zsh-users/zsh-completions</span><br>zmodule completion<br><span class="hljs-comment"># Fish-like autosuggestions for Zsh.</span><br>zmodule zsh-users/zsh-autosuggestions<br><span class="hljs-comment"># Fish-like syntax highlighting for Zsh.</span><br><span class="hljs-comment"># zsh-users/zsh-syntax-highlighting must be sourced after completion</span><br>zmodule zsh-users/zsh-syntax-highlighting<br><span class="hljs-comment"># Fish-like history search (up arrow) for Zsh.</span><br><span class="hljs-comment"># zsh-users/zsh-history-substring-search must be sourced after zsh-users/zsh-syntax-highlighting</span><br>zmodule zsh-users/zsh-history-substring-search<br><span class="hljs-comment"># &#125;&#125;&#125; End configuration added by Zim install</span><br><br><span class="hljs-comment"># Custom ä¸ªäººæ¨èçš„æ’ä»¶</span><br>zmodule DarrinTisdale/zsh-aliases-exa<br>zmodule zsh-users/zaw<br>zmodule wookayin/fzf-fasd<br></code></pre></td></tr></table></figure><p>ä»‹ç»ä¸€äº›ç¨‹åºå’Œæ’ä»¶:</p><ul><li><a href="https://segmentfault.com/a/1190000011327993">å¿«é€Ÿè·³è½¬å·¥å…·--FASD ç®€å•ä»‹ç»</a></li></ul><h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://www.jkg.tw/p2876/">æ‰“é€ å±¬æ–¼ä½ è‡ªå·±çš„æ¥µé€Ÿ Shellã€ŒiTerm + zsh + zim + powerlevel10kã€</a></li><li><a href="https://htr3n.github.io/2018/07/faster-zsh">Faster and enjoyable ZSH</a></li><li><a href="https://blog.spencerwoo.com/2020/07/remove-nvm-to-speed-up-zsh/">Quit using nvmï¼šå¿«åˆ æ‰è¿™ä¸ªå æ® Zsh å¯åŠ¨æ—¶é—´ä¸€åŠçš„æ€ªç‰©ï¼ - Spencer's Blog</a></li></ul>]]></content>
    
    
    <summary type="html">ä½¿ç”¨ zimfw æ›¿æ¢ oh-my-zshï¼Œæå‡ zsh å¯åŠ¨é€Ÿåº¦</summary>
    
    
    
    <category term="å·¥å…·" scheme="http://hikerpig.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="æŠ˜è…¾" scheme="http://hikerpig.github.io/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="zsh" scheme="http://hikerpig.github.io/tags/zsh/"/>
    
  </entry>
  
  <entry>
    <title>Hiding My Heart ğŸµ</title>
    <link href="http://hikerpig.github.io/2020/09/04/2020-09-04-Hiding-My-Heart/"/>
    <id>http://hikerpig.github.io/2020/09/04/2020-09-04-Hiding-My-Heart/</id>
    <published>2020-09-03T16:00:00.000Z</published>
    <updated>2020-09-15T03:03:59.654Z</updated>
    
    <content type="html"><![CDATA[<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=16783834&amp;auto=0&amp;height=66"></iframe><p>ä¸€é¦–è¯æ›²åˆ›ä½œå’Œæ¼”å”±éƒ½å¾ˆä¼˜ç§€çš„ä¹¡è°£ï¼Œå‡ºè‡ª Brandi Carlile 2007 å¹´çš„ä¸“è¾‘ <em><a href="https://music.douban.com/subject/2011571/">The Story</a></em> ã€‚</p><figure><img src="https://upload.wikimedia.org/wikipedia/en/0/01/Brandi_Carlile_-_The_Story.jpg" alt="" /><figcaption>The Story</figcaption></figure><p>è¯æ›²éƒ½ç”± Tim Hanseroth<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> (Timothy Jay Hanseroth) æ‰€åšï¼Œä»–æ˜¯ä¸ Brandi Carlile å¸¸å¹´åˆä½œçš„åŒèƒèƒå…„å¼Ÿä¹‹ä¸€ã€‚å…„å¼Ÿ Phil æ˜¯ä¸“è¾‘åŒåæ›² The Story çš„ä½œè€…ï¼Œè¿˜å’Œ Brandi çš„å¦¹å¦¹ç»“äº†å©š ğŸ¤£ã€‚</p><p>C å¤§è°ƒçš„å’Œå¼¦å’ŒæŒ‡æ³•å¾ˆç®€å•ï¼Œå¯¹åˆå­¦è€…ååˆ†å‹å¥½ï¼ˆç”šè‡³èƒ½æŠŠè°±å®Œæ•´èƒŒä¸‹æ¥ï¼‰ã€‚æ²¡æœ‰ç”¨å°è°ƒï¼Œæ²¡æœ‰å¤æ‚çš„ç¼–æ›²å’ŒèŠ‚å¥ï¼Œä¸»å”±çš„éŸ³è‰²å’Œæ¼”å”±éƒ½å¾ˆç›´ç‡å’ŒçœŸè¯šï¼Œå› æ­¤ "So I'll spend my whole life hiding my heart away" è¿™ä¸€å¥çœ‹ç€å¾ˆçŸ«æƒ…çš„æ­Œè¯ï¼Œå¬èµ·æ¥å€’æ˜¯ä¹Ÿè¿˜å¥½ã€‚</p><p>OneDrive çš„åµŒå…¥ç»„ä»¶è¿˜æŒºå¥½ç”¨çš„ï¼Œæ¥ä¸€ä¸ªåœ¨çº¿ç‰ˆ:</p><iframe src="https://onedrive.live.com/embed?cid=5849D27F393060A3&amp;resid=5849D27F393060A3%211962&amp;authkey=AOxj110SpoYOMsk&amp;em=2" width="476" height="800" frameborder="0" scrolling="no" seamless></iframe><h2 id="å…¶ä»–ç‰ˆæœ¬">å…¶ä»–ç‰ˆæœ¬</h2><p>2017 å¹´çš„ï¼Œè¯¥ä¸“è¾‘åå‘¨å¹´æ—¶ï¼Œä¸ºç»™æˆ˜äº‰å—ç¾å„¿ç«¥ç­¹æ¬¾ï¼Œå‘å¸ƒäº†çºªå¿µæ…ˆå–„ä¸“è¾‘ï¼Œé‡Œé¢æ”¶å½•äº†ä¸åŒæ­Œæ‰‹ç¿»å”±çš„æ­¤ä¸“è¾‘æ›²ç›®ã€‚ <a href="https://music.163.com/#/song?id=476553241">Adele ç¿»å”±äº†è¿™é¦–æ­Œ</a>ï¼ŒèŠ‚å¥æ›´ä¸ºç¼“æ…¢ï¼Œå‡¸æ˜¾å‡ºé˜¿å‘†é†‡åšä¸°å¯Œçš„å—“éŸ³ã€‚æœ‰è¶£çš„æ˜¯è¿™ç‰ˆçš„æ­Œè¯ä¸»è¯­å¯¹æ¢äº†ï¼ŒåŸæ›²ä»æ­Œè¯çœ‹æ¥ï¼Œæ˜¯ç”·ç”Ÿå†™ç»™æ›¾åœ¨å®¶ä¹¡çš„æ‹äººï¼Œè€Œåå¥³ç”Ÿå»å¾€å¤§éƒ½å¸‚ï¼Œå› æ­¤äºŒäººåˆ†å¼€äº†ï¼Œè€Œ Adele ç‰ˆçš„æ­Œè¯åˆ™æ˜¯ä»¥å¥³ç”Ÿä½œä¸ºä¸»ä½“ï¼Œå½“ç„¶äº†ï¼Œåªæœ‰ You å’Œ I çš„å¯¹æ¢ï¼Œå¹¶æ²¡æœ‰æ›´æ”¹å…¶ä»–çš„æ­Œè¯ã€‚</p><p>æ˜¯å•å‰ä»–ä¼´å¥ï¼Œä¸è¿‡èŠ‚å¥å‹åŠ å…¥äº†ä¸€äº›èŠ±æ ·ï¼Œä¸ä¼šæ˜¾å¾—å•è°ƒï¼Œä½†å¦‚æœæ˜¯è‡ªå¼¹è‡ªå”±ç”¨è¿™ä¸ªè°±ï¼Œè®°è°±å’Œç»ƒä¹ å¯èƒ½è¦å¤šèŠ±ä¸€ç‚¹ç‚¹æ—¶é—´ã€‚</p><h2 id="å‰ä»–è°±ä¸‹è½½">å‰ä»–è°±ä¸‹è½½</h2><ul><li>GuitarPro ç‰ˆï¼Œ <a href="https://tabs.ultimate-guitar.com/tab/brandi-carlile/hiding-my-heart-guitar-pro-837015">HIDING MY HEART INTERACTIVE TAB by Brandi Carlile for guitar and piano @ Ultimate-Guitar.Com</a></li><li>TXT ç‰ˆï¼Œ<a href="https://tabs.ultimate-guitar.com/tab/adele/hiding-my-heart-guitar-pro-1510524">HIDING MY HEART INTERACTIVE TAB by Adele @ Ultimate-Guitar.Com</a></li><li>GuitarPro ç‰ˆï¼Œ<a href="https://tabs.ultimate-guitar.com/tab/adele/hiding-my-heart-chords-1053930">HIDING MY HEART CHORDS (ver 2) by Adele @ Ultimate-Guitar.Com</a></li></ul><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p><a href="https://secondhandsongs.com/artist/90359">Songs written by Tim Hanseroth | SecondHandSongs</a><a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li></ol></section>]]></content>
    
    
      
      
    <summary type="html">&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=&quot;330&quot; height=&quot;86&quot; src=&quot;//music.163.com/outchain/player?type=2&amp;amp</summary>
      
    
    
    
    <category term="æ‚è®°" scheme="http://hikerpig.github.io/categories/%E6%9D%82%E8%AE%B0/"/>
    
    
    <category term="å‰ä»–" scheme="http://hikerpig.github.io/tags/%E5%90%89%E4%BB%96/"/>
    
    <category term="éŸ³ä¹" scheme="http://hikerpig.github.io/tags/%E9%9F%B3%E4%B9%90/"/>
    
  </entry>
  
  <entry>
    <title>Mermaid.js - ä¸€ä¸ªåˆšåˆšå¥½çš„å¼€æºäº§å“</title>
    <link href="http://hikerpig.github.io/2020/08/28/2020-08-28-Mermaid.js-as-a-nice-product/"/>
    <id>http://hikerpig.github.io/2020/08/28/2020-08-28-Mermaid.js-as-a-nice-product/</id>
    <published>2020-08-27T16:00:00.000Z</published>
    <updated>2020-09-15T03:13:29.806Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://mermaid-js.github.io/mermaid/">Mermaid.js</a> å‡­å€Ÿä¸€å·±ä¹‹åŠ›ï¼Œæå‡äº†æŠ€æœ¯åšå®¢å†…çš„æ—¶åºå›¾/ç±»å›¾ç­‰ UML å›¾è¡¨çš„è¦†ç›–ç‡ã€‚</p><p>æ–‡æ¡£é‡Œè¿™å¥è¯é“å‡ºäº†è¿™ä¸ªé¡¹ç›®çš„å­˜åœ¨æ„ä¹‰ï¼š</p><blockquote><p>There is no explanation like a Good Diagram - ä¸€å›¾èƒœåƒè¨€</p></blockquote><p>åœ¨ Web æŠ€æœ¯å¤§è¡Œå…¶é“çš„ä»Šå¤©ï¼ŒElectron èš•é£Ÿä¼ ç»Ÿæ¡Œé¢å®¢æˆ·ç«¯æŠ€æœ¯çš„å¸‚åœºã€‚ä½¿ç”¨ JavaScript å†™å°±çš„ Mermaid.js ç›®å‰å·²æˆä¸ºå„ç§è½»é‡æŠ€æœ¯æ–‡æ¡£ç¼–è¾‘å™¨ä¸­çš„ä¸€ä¸ªäº‹å®æ ‡å‡†æ¨¡å—ã€‚</p><h2 id="ä»ä¸€ä¸ªå…¥é—¨å¼€å‘è€…å’Œä½¿ç”¨è€…è§’åº¦çœ‹è¿™ä¸ªé¡¹ç›®">ä»ä¸€ä¸ªå…¥é—¨å¼€å‘è€…å’Œä½¿ç”¨è€…è§’åº¦çœ‹è¿™ä¸ªé¡¹ç›®</h2><p>ç¬¬ä¸€ä¸ª commit æ˜¯åœ¨ <a href="https://github.com/mermaid-js/mermaid/commits/887dc488a7149cd5fcf482246c827d18ae028cf5">14 å¹´ 12æœˆ åº•</a>, ä¸€å¼€å§‹å®ç°çš„æ˜¯ sequenceDiagramã€‚</p><p>å®ƒçš„å›¾è¡¨ DSL å€Ÿé‰´äº†è®¸å¤šå¼€æºäº§å“ï¼Œä¾‹å¦‚ PlantUML / js-sequence-diagrams ç­‰ï¼Œä½†åˆæœ‰å„ç§æ”¹è¿›ï¼ˆä¾‹å¦‚æ·»åŠ å…ƒç´  <code>onclick</code> äº‹ä»¶å›è°ƒè¿™æ ·æµè§ˆå™¨ç¯å¢ƒç‰¹æœ‰çš„éœ€æ±‚ï¼‰ã€‚</p><p>Mermaid.js æœ¬èº«è¿½æ±‚ä»£ç å®ç°ä»¥åŠä½¿ç”¨ä¸Šçš„ç®€æ´æ˜“æ‡‚ã€‚ä½œè€…æœ¬äººæœ€æ—©å¼€å§‹è¿™ä¸ªå…´è¶£é¡¹ç›®æ˜¯ä¸ºäº†åšå‡ºä¸€ä¸ªæœ‰è¶£çš„äº§å“ï¼Œæ»¡è¶³å’Œè‡ªå·±ä¸€æ ·çš„äººä»¬çš„éœ€æ±‚ã€‚å¹¶ä¸æ˜¯ä¸ºäº†ç‚«æŠ€ä»¥åŠå‡èŒåŠ è–ªï¼ˆæœ‰äº› KPI é¡¹ç›®å’±ä»¬ä¹Ÿå°±ä¸è¯´ä»€ä¹ˆäº†ï¼‰ã€‚åœ¨å¼€å‘æ–¹å‘å’ŒæŠ€æœ¯æ ˆçš„é€‰æ‹©ä¸Šï¼Œå¹¶æ²¡æœ‰é™·å…¥å‰ç«¯åœˆçš„æ—¶é«¦é£æ½®é™·é˜±ï¼Œä¸€ç›´ä¿æŒç€â€œç®€å•èƒ½ç”¨å°±è¡Œâ€çš„å‡†åˆ™ã€‚</p><p>ç®€å•å¥½ç”¨ï¼Œæ˜¯å®ƒæˆåŠŸçš„åŸå› ã€‚</p><p>ä½œä¸ºä¸€ä¸ªæƒ³å¸®å®ƒè§£å†³å°é—®é¢˜çš„å¼€å‘è€…ï¼Œä¸éœ€è¦ç†è§£ä»€ä¹ˆå¤æ‚å®ä¼Ÿçš„åˆ†å±‚è®¾è®¡ï¼Œç…§ç€ä»£ç å…¥å£çœ‹å°±èƒ½ç†è§£å·¥ä½œåŸç†ã€‚ä½œä¸ºä¸€ä¸ªä½¿ç”¨è€…ï¼Œä¸éœ€è¦ç¹å¤çš„è®¾å®šå‚æ•°ï¼Œåªè¦ä¸€ä¸ªç®€å•çš„ <code>&lt;script&gt;</code> æ ‡ç­¾å¼•å…¥ï¼Œç„¶åè°ƒç”¨ <code>mermaid.initialize(&#123;startOnLoad:true&#125;)</code> å‡½æ•°å³å¯è§è¯æ•ˆæœã€‚</p><h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3><p>ä¸­æœŸçš„ Mermaid.js ä»£ç åˆ†å±‚å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œå®é™…ä¸Šï¼Œå›¾è¡¨å®ç°å±‚å¯¹å¸ƒå±€å’Œç»˜åˆ¶å±‚çš„è°ƒç”¨æ¯”è¾ƒç›´æ¥å’Œæ··ä¹±ï¼ŒåŸºæœ¬ä¸Šä¸€ç§å›¾è¡¨ä¸€ç§ç‰¹åŒ–ï¼ˆæ€ä¹ˆç”»çº¿ã€ç®­å¤´ç­‰ï¼‰å®ç°æ–¹å¼ã€‚</p><p><img src="https://images-hikerpig.oss-cn-beijing.aliyuncs.com/image/mermaidjs-old.svg" /></p><h3 id="ä½¿ç”¨çš„ä¸€äº›ç¬¬ä¸‰æ–¹åº“">ä½¿ç”¨çš„ä¸€äº›ç¬¬ä¸‰æ–¹åº“</h3><ul><li><a href="https://github.com/dagrejs/dagre">dagre - Graph layout for JavaScript</a>ï¼ŒåŒ…å«å¤šç§å›¾å¸ƒå±€ç®—æ³•å®ç°çš„åº“ï¼Œæœ¬èº«ä¸åŒ…å«æ¸²æŸ“å±‚ï¼Œä½†å¯é€šè¿‡ <code>dagre-d3</code> è°ƒç”¨ <code>d3.js</code> å®Œæˆç»˜åˆ¶ã€‚</li><li><a href="https://github.com/dagrejs/graphlib">graphlib</a>ï¼Œå¦‚åå­—æ‰€ç¤ºï¼Œæ˜¯ä¸€ä¸ª JavaScript å†™çš„å…³äºå›¾(Graph) çš„å·¥å…·åº“ï¼ŒåŒ…æ‹¬åŸºç¡€çš„ç”¨äºæ„å»ºå›¾çš„å¯¹è±¡æ¥å£ï¼Œä»¥åŠä¸€äº›å›¾ç®—æ³•ã€‚è¯¦æƒ…å¯è§å…¶ <a href="https://github.com/dagrejs/graphlib/wiki/API-Reference">API-Reference</a>ã€‚</li><li><a href="https://d3js.org/">D3.js</a>ï¼Œå‰ç«¯æ•°æ®å¯è§†åŒ–æ— äººä¸çŸ¥çš„åº“ï¼Œä½œè€…åœ¨å¯è§†åŒ–å’Œäº¤äº’è®¾è®¡ä¸Šæœ‰è®¸å¤šä¼˜ç§€çš„è®ºæ–‡ä»¥åŠé¡¹ç›®ã€‚Mermaid.js æœ¬èº«ç›®æ ‡ä¸æ˜¯æ•°æ®å¯è§†åŒ–ï¼Œä¸»è¦æ˜¯ç”¨ d3 å’Œä¸€äº›æ‰©å±•åº“æ¥æ“ä½œ DOMã€‚</li></ul><h2 id="è¿‘æœŸçš„å‘å±•">è¿‘æœŸçš„å‘å±•</h2><h3 id="å‘ç¤¾åŒºå¯»æ±‚å¸®åŠ©">å‘ç¤¾åŒºå¯»æ±‚å¸®åŠ©</h3><p>ä¸€å¹´å‰ï¼Œä½œè€…åœ¨ issues é‡Œå‘ç¤¾åŒºæ±‚åŠ© <a href="https://github.com/mermaid-js/mermaid/issues/866">Collaborators wanted! Â· Issue #866 Â· mermaid-js/mermaid</a>ï¼Œå°† issue åˆ†ç±» / å° bug ä¿®å¤ç­‰è½»é‡å·¥ä½œå§”æ‰˜ç»™ç¤¾åŒºçƒ­å¿ƒå¼€å‘è€…ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºäº§å“ä¸€å®šä¼šç»å†çš„é˜¶æ®µï¼Œæ¯•ç«Ÿå³ä¾¿æ­ä¸Šä½œè€…æ‰€æœ‰çš„ä¸šä½™æ—¶é—´ï¼Œä»…å‡­ä¸€ä¸ªäººè‚¯å®šæ˜¯æ— æ³•é¢å¯¹å„ç§é—®é¢˜å’Œ feature request çš„ã€‚å› æ­¤åœ¨é¡¹ç›®åå£°é¹Šèµ·ä¹‹æ—¶ï¼Œä½œè€…å¾ˆæœ‰å¿…è¦è€ƒè™‘å¦‚ä½•å»ºç«‹å‹å¥½äº’åŠ¨çš„ç¤¾åŒºï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç»™å‡º Github CONTRIBUTOR.md æŒ‡å—ã€å»ºç«‹å®æ—¶è®¨è®ºç»„ï¼ˆSlack/Gitter ä¹‹ç±»ï¼‰ã€çº¿ä¸‹åˆ†äº«ä¼šç­‰ã€‚</p><h3 id="generic-rendering-engine">Generic rendering engine</h3><p>æœ€æ—©æœ‰äººæ issue é—®æ˜¯å¦å¯ä»¥æœ‰é€šç”¨æ¸²æŸ“å¼•æ“æ¥æ»¡è¶³éå¸¸è§„ uml å›¾è¡¨çš„ç»˜åˆ¶éœ€æ±‚ï¼Œä½œè€…ä¹Ÿæ„è¯†åˆ°äº†æ¯ä¸ªå›¾è¡¨çš„ renderer é‡å¤åšä¸€äº›äº‹æƒ…ä¸”é‡å¤ä¿®ç±»ä¼¼ bug çš„ç—›è‹¦ä¹‹å¤„ï¼Œå¼€å§‹æ€è€ƒåˆç†åˆ’åˆ†é€šç”¨æ¸²æŸ“å’Œå•ç‹¬å›¾è¡¨é€»è¾‘ã€‚</p><p>2020/5/5 æå‡º isssue <a href="https://github.com/mermaid-js/mermaid/issues/1295">Create generic rendering engine</a>ï¼Œæœˆåº•å®Œæˆåˆå…¥ä¸»åˆ†æ”¯ã€‚ä¹‹åé€æ­¥ç»™ä¸»è¦å›¾è¡¨æ·»åŠ  v2 ç‰ˆæœ¬ï¼Œå¦‚ stateDiagram-v2 ä¸æ—§ç‰ˆå…±å­˜ã€‚</p><p>ä½œè€…æ˜¯ä¸ªåŠ¡å®çš„äººï¼Œå½“å‰é˜¶æ®µçš„æ¸²æŸ“å±‚å¹¶ä¸ç€æ€¥å¯¹è¿‡å»å†…éƒ¨æ¦‚å¿µæ¨å€’é‡å»ºï¼Œè€Œæ˜¯åœ¨é€æ­¥æ”¹å†™çš„ç¬¬ä¸€é˜¶æ®µï¼Œå…ˆåŒ…è£…å¥½å¯¹ dagre çš„è°ƒç”¨å’Œå¢å¼ºã€‚</p><p><img src="https://images-hikerpig.oss-cn-beijing.aliyuncs.com/image/mermaidjs-dagre-wrapper.svg" /></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;http://mermaid-js.github.io/mermaid/&quot;&gt;Mermaid.js&lt;/a&gt; å‡­å€Ÿä¸€å·±ä¹‹åŠ›ï¼Œæå‡äº†æŠ€æœ¯åšå®¢å†…çš„æ—¶åºå›¾/ç±»å›¾ç­‰ UML å›¾è¡¨çš„è¦†ç›–ç‡ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡æ¡£é‡Œè¿™å¥è¯é“å‡ºäº†è¿™ä¸ªé¡¹ç›®çš„å­˜åœ¨æ„ä¹‰ï¼š&lt;/p&gt;
&lt;blockqu</summary>
      
    
    
    
    <category term="product" scheme="http://hikerpig.github.io/categories/product/"/>
    
    
    <category term="äº§å“" scheme="http://hikerpig.github.io/tags/%E4%BA%A7%E5%93%81/"/>
    
  </entry>
  
  <entry>
    <title>Toc Bar Userscript - ä¸€ä¸ªæ˜¾ç¤ºé¡µé¢å¤§çº²çš„æ²¹çŒ´è„šæœ¬</title>
    <link href="http://hikerpig.github.io/2020/07/02/2020-07-02-Toc-Bar-Userscript/"/>
    <id>http://hikerpig.github.io/2020/07/02/2020-07-02-Toc-Bar-Userscript/</id>
    <published>2020-07-01T16:00:00.000Z</published>
    <updated>2020-07-25T08:54:13.754Z</updated>
    
    <content type="html"><![CDATA[<h1 id="toc-bar">Toc Bar</h1><p>ä¸€ä¸ªè‡ªç”¨çš„æ²¹çŒ´è„šæœ¬ï¼Œåœ¨é¡µé¢ä¸­æ’å…¥ä¸€ä¸ªæ˜¾ç¤ºå½“å‰å†…å®¹å¤§çº²çš„æµ®åŠ¨ç»„ä»¶ï¼Œå¯<a href="https://greasyfork.org/zh-CN/scripts/406337-toc-bar">å» greasyfork ä¸‹è½½</a>ã€‚</p><p>ç›®å‰é€‚é…äº†ä¸€äº›ä¸ªäººç»å¸¸è®¿é—®çš„ç½‘ç«™ï¼Œä¸»è¦é¢å‘æŠ€æœ¯é˜…è¯»ï¼ŒçŸ¥ä¹/Medium/devto/github ä¹‹ç±»ã€‚</p><h2 id="features">âœ¨Features</h2><ul><li>ä½¿ç”¨ <a href="https://tscanlin.github.io/tocbot">tocbot</a> ç”Ÿæˆ Table of Content</li><li>å¯¹ä¸€äº›é¡µé¢ä¸­ <code>h*</code> æ ‡ç­¾ä¸å¸¦ id çš„ç½‘ç«™ï¼Œç”Ÿæˆ idï¼Œä»¥å®ç°ç‚¹å‡» TOC æ ‡é¢˜è·³è½¬åˆ°å¯¹åº”å†…å®¹çš„åŠŸèƒ½</li><li>ä¸æƒ³ä½¿ç”¨çš„æ—¶å€™ï¼Œç»„ä»¶å¯ä»¥ä¸€é”®æŠ˜å ï¼Œé¿å…æŒ¡ä½æ­£åœ¨æµè§ˆçš„å†…å®¹</li></ul><h2 id="screenshots">Screenshots</h2><figure><img src="https://raw.githubusercontent.com/hikerpig/toc-bar-userscript/master/images/screenshot-2.png" alt="" /><figcaption>devto</figcaption></figure><figure><img src="https://i.loli.net/2020/07/25/i3Ub8OwqrvaGzZX.png" alt="" /><figcaption>tocbar-github.png</figcaption></figure><figure><img src="https://raw.githubusercontent.com/hikerpig/toc-bar-userscript/master/images/screenshot-1.jpg" alt="" /><figcaption>zhuanlan-sspai</figcaption></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;toc-bar&quot;&gt;Toc Bar&lt;/h1&gt;
&lt;p&gt;ä¸€ä¸ªè‡ªç”¨çš„æ²¹çŒ´è„šæœ¬ï¼Œåœ¨é¡µé¢ä¸­æ’å…¥ä¸€ä¸ªæ˜¾ç¤ºå½“å‰å†…å®¹å¤§çº²çš„æµ®åŠ¨ç»„ä»¶ï¼Œå¯&lt;a href=&quot;https://greasyfork.org/zh-CN/scripts/406337-toc-bar&quot;&gt;å» greasyfork</summary>
      
    
    
    
    <category term="ç©å…·" scheme="http://hikerpig.github.io/categories/%E7%8E%A9%E5%85%B7/"/>
    
    
    <category term="Toys" scheme="http://hikerpig.github.io/tags/Toys/"/>
    
    <category term="Userscript" scheme="http://hikerpig.github.io/tags/Userscript/"/>
    
  </entry>
  
  <entry>
    <title>å·¥ä½œå’Œä¸ªäººé¡¹ç›®ä½¿ç”¨ä¸åŒ gitconfig</title>
    <link href="http://hikerpig.github.io/2020/06/05/2020-06-05-Separate-Git-Config-By-Directories/"/>
    <id>http://hikerpig.github.io/2020/06/05/2020-06-05-Separate-Git-Config-By-Directories/</id>
    <published>2020-06-04T16:00:00.000Z</published>
    <updated>2020-06-05T12:55:55.971Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆåœ¨ <code>~/.gitconfig</code> ä¸­è®¾å®šå¦‚ä¸‹ï¼Œæ³¨æ„ gitdir åé¢çš„ <code>~/work/</code> æœ«å°¾çš„ <code>/</code> ä¸èƒ½å°‘ã€‚</p><figure class="highlight ini"><table><tr><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[includeIf &quot;gitdir:~/work/&quot;]</span><br>  <span class="hljs-attr">path</span> = ~/.gitconfig-company<br><br><span class="hljs-section">[includeIf &quot;gitdir:~/projects/&quot;]</span><br>  <span class="hljs-attr">path</span> = ~/.gitconfig-personal<br></code></pre></td></tr></table></figure><p>ç„¶åè¿™ä¸¤ä¸ªæ–‡ä»¶å°±å¯ä»¥å•ç‹¬è®¾ç½®ä¸€äº›é¡¹ç›®äº†ã€‚</p><p>ä¾‹å¦‚ ~/.gitconfig-personal æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸å·¥ä½œæ—¶ä¸åŒçš„ç”¨æˆ·è®¾ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[user]</span><br>  <span class="hljs-attr">name</span> = <span class="hljs-string">&#x27;hikerpig&#x27;</span><br>  <span class="hljs-attr">email</span> = <span class="hljs-string">&#x27;hikerpigwinnie@gmail.com&#x27;</span><br></code></pre></td></tr></table></figure><p>æœ€åå¯åœ¨æŸé¡¹ç›®è·¯å¾„ä¸‹ä½¿ç”¨ <code>git config --list --show-origin</code> éªŒè¯è®¾ç½®æ˜¯å¦æ­£ç¡®ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;é¦–å…ˆåœ¨ &lt;code&gt;~/.gitconfig&lt;/code&gt; ä¸­è®¾å®šå¦‚ä¸‹ï¼Œæ³¨æ„ gitdir åé¢çš„ &lt;code&gt;~/work/&lt;/code&gt; æœ«å°¾çš„ &lt;code&gt;/&lt;/code&gt; ä¸èƒ½å°‘ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://hikerpig.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="git" scheme="http://hikerpig.github.io/tags/git/"/>
    
    <category term="tip" scheme="http://hikerpig.github.io/tags/tip/"/>
    
  </entry>
  
  <entry>
    <title>åˆè¯† Web Audio API - æœ¯è¯­æ‰«ç›²</title>
    <link href="http://hikerpig.github.io/2020/03/16/2020-03-16-A-Glimpse-Of-Web-Audio-API/"/>
    <id>http://hikerpig.github.io/2020/03/16/2020-03-16-A-Glimpse-Of-Web-Audio-API/</id>
    <published>2020-03-15T16:00:00.000Z</published>
    <updated>2020-03-31T14:57:34.995Z</updated>
    
    <content type="html"><![CDATA[<p>Web Audio æä¾›äº†ä¸€ä¸ªåŸºäºå›¾çš„éŸ³é¢‘å¤„ç†æ„å»ºä½“ç³»ï¼Œè¿™ä¸ªç³»ç»Ÿé‡Œçš„å•å…ƒä¸ºå„ç§éŸ³é¢‘èŠ‚ç‚¹ï¼ˆAudioNodeï¼‰ï¼Œå¯æ¨¡å—åŒ–è¿æ¥ï¼ˆmodular routingï¼‰ã€‚è¿™ä¸ªä½“ç³»è¢«ä¸šç•Œå¹¿æ³›è®¤åŒå¤šå¹´ï¼Œæœ‰å¾ˆå¤šæˆç†Ÿçš„åº”ç”¨å’Œç³»ç»Ÿï¼Œä¾‹å¦‚ Apple <a href="https://developer.apple.com/documentation/coreaudio">CoreAudio</a>ï¼Œè€Œè¿™ä¸ªè®¾è®¡ç†å¿µå†å¾€ä¸Šè¿˜èƒ½è¿½æº¯åˆ° 1964 å¹´çš„ <a href="https://www.wikiwand.com/en/Moog_synthesizer">Moog</a> åˆæˆå™¨ã€‚</p><figure><img src="https://i.loli.net/2020/03/17/KnWXYecoivIxS7r.jpg" alt="" /><figcaption>A 1975 Moog Modular 55 system</figcaption></figure><p>å¦‚æœä» <a href="https://webaudio.github.io/web-audio-api">Web Audio è§„èŒƒæ–‡æ¡£</a> åˆå…¥è¿™ä¸ªé¢†åŸŸï¼Œå¯èƒ½ç†è§£èµ·æ¥æœ‰ç‚¹è´¹åŠ›ï¼Œæ¯•ç«Ÿæ–‡æ¡£ç»™å‡ºäº†å‚æ•°å’Œå®ç°ç»†èŠ‚ï¼Œå´å¹¶ä¸è§£é‡Šè¿™äº›å‘½åçš„é€»è¾‘ã€‚</p><p>çœ‹çœ‹è¿™å¼ éå¸ƒç€é»‘è¯çš„æ¨¡å—å›¾ï¼š</p><figure><img src="https://i.loli.net/2020/03/17/nX3TarNg6IMwUYe.jpg" alt="" /><figcaption>ä¸€ä¸ªéŸ³é¢‘å¤„ç†ç³»ç»Ÿå›¾</figcaption></figure><p>å¯¹ä¸€äº›åŸºç¡€æ¦‚å¿µçš„è§£é‡Šï¼ŒMDN çš„æ–‡æ¡£<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API/Basic_concepts_behind_Web_Audio_API">ã€Šç½‘é¡µéŸ³é¢‘æ¥å£çš„åŸºæœ¬æ¦‚å¿µã€‹</a>åšå¾—å¾ˆå¥½ã€‚</p><p>ä¸è¿‡ MDN çš„æ–‡æ¡£é‡Œå¯¹ä¸€äº›é¢†åŸŸçŸ¥è¯†å’Œè¡Œå†…æœ¯è¯­çš„è§£é‡Šä¹Ÿä¸å¤ªè¯¦å°½ï¼Œä»¥ä¸‹æ˜¯æˆ‘ç¢°åˆ°çš„å‡ ä¸ªåˆæ„Ÿè¿·æƒ‘ï¼Œè°ƒæŸ¥èƒŒæ™¯ä»¥åæ‰ç†è§£äº†çš„æ¦‚å¿µã€‚</p><h2 id="æ•ˆæœèŠ‚ç‚¹">æ•ˆæœèŠ‚ç‚¹</h2><h3 id="gainnode">GainNode</h3><p>è¿™æ˜¯æˆ‘ç¬¬ä¸€ä¸ªé‡è§çš„æ•ˆæœèŠ‚ç‚¹ï¼Œéœ€è¦æ”¹å˜éŸ³é‡çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸å«åš VolumeNode å‘¢ï¼Ÿç§ä»¥ä¸ºï¼ŒéŸ³é‡æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸»è§‚å’Œå¤æ‚çš„æ¦‚å¿µã€‚è€ŒéŸ³é¢‘å¤„ç†ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥çœ‹åšä¸€ä¸ªä¿¡å·å¤„ç†è¿‡ç¨‹ï¼Œæ— è®ºæ˜¯æ—©å¹´çš„æ¨¡æ‹Ÿä¿¡å·ï¼ˆç”µæµã€ç”µå‹ï¼‰ï¼Œè¿˜æ˜¯ç°åœ¨çš„æ•°å­—ä¿¡å·ï¼Œå…³æ³¨ç‚¹éƒ½åœ¨äºä¿¡å·æœ¬èº«ã€‚</p><p>Gain ä¸€èˆ¬ç¿»è¯‘ä¸ºå¢ç›Šï¼Œæ˜¯ç”µå­å­¦çš„æœ¯è¯­ï¼Œå•ç‹¬æ‹å‡ºæ¥è¯´æ²¡æœ‰æ„ä¹‰ï¼Œè¦ç»†è¯´çš„è¯æœ‰ç”µå‹å¢ç›Šã€ç”µæµå¢ç›Šã€åŠŸç‡å¢ç›Šç­‰ã€‚</p><h3 id="pannernode">PannerNode</h3><p>åˆä¸€ä¸ªçœ‹åˆ°åå­—ä¸çŸ¥é“æ˜¯åšä»€ä¹ˆçš„ä¸œè¥¿ï¼Œ pan çš„ç¿»è¯‘æ˜¯â€œå¹³åº•é”…â€ï¼Œå’Œå£°éŸ³åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ åœ¨<a href="https://www.wikiwand.com/en/Panning_(audio)">ç»´åŸºç™¾ç§‘é‡Œå…³äº Panning çš„è§£é‡Š</a>é‡Œæåˆ°ï¼š</p><blockquote><p>å£°éŸ³å¤„ç†ä¸­çš„ Panning å€Ÿç”¨äº†æ‘„åƒä¸­çš„â€œæ‘‡æ‹â€æ¦‚å¿µã€‚</p></blockquote><figure><img src="https://upload.wikimedia.org/wikipedia/commons/9/9c/Pan1.gif" alt="" /><figcaption>æ‘„å½±ä¸­çš„æ‘‡æ‹</figcaption></figure><p>ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡æ›´æ”¹å¤šä¸ªå£°é“çš„ç›¸å¯¹å¼ºåº¦ï¼Œæ¥è¥é€ å‡ºä¸€ç§éŸ³æºåœ¨ç§»åŠ¨çš„æ„Ÿè§‰ã€‚åŒæ—¶è¿™ä¸ªç§»åŠ¨çš„æ„Ÿè§‰èƒ½å¤Ÿè¥é€ å‡ºç©ºé—´æ„Ÿï¼Œæ‰€ä»¥åœ¨è§„èŒƒé‡Œè¿™ä¸ªæŠ€æœ¯ä¸â€ç©ºé—´åŒ–â€œï¼ˆSpatializationï¼‰ä¹Ÿæ”¾åœ¨ä¸€èµ·è®¨è®ºã€‚</p><h3 id="biquadfilternode">BiquadFilterNode</h3><p>åŒäºŒé˜¶æ»¤æ³¢å™¨ï¼ˆBiquad Filterï¼‰åœ¨ç”µå­å­¦é‡Œå¾ˆå¸¸ç”¨ã€‚æŒ‰ç…§ç™¾åº¦ç™¾ç§‘çš„è¯´æ³•ï¼š</p><blockquote><p>åŒäºŒé˜¶æ»¤æ³¢å™¨æ˜¯ä¼ é€’å‡½æ•°çš„åˆ†å­ã€åˆ†æ¯éƒ½æ˜¯äºŒé˜¶å¤šé¡¹å¼çš„æ»¤æ³¢å™¨ã€‚</p></blockquote><p>ç›´è§‚åœ°ä»ä½¿ç”¨è§’åº¦æ¥ç†è§£ï¼Œè¿™ä¸ªæ»¤æ³¢å™¨åœ¨ä¸¤ä¸ªä¸åŒçš„é¢‘æ®µå¯ä»¥æœ‰ä¸åŒçš„å“åº”æ¨¡å‹ï¼Œæ‰€ä»¥é€šè¿‡åˆç†é…ç½®å‚æ•°ï¼Œå¯ä»¥å¢å¼ºæˆ–è€…å‰Šå‡æŸäº›é¢‘æ®µçš„å¼ºåº¦ï¼Œå®ç°ä½é€šï¼ˆlowpassï¼‰ã€é«˜é€šï¼ˆhighpassï¼‰ã€å¸¦é€šï¼ˆbandpassï¼‰ç­‰æ•ˆæœã€‚è¯¦ç»†å“åº”æ›²çº¿å¯ä»¥å‚è€ƒä»¥ä¸‹è¿™ä¸ªä¾‹å­ï¼Œæ¥è‡ª<a href="https://webaudioapi.com/samples/frequency-response/">webaudioapi.com</a>ã€‚</p><iframe src="https://webaudioapi.com/samples/frequency-response/" height="600" class="iframe--resize-v"></iframe><!--ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½é€šæ»¤é•œçš„å“åº”æ›²çº¿ï¼š![low pass filter](https://i.loli.net/2020/03/17/jyV8N5axb1HUuA3.jpg)--><h3 id="convolvernode">ConvolverNode</h3><p><a href="https://webaudio.github.io/web-audio-api/#ConvolverNode">è§„èŒƒä¸­çš„ ConvolverNode å®šä¹‰</a>ï¼š</p><blockquote><p>The ConvolverNode interface is an AudioNode that performs a Linear Convolution on a given AudioBuffer, often used to achieve a reverb effect</p></blockquote><p>å¯¹ä¿¡å·æºå’Œæä¾›ç»™å·ç§¯å™¨çš„å†²æ¿€å“åº”ï¼ˆimpulse responseï¼Œä»¥ AudioBuffer çš„å½¢å¼æä¾›ç»™å·ç§¯å™¨ï¼Œä½œä¸ºå·ç§¯æ ¸ï¼‰åšå·ç§¯ï¼Œä¿¡å·æºå’Œå·ç§¯æ ¸éƒ½æ˜¯ç¦»æ•£å’Œçº¿æ€§çš„ã€‚ä¸€èˆ¬å¯ç”¨äºåˆ¶é€ æ··å“ï¼ˆreverbï¼Œæˆ–ç§°å›å“ï¼‰æ•ˆæœã€‚</p><p>é¦–å…ˆè¯´åˆ°<a href="https://www.wikiwand.com/zh-hans/%E5%86%B2%E6%BF%80%E5%93%8D%E5%BA%94">å†²æ¿€å“åº”</a>ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿéšç€æ—¶é—´ï¼Œå¯¹äºå•ä½è¾“å…¥ä¿¡å·ï¼ˆå³ä¸€ä¸ªè„‰å†²ï¼‰çš„å“åº”ã€‚</p><p>ä»¥ä¸‹çš„å†²æ¿€å“åº”æ¥è‡ª <a href="https://webaudioapi.com/samples/room-effects/">webaudioapi room-effects ä¾‹å­</a> é‡Œçš„ telephone æ•ˆæœã€‚å¯¹äºæ¯ä¸€ä¸ªè„‰å†²æ¥è¯´ï¼Œåœ¨å‘ç”Ÿçš„ 0.0006 ç§’å·¦å³åå¼€å§‹æœ‰å“åº”ï¼Œå¤§æ¦‚ 0.0025 ç§’ä¹‹åè¶‹äºå¹³é™ã€‚åœ¨éŸ³æ•ˆå¤„ç†ä¸­ï¼Œä¸€èˆ¬ä¼šå°†æœªç»å¤„ç†çš„å£°éŸ³ï¼ˆç§°ä½œâ€œå¹²â€å£°éŸ³ï¼Œå¯¹åº”äºé¢˜å›¾ä¸­çš„ dryï¼‰ä¸ç»è¿‡å¤„ç†è¿‡çš„å£°éŸ³ï¼ˆç§°ä½œâ€œæ¹¿â€å£°éŸ³ï¼Œå¯¹åº”äº wetï¼‰æŒ‰ç…§ä¸€å®šæ¯”ä¾‹æ··åˆï¼Œé‚£ä¹ˆåœ¨ç”µè¯çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°±èƒ½å¬åˆ°ç¨å¾®æœ‰ä¸€ç‚¹å»¶åçš„æ•ˆæœã€‚å‡å¦‚è¿™ä¸ªå»¶åçš„æ—¶é—´å†…æ›´é•¿ï¼Œå°±æœ‰å¤§çš„æˆ¿é—´é‡Œå›éŸ³çš„æ•ˆæœã€‚</p><figure><img src="https://i.loli.net/2020/03/18/CsUke2BOMqRPbQt.jpg" alt="" /><figcaption>ç”µè¯æ•ˆæœ</figcaption></figure><p>blink çš„æºç ä¸­æœ‰ä¸€æ®µå…³äº <a href="https://github.com/chromium/chromium/blob/master/third_party/blink/renderer/modules/webaudio/docs/convolver_reverb.md">convolver_reverb çš„æ–‡æ¡£</a>ï¼Œå™è¿°äº†å®ç°å·ç§¯æ··å“æ—¶å‡å°‘è®¡ç®—é‡çš„ä¸€äº›æŠ€å·§ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå†²æ¿€å“åº”æ›²çº¿ç”±éŸ³æ•ˆè®¾è®¡å¸ˆå½•åˆ¶æˆ–æ˜¯åˆ¶ä½œï¼Œå¯ä»¥å¯¼å‡ºæˆ <code>.wav</code> æ–‡ä»¶ç­‰ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Web Audio æä¾›äº†ä¸€ä¸ªåŸºäºå›¾çš„éŸ³é¢‘å¤„ç†æ„å»ºä½“ç³»ï¼Œè¿™ä¸ªç³»ç»Ÿé‡Œçš„å•å…ƒä¸ºå„ç§éŸ³é¢‘èŠ‚ç‚¹ï¼ˆAudioNodeï¼‰ï¼Œå¯æ¨¡å—åŒ–è¿æ¥ï¼ˆmodular routingï¼‰ã€‚è¿™ä¸ªä½“ç³»è¢«ä¸šç•Œå¹¿æ³›è®¤åŒå¤šå¹´ï¼Œæœ‰å¾ˆå¤šæˆç†Ÿçš„åº”ç”¨å’Œç³»ç»Ÿï¼Œä¾‹å¦‚ Apple &lt;a href=&quot;https://develo</summary>
      
    
    
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Avtech" scheme="http://hikerpig.github.io/tags/Avtech/"/>
    
    <category term="audio" scheme="http://hikerpig.github.io/tags/audio/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ¬¡ Webpack ä¸‹çš„ Vuex HMR å°è¯•</title>
    <link href="http://hikerpig.github.io/2020/03/07/2020-03-07-Vuex-Webpack-HMR/"/>
    <id>http://hikerpig.github.io/2020/03/07/2020-03-07-Vuex-Webpack-HMR/</id>
    <published>2020-03-06T16:00:00.000Z</published>
    <updated>2020-04-13T02:57:12.321Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ Webpack æ„å»º Vue é¡¹ç›®æ—¶ï¼Œå€ŸåŠ© vue-loader å’Œ vue-hot-reload-apiï¼Œæˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™å¯ä»¥è·å¾—å¾ˆå¥½çš„ç»„ä»¶çƒ­åŠ è½½ï¼ˆHot Module Replacementï¼‰ä½“éªŒã€‚ç„¶è€Œ vue-loader ä¸­å´æ²¡æœ‰å…³äº vuex çš„é…ç½®ï¼ˆå½“ç„¶è¿™ä¹Ÿçš„ç¡®ä¸æ˜¯å®ƒåº”è¯¥æ’æ‰‹çš„åœ°æ–¹ï¼‰ã€‚</p><p>å®˜æ–¹ vue-cli çš„ vuex æ’ä»¶ä¹Ÿæ²¡æœ‰ç›¸åº”æ”¯æŒï¼ˆåœ¨ cli serve ä¸‹å¦‚æœæ›´æ”¹ store æˆ–æ˜¯å…¶ä¾èµ–çš„æ¨¡å—ï¼Œé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œè¿™ä¸ªè¡Œä¸ºæ˜¯ hot reload è€Œä¸æ˜¯ HMRï¼‰ã€‚</p><p>Nuxt.js æ¡†æ¶ç§‰æ‰¿ç€ convention over configuration çš„æ€æƒ³ï¼Œåœ¨ä¸€å®šçš„ç›®å½•å’Œæ–‡ä»¶ç»“æ„çº¦å®šä¸‹ï¼Œé€šè¿‡ç›®å½•åˆ†æå’Œè„šæ‰‹æ¶æ–‡ä»¶æ¨¡æ¿ï¼Œå¾ˆå¥½åœ°è§£å†³äº† HMR çš„é—®é¢˜ï¼Œç”Ÿæˆ <code>store</code> å…¥å£æ¨¡å—çš„ç›¸å…³ä»£ç åœ¨<a href="https://github.com/nuxt/nuxt.js/blob/dev/packages/vue-app/template/store.js">è¿™é‡Œ</a>ã€‚</p><p>åœ¨ä¸ä½¿ç”¨ Nuxt çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åœ¨é¡¹ç›®ä¸­ä¿æŒä¸€å®šçš„æ¨¡å—è§„èŒƒæ¥ç®€å•å®ç° Vuex HMR çš„é…ç½®ã€‚</p><h2 id="vuex-çš„-api">Vuex çš„ API</h2><p>Vuex è‡ªèº«æ˜¯æä¾›äº† hotUpdate api ä»¥åŠ <a href="https://vuex.vuejs.org/guide/hot-reload.html">ä¸€ä¸ª HMR çš„ä»£ç ç¤ºä¾‹</a> çš„ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">module</span>.hot) &#123;<br>  <span class="hljs-comment">// accept actions and mutations as hot modules</span><br>  <span class="hljs-built_in">module</span>.hot.accept([<span class="hljs-string">&#x27;./mutations&#x27;</span>, <span class="hljs-string">&#x27;./modules/a&#x27;</span>], <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// require the updated modules</span><br>    <span class="hljs-comment">// have to add .default here due to babel 6 module output</span><br>    <span class="hljs-keyword">const</span> newMutations = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./mutations&#x27;</span>).default<br>    <span class="hljs-keyword">const</span> newModuleA = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./modules/a&#x27;</span>).default<br>    <span class="hljs-comment">// swap in the new modules and mutations</span><br>    store.hotUpdate(&#123;<br>      mutations: newMutations,<br>      modules: &#123;<br>        a: newModuleA<br>      &#125;<br>    &#125;)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ç¨æ˜¾ç®€å•ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šæ¯ä¸€ä¸ª submodule çš„è·¯å¾„ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2><p>å‡è®¾é¡¹ç›®ä¸­ vuex ç›¸å…³æ–‡ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ã€‚</p><figure class="highlight text"><table><tr><td class="code"><pre><code class="hljs text">src/store<br>â”œâ”€â”€ index.js<br>â””â”€â”€ modules<br>    â”œâ”€â”€ complex<br>    â”‚Â Â  â””â”€â”€ index.js<br>    â”œâ”€â”€ sub.js // ä¸€ä¸ª vuex æ¨¡å—å®šä¹‰æ–‡ä»¶<br>    â”œâ”€â”€ util.js // ä¸€ä¸ªéšæ„çš„å·¥å…·å‡½æ•°æ–‡ä»¶ï¼Œä¸å¯¼å‡º vuex æ¨¡å—å®šä¹‰ï¼Œå¹¶ä¸æ¨èè¿™æ ·ä¸ module å¹¶è¡Œçš„ç»“æ„ï¼Œä½†æˆ‘ä»¬çš„æ–¹æ¡ˆä¸ä¼šè¯¯åˆ¤ï¼Œè¯¦æƒ…è¯·ç»§ç»­å¾€ä¸‹çœ‹<br>    â””â”€â”€ ...<br></code></pre></td></tr></table></figure><p>å…¶ä¸­çœç•¥äº†ä¸Šä¾‹ä¸­çš„ <code>mutations</code> æ–‡ä»¶ï¼Œå°†å…¨å±€æ ¹æ¨¡å—çš„å†…å®¹éƒ½å†™åœ¨ <code>store/index.js</code> ä¸­ã€‚ <code>modules</code> æ–‡ä»¶å¤¹é‡Œå­˜æ”¾æ¨¡å—çš„å®šä¹‰å†…å®¹ã€‚</p><p>é‚£æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <a href="https://webpack.js.org/api/module-methods/#requirecontext">require.context</a> æ¥åŠ¨æ€å¾—å‡ºä¾èµ–çš„æ¨¡å—åˆ—è¡¨ã€‚</p><p>é¦–å…ˆ <code>sub.js</code> å’Œ <code>complex/index.js</code> éœ€è¦æœä»ä¸€äº›æˆ‘ä»¬é¢„è®¾çš„è§„åˆ™ï¼š</p><ol type="1"><li>vuex module å®šä¹‰æ–‡ä»¶éƒ½ä½¿ç”¨ <code>export default</code> å¯¼å‡º</li><li>å¦‚æœæ˜¯ <code>namespaced</code> æ¨¡å—ï¼Œéœ€è¦é€šè¿‡ <code>export const VUEX_NS</code> æˆ–è€…åœ¨ vuex module å®šä¹‰ä¸­æ·»åŠ ä¸€ä¸ª <code>namespace: string</code> å­—æ®µæ¥å¯¼å‡ºå‘½åç©ºé—´åã€‚</li></ol><p>ä¾‹å¦‚ sub.js æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; greet &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./util&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> VUEX_NS = <span class="hljs-string">&#x27;sub&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  namespaced: <span class="hljs-literal">true</span>,<br>  actions: &#123;<br>    test_sub_action() &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;sub v1&#x27;</span>)<br>      greet()<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ store/index.js ä¸­çš„ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> Vuex <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><br><span class="hljs-keyword">import</span> SUB, &#123; VUEX_NS <span class="hljs-keyword">as</span> SUB_VUEX_NS &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./modules/sub&#x27;</span><br><span class="hljs-keyword">import</span> COMPLEX, &#123; VUEX_NS <span class="hljs-keyword">as</span> COMPLEX_VUEX_NS &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./modules/complex&#x27;</span><br><br>Vue.use(Vuex)<br><br><span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> Vuex.Store(&#123;<br>  actions: &#123;<br>    test_action() &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;root action v1&#x27;</span>)<br>    &#125;<br>  &#125;,<br>  modules: &#123;<br>    [SUB_VUEX_NS]: SUB,<br>    [COMPLEX_VUEX_NS]: COMPLEX,<br>  &#125;<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">module</span>.hot) &#123;<br>  <span class="hljs-comment">// submodules hmr</span><br>  <span class="hljs-keyword">const</span> moduleFiles = <span class="hljs-built_in">require</span>.context(<span class="hljs-string">&#x27;./modules&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-regexp">/js$/</span>)<br>  <span class="hljs-keyword">const</span> moduleFileKeys = moduleFiles.keys().map(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> moduleFiles.resolve(k))<br><br>  <span class="hljs-built_in">module</span>.hot.accept(moduleFileKeys, <span class="hljs-function">(<span class="hljs-params">deps</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;module files update&#x27;</span>, deps)<br>    <span class="hljs-keyword">const</span> hotUpdatePayload = &#123;<br>      modules: &#123;&#125;,<br>    &#125;<br>    deps.forEach(<span class="hljs-function">(<span class="hljs-params">moduleId</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> m = __webpack_require__(moduleId)<br>      <span class="hljs-keyword">const</span> moduleDef = m.default<br>      <span class="hljs-keyword">if</span> (moduleDef &amp;&amp; (moduleDef.actions || moduleDef.mutations)) &#123;<br>        <span class="hljs-keyword">let</span> namespace = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">if</span> (moduleDef.namespaced) &#123;<br>          <span class="hljs-comment">// Guess namespace</span><br>          namespace = moduleDef.namespace || m[<span class="hljs-string">&#x27;VUEX_NS&#x27;</span>] || moduleDef[<span class="hljs-string">&#x27;namespace&#x27;</span>]<br>        &#125;<br>        <span class="hljs-keyword">if</span> (namespace) &#123;<br>          <span class="hljs-keyword">if</span> (hotUpdatePayload.modules[namespace]) &#123;<br>            <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">`Already exists module with namespace <span class="hljs-subst">$&#123;namespace&#125;</span>`</span>)<br>          &#125;<br>          <span class="hljs-built_in">Object</span>.assign(hotUpdatePayload.modules, &#123; [namespace]: moduleDef &#125;)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-built_in">Object</span>.assign(hotUpdatePayload, moduleDef)<br>        &#125;<br>      &#125;<br>    &#125;)<br><br>    store.hotUpdate(hotUpdatePayload)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ ·ä¾‹è¯´æ˜">æ ·ä¾‹è¯´æ˜</h3><p>åœ¨ä»¥ä¸Šçš„ç›®å½•ç»“æ„ä¸‹ï¼Œ<code>moduleFileKeys</code> çš„ç»“æœä¸ºï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">[<span class="hljs-string">&quot;./src/store/modules/complex/index.js&quot;</span>, <span class="hljs-string">&quot;./src/store/modules/sub.js&quot;</span>, <span class="hljs-string">&quot;./src/store/modules/util.js&quot;</span>]<br></code></pre></td></tr></table></figure><p>è¿™å…¶ä¸­ä»»ä¸€ä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œéƒ½ä¼šåœ¨ module æ›´æ–°ç»“æŸåï¼Œè¿›å…¥ç»™ <code>module.hot.accept</code> å‡½æ•°ä¼ å…¥çš„å›è°ƒå‡½æ•° <code>(deps) =&gt; &#123;...&#125;</code> ä¸­ï¼Œæ‰§è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ›´æ–°é€»è¾‘ã€‚</p><p><code>__webpack_require__</code> æ˜¯ä¸€ä¸ª webpack module ä½œç”¨åŸŸå†…ç‰¹æœ‰çš„å‡½æ•°ï¼Œæ–‡æ¡£<a href="https://webpack.js.org/api/module-variables/#__webpack_require__-webpack-specific">åœ¨æ­¤</a>ã€‚P.S. è¿™é‡Œä½¿ç”¨å®ƒï¼Œè€Œä¸æ˜¯ <code>require(moduleId)</code>ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æºæ–‡ä»¶ä¸­çš„ <code>require</code> è¯­å¥ä¼šè¢« webpack åˆ†æå¹¶åœ¨ç”Ÿæˆç›®æ ‡ä»£ç æ—¶æ”¹å†™ï¼Œä½†è‹¥å…¥å‚ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¸èƒ½è¢«é™æ€åˆ†æå‡ºå…·ä½“çš„æ¨¡å—ï¼Œåœ¨ç”Ÿæˆçš„ bundle é‡Œä¼šè¢« webpack è½¬ä¸º <code>__webpack_require__("./src/store sync recursive")(moduleId)</code>ï¼Œåœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œ<code>__webpack_require__("./src/store sync recursive")</code> è¿™å¥çš„ç»“æœæ˜¯ä¸€ä¸ª <code>webpackEmptyContext</code>ï¼Œè°ƒç”¨å®ƒä¼šæŠ›å‡º MODULE_NOT_FOUND çš„å¼‚å¸¸ã€‚</p><p>æ¥ä¸‹æ¥å…³äº moduleDef åˆ¤æ–­çš„ä»£ç å»ºç«‹åœ¨ä¹‹å‰è¯´çš„é¢„è®¾è§„åˆ™ä¸Šï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®å®é™…ä¿®æ”¹ã€‚</p><p>P.S. ç›®å‰è¿™ä¸ªæ–¹æ¡ˆæ²¡æœ‰è§£å†³ä¸¤å±‚åŠä»¥ä¸Šæ·±åº¦çš„ module æƒ…å†µï¼Œå®é™…ä½¿ç”¨ä¸­è¿™ä¸ªä¼¼ä¹ä¹Ÿä¸å¸¸è§ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä½¿ç”¨ Webpack æ„å»º Vue é¡¹ç›®æ—¶ï¼Œå€ŸåŠ© vue-loader å’Œ vue-hot-reload-apiï¼Œæˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™å¯ä»¥è·å¾—å¾ˆå¥½çš„ç»„ä»¶çƒ­åŠ è½½ï¼ˆHot Module Replacementï¼‰ä½“éªŒã€‚ç„¶è€Œ vue-loader ä¸­å´æ²¡æœ‰å…³äº vuex çš„é…ç½®ï¼ˆå½“ç„¶è¿™</summary>
      
    
    
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Engineering" scheme="http://hikerpig.github.io/tags/Engineering/"/>
    
    <category term="Vuex" scheme="http://hikerpig.github.io/tags/Vuex/"/>
    
    <category term="Webpack" scheme="http://hikerpig.github.io/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çš„å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¸…å•</title>
    <link href="http://hikerpig.github.io/2020/02/19/2020-02-19-Regex-Collection/"/>
    <id>http://hikerpig.github.io/2020/02/19/2020-02-19-Regex-Collection/</id>
    <published>2020-02-18T16:00:00.000Z</published>
    <updated>2020-02-19T02:58:08.983Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è½¬æ¢">è½¬æ¢</h2><p><a href="https://medium.com/javascript-in-plain-english/convert-string-to-different-case-styles-snake-kebab-camel-and-pascal-case-in-javascript-da724b7220d7">medium çš„ä¸€ç¯‡æ–‡ç« æœ‰åˆ—å‡ºå‡ ç§å¸¸è§å‘½åæ–¹å¼è½¬æ¢çš„ JS å‡½æ•°</a></p><h3 id="camelcase---kebab-case">CamelCase -&gt; kebab-case</h3><p>javascript ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">string.replace(<span class="hljs-regexp">/([a-z0-9]|(?=[A-Z]))([A-Z])/g</span>, <span class="hljs-string">&#x27;$1-$2&#x27;</span>).toLowerCase()<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ä½¿ç”¨äº†æ­£å‘å‰ç» (positive lookahead)ï¼Œæœ‰ä¸€äº› <a href="https://www.cnblogs.com/boundless-sky/p/7597631.html">å‚è€ƒæ–‡ç« </a> å¯ä»¥å­¦ä¹ ä¸€ä¸‹ã€‚</p><h3 id="kebab-casesnake_case---camelcase">kebab-case/snake_case -&gt; CamelCase</h3><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> toCamelCase = <span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span><br>  str<br>    .toLowerCase()<br>    .replace(<span class="hljs-regexp">/[^a-zA-Z0-9]+(.)/g</span>, <span class="hljs-function">(<span class="hljs-params">m, char</span>) =&gt;</span> char.toUpperCase())<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è½¬æ¢&quot;&gt;è½¬æ¢&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://medium.com/javascript-in-plain-english/convert-string-to-different-case-styles-snake-kebab-camel-and</summary>
      
    
    
    
    <category term="Engineering" scheme="http://hikerpig.github.io/categories/Engineering/"/>
    
    
    <category term="å·¥å…·" scheme="http://hikerpig.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="æ­£åˆ™" scheme="http://hikerpig.github.io/tags/%E6%AD%A3%E5%88%99/"/>
    
  </entry>
  
  <entry>
    <title>Awesome UltiSnips</title>
    <link href="http://hikerpig.github.io/2020/02/05/2020-02-05-Awesome-UltiSnips/"/>
    <id>http://hikerpig.github.io/2020/02/05/2020-02-05-Awesome-UltiSnips/</id>
    <published>2020-02-04T16:00:00.000Z</published>
    <updated>2020-02-10T14:11:59.801Z</updated>
    
    <content type="html"><![CDATA[<p>UltiSnips ä¸æ„§ä¸º vim ï¼ˆæˆ–ä¹ƒè‡³æ‰€æœ‰ç¼–è¾‘å™¨ï¼‰ç”Ÿæ€ä¸‹çš„æœ€ä½³ä»£ç ç‰‡æ®µè§£å†³æ–¹æ¡ˆã€‚æ”¯æŒå¤šç§å¸¸è§è¯­æ³•ã€snippet æ·»åŠ å’Œç®¡ç†ç¬¦åˆç›´è§‰ï¼ˆæ­¤å¤„åº” cue ä¸€ä¸‹éš”å£å¯¹å¤šè¡Œæ–‡æœ¬æ”¯æŒä»¤äººå‚æ³ªçš„ vscodeï¼‰ã€è¿˜æœ‰çœ¼èŠ±ç¼­ä¹±çš„ python è„šæœ¬æ’å€¼ä¾› <a href="https://github.com/honza/vim-snippets">é«˜çº§ç©å®¶</a> ä½¿ç”¨ã€‚</p><p>UltiSnips é¡¹ç›®å·²æœ‰åå¹´çš„å†å²ï¼ŒåŠŸèƒ½ä¸ºå…¶æ¨¡ä»¿å’Œè‡´æ•¬çš„ SnipMate çš„è¶…é›†ï¼ŒSnipMate æ¨¡ä»¿äº† TextMate çš„è¯­æ³•ã€‚</p><p>vscode ä¹Ÿæ¨¡ä»¿äº† TextMate snippet çš„è¯­æ³•ï¼Œä»è€Œä½¿å¾—åœ¨ ultisnips å’Œ vscode snippet è¯­æ³•ä¹‹é—´ <a href="http://unisnips.netlify.com/">è½¬æ¢</a> å˜å¾—ç›¸å¯¹å®¹æ˜“ã€‚</p><p>ä»”ç»†é˜…è¯»æ–‡æ¡£ä»¥åï¼Œå‘ç°äº†ä¸€äº›ä»¥å‰é—æ¼äº†çš„åŠŸèƒ½ã€‚</p><h2 id="snippets-æ–‡ä»¶ç»„ç»‡æ–¹å¼">snippets æ–‡ä»¶ç»„ç»‡æ–¹å¼</h2><p>å¼•è‡ªå®˜æ–¹æ–‡æ¡£ï¼š</p><figure class="highlight text"><table><tr><td class="code"><pre><code class="hljs text">Using a strategy similar to how Vim detects |ftplugins|, UltiSnips iterates<br>over the snippet definition directories looking for files with names of the<br>following patterns: ft.snippets, ft_*.snippets, or ft/*, where &quot;ft&quot; is the<br>&#x27;filetype&#x27; of the current document and &quot;*&quot; is a shell-like wildcard matching<br>any string including the empty string. The following table shows some typical<br>snippet filenames and their associated filetype.<br><br>    snippet filename         filetype ~<br>    ruby.snippets            ruby<br>    perl.snippets            perl<br>    c.snippets               c<br>    c_my.snippets            c<br>    c/a                      c<br>    c/b.snippets             c<br>    all.snippets             all<br>    all/a.snippets           all<br></code></pre></td></tr></table></figure><p>åŒä¸€è¯­è¨€çš„ snippet ä¸ç”¨éƒ½å¡åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå¯ä»¥æŒ‰ç…§ä¸»é¢˜ç»„ç»‡ã€‚</p><figure class="highlight text"><table><tr><td class="code"><pre><code class="hljs text">-- javascript<br>   |-- jest.snippets<br>   |-- vue.snippets<br>   |-- class.snippets<br></code></pre></td></tr></table></figure><h2 id="trigger-ä¸ç”¨è´¹è„‘è®°">trigger ä¸ç”¨è´¹è„‘è®°</h2><h3 id="åˆ—å‡ºå½“å‰å¯å±•å¼€çš„-snippets">åˆ—å‡ºå½“å‰å¯å±•å¼€çš„ snippets</h3><p>åœ¨ Normal æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>:call UltiSnips#ListSnippets()</code>ï¼Œè¯¥å‡½æ•°ä¼šåˆ—å‡ºå½“å‰ cursor å¤„æ‰€æœ‰æ”¯æŒçš„ snippet ï¼ˆå¦‚æœå½“å‰ cursor å¤„æ²¡æœ‰å­—ç¬¦ï¼Œåˆ—å‡ºçš„æ˜¯æ­¤æ–‡ä»¶æ‰€æœ‰æ”¯æŒçš„ snippetï¼‰ï¼Œä¸”å¯ä»¥é€šè¿‡æ•°å­—é€‰æ‹©ç›´æ¥å±•å¼€ snippet ã€‚</p><p>åœ¨ Insert æ¨¡å¼ä¸‹ï¼Œå¯è®¾ç½® <code>g:UltiSnipsListSnippets</code> ç»‘å®šæŒ‰é”®è§¦å‘ä»¥ä¸Šå‡½æ•°ï¼Œé»˜è®¤æ˜¯ <code>&lt;c-tab&gt;</code>ï¼Œåœ¨ä¸€äº› terminal è½¯ä»¶é‡Œå¯èƒ½ä¼šæœ‰æŒ‰é”®å†²çªï¼Œå¯ä»¥æ”¹æˆåˆ«çš„é”®ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim"><span class="hljs-variable">g:UltiSnipsListSnippets</span>=<span class="hljs-string">&#x27;&lt;c-u&gt;&lt;c-l&gt;&#x27;</span><br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><figure><img src="https://i.loli.net/2020/02/05/zL9IbrTyBgfQXEo.gif" alt="" /><figcaption>list snippets usage</figcaption></figure><p>ä¸è¿‡è¿™ä¸ªå‡½æ•°è°ƒç”¨çš„æ˜¯ vim çš„ <a href="https://vim-jp.org/vimdoc-en/eval.html">inputlist</a> æ¥å£ï¼Œç¨æ˜¾åŸå§‹ï¼ŒåŒæ—¶åˆ—å‡ºçš„æ•°æ®å¤ªè¿‡è¯¦å°½ï¼Œæœ‰ç‚¹å¹²æ‰°æ­£å¸¸è¾“å…¥æµã€‚å¦‚æœä¸ä»‹æ„å¤šå®‰è£…ä¸€äº›ä¸œè¥¿ï¼Œå¯ä»¥çœ‹ä¸‹ä¸€èŠ‚ã€‚</p><h3 id="ä¸-vim-çš„è‡ªåŠ¨è¡¥å…¨æ’ä»¶é…åˆ">ä¸ vim çš„è‡ªåŠ¨è¡¥å…¨æ’ä»¶é…åˆ</h3><p>æ–‡æ¡£çš„ <em>UltiSnips and Other Plugins</em> ä¸€èŠ‚åˆ—å‡ºäº†ä¸€äº›æ”¯æŒçš„è‡ªåŠ¨è¡¥å…¨æ’ä»¶ã€‚</p><blockquote><p>YouCompleteMe - comes with out of the box completion support for UltiSnips. It offers a really nice completion dialogue for snippets.</p><p>neocomplete - UltiSnips ships with a source for neocomplete and therefore offers out of the box completion dialogue support for it too.</p><p>deoplete - The successor of neocomplete is also supported.</p><p>unite - UltiSnips has a source for unite.</p></blockquote><p>æˆ‘è¯•è¿‡ deoplete ï¼Œå¼€ç®±å³ç”¨ï¼Œä½“éªŒè‰¯å¥½ã€‚ä¸è¿‡ç”±äºå…¶ä»–çš„ä¸€äº›åŸå› ï¼ŒåŒç±»å‹æ’ä»¶æˆ‘åªä½¿ç”¨äº† <a href="https://github.com/neoclide/coc.nvim">coc.nvim</a> ï¼Œå®ƒå…¶å®ä¹Ÿæœ‰å¯¹ ultisnips å¾ˆå¥½çš„æ”¯æŒï¼ˆç¿»æºç æ‰å‘ç°å®ƒç”šè‡³è¿˜ port äº†ä¸€ä¸ª vscode çš„ snippet å¼•æ“ï¼‰ã€‚</p><figure><img src="https://i.loli.net/2020/02/05/58nsKTQmfAGNVpJ.gif" alt="" /><figcaption>ultisnips with coc.nvim</figcaption></figure><h2 id="ä»¥å‰ç«¯é¡¹ç›®ä¸ºä¾‹å­å¯ä»¥ä½¿ç”¨çš„è¿›é˜¶åŠŸèƒ½">ä»¥å‰ç«¯é¡¹ç›®ä¸ºä¾‹å­ï¼Œå¯ä»¥ä½¿ç”¨çš„è¿›é˜¶åŠŸèƒ½</h2><h3 id="vim-script-code-transformation">Vim script code + Transformation</h3><p>å½¢å¼ä¸º <code>$&#123;&lt;tab_stop_no/regular_expression/replacement/options&#125;</code> çš„ Transformation éœ€è¦ä¾èµ–äºä¸€ä¸ª tabstopã€‚æ˜¯åœ¨å¼ºå¤§çš„ python script ä¹‹å¤–ï¼Œç¨å¾®ç®€å•å’Œé€šç”¨ä¸€ç‚¹çš„è½¬æ¢å½¢å¼ã€‚</p><p>ä¾‹å¦‚åœ¨ <code>test-component.vue</code> æ–‡ä»¶é‡Œï¼Œå¿«é€Ÿèµ·è‰ä¸€ä¸ª Vue SFC æ–‡ä»¶ç»“æ„ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><code class="hljs vim-snippets">snippet sfc_component &quot;setup sfc component&quot;<br>&lt;template&gt;<br>  &lt;div class&#x3D;&quot;$&#123;1:&#96;!v expand(&quot;%:r&quot;)&#96;&#125;&quot;&gt;<br>  &lt;&#x2F;div&gt;<br>&lt;&#x2F;template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &#39;$&#123;1&#x2F;[-_]?([a-z]+)&#x2F;\u$1&#x2F;g&#125;&#39;,<br>&#125;<br>&lt;&#x2F;script&gt;<br>endsnippet<br></code></pre></td></tr></table></figure><p>å±•å¼€åå†…å®¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class&#x3D;&quot;test-component&quot;&gt;<br>  &lt;&#x2F;div&gt;<br>&lt;&#x2F;template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &#39;TestComponent&#39;,<br>&#125;<br>&lt;&#x2F;script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;UltiSnips ä¸æ„§ä¸º vim ï¼ˆæˆ–ä¹ƒè‡³æ‰€æœ‰ç¼–è¾‘å™¨ï¼‰ç”Ÿæ€ä¸‹çš„æœ€ä½³ä»£ç ç‰‡æ®µè§£å†³æ–¹æ¡ˆã€‚æ”¯æŒå¤šç§å¸¸è§è¯­æ³•ã€snippet æ·»åŠ å’Œç®¡ç†ç¬¦åˆç›´è§‰ï¼ˆæ­¤å¤„åº” cue ä¸€ä¸‹éš”å£å¯¹å¤šè¡Œæ–‡æœ¬æ”¯æŒä»¤äººå‚æ³ªçš„ vscodeï¼‰ã€è¿˜æœ‰çœ¼èŠ±ç¼­ä¹±çš„ python è„šæœ¬æ’å€¼ä¾› &lt;a href=&quot;http</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://hikerpig.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="Vim" scheme="http://hikerpig.github.io/tags/Vim/"/>
    
    <category term="UltiSnips" scheme="http://hikerpig.github.io/tags/UltiSnips/"/>
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨ IndexedDB å­˜å‚¨é™åˆ¶</title>
    <link href="http://hikerpig.github.io/2019/12/11/2019-12-11-Browser-Storage-Limit/"/>
    <id>http://hikerpig.github.io/2019/12/11/2019-12-11-Browser-Storage-Limit/</id>
    <published>2019-12-10T16:00:00.000Z</published>
    <updated>2020-04-09T10:05:04.197Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹åˆ—å‡ºåœ¨ <a href="https://duomu.tv/">å¤ºç›®</a> äº§å“çš„å¼€å‘ä¸­ï¼Œå¯¹ WebStorage å’Œ IndexedDB ä½¿ç”¨çš„ä¸€äº›ç»éªŒã€‚</p><h1 id="webstorage-å­˜å‚¨ç©ºé—´é™åˆ¶">WebStorage å­˜å‚¨ç©ºé—´é™åˆ¶</h1><p>é¦–å…ˆï¼Œå­˜å‚¨åˆ†ä¸ºä¸¤ç§ï¼š</p><ol type="1"><li>ä¸´æ—¶å­˜å‚¨ (Temporary Storage)ï¼Œé»˜è®¤ç±»å‹ï¼Œä¹‹åå¯èƒ½ä¼šè¢«æµè§ˆå™¨åˆ é™¤ã€‚</li><li>æŒä¹…å­˜å‚¨ (Persistent Storage)ï¼Œä¸ä¼šè¢«æµè§ˆå™¨è‡ªåŠ¨åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/persist">StorageManager::persist()</a> æ–¹æ³•å°†<strong>æ­¤åŸŸå</strong>çš„å­˜å‚¨ç±»å‹è½¬ä¸ºæŒä¹…å‹ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šå¼¹å‡ºå¼¹çª—å¾æ±‚ç”¨æˆ·è®¸å¯ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€‰æ‹©æ‹’ç»ã€‚</li></ol><p>æ ¹æ® <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria#Storage_limits">MDN çš„æ–‡æ¡£</a>ï¼Œæµè§ˆå™¨åˆ†é…ç»™æ•°æ®å­˜å‚¨çš„ç£ç›˜ç©ºé—´å¤§å°æ˜¯åŠ¨æ€çš„ï¼Œä¼šæ ¹æ®ç£ç›˜å‰©ä½™ç©ºé—´å†³å®šï¼ŒåŒæ—¶å¯¹äºä¸€ä¸ªå…·ä½“åŸŸåä¸‹çš„ç©ºé—´åˆ†é…ä¹Ÿæœ‰ä¸€å®šç­–ç•¥ã€‚</p><p>Firefox çš„ç­–ç•¥ä¸ºï¼š</p><ol type="1"><li>å…¨å±€é™åˆ¶ (Global Limit)ï¼Œ50% å‰©ä½™ç£ç›˜ç©ºé—´</li><li>åŸŸåç»„é™åˆ¶ï¼Œå¤§çº¦æ˜¯ 20% çš„å…¨å±€é™åˆ¶é‡ã€‚ä¾‹å¦‚ <code>mozilla.org</code>/<code>joe.blogs.mozilla.org</code>/<code>firefox.com</code> è¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªåŸŸåç»„ï¼Œå…±äº«ä¸€ä¸ªç»„é™åˆ¶ã€‚</li></ol><p>å½“ç£ç›˜ç©ºé—´å‘Šç½„ï¼Œquota manager ä¼šå¼€å§‹åˆ é™¤ä¸´æ—¶å­˜å‚¨ (temporary storage)ï¼Œä»¥<strong>åŸŸå</strong>ä¸ºå•ä½åˆ é™¤ï¼Œç›´åˆ°è§‰å¾—ç£ç›˜ç©ºé—´ä½™é‡å°šè¶³ã€‚</p><p>åˆ é™¤é¡ºåºéµå¾ª LRU åŸåˆ™ï¼Œæœ€åè®¿é—®æ—¶é—´è·ç¦»ç°åœ¨æœ€è¿œçš„åŸŸåä¸‹çš„ object store ä¼šè¢«æ•´ä¸ªåˆ é™¤ã€‚</p><p>ç›®å‰ chrome (79) çš„ç­–ç•¥ç»†èŠ‚å¯èƒ½ä¸å¤ªä¸€æ ·ï¼Œä½†è¿˜æ²¡æœ‰æ‰¾åˆ°å…·ä½“æ–‡æ¡£æè¿°ã€‚</p><h2 id="æŸ¥è¯¢å½“å‰å­˜å‚¨ç©ºé—´çŠ¶å†µ">æŸ¥è¯¢å½“å‰å­˜å‚¨ç©ºé—´çŠ¶å†µ</h2><p>ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/estimate">StorageManager::estimate()</a> æ–¹æ³•æŸ¥è¯¢å½“å‰å­˜å‚¨ç©ºé—´çš„é…é¢ (quota) å’Œå·²ä½¿ç”¨é‡ (usage)ã€‚</p><p>è¯¦ç»†æè¿°åœ¨ <a href="https://storage.spec.whatwg.org/">Stroage è‰æ¡ˆ</a> ä¸­å¯æŸ¥ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">navigator.storage.estimate().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">estimate</span>) </span>&#123;<br>  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;percent&quot;</span>).innerHTML =<br>      (estimate.usage / estimate.quota * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>é¢å¤–ä¸€è¯´ï¼Œåœ¨ Chrome ä¸­è¿”å›çš„ estimate è¿˜ä¼šå¤šå‡ºä¸€ä¸ªéæ ‡å‡†å­—æ®µ <code>usageDetails</code>ï¼Œèƒ½çœ‹åˆ°æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><code class="hljs json">&quot;usageDetails&quot;: &#123;<br>  &quot;caches&quot;: 197632,<br>  &quot;indexedDB&quot;: 187255711,<br>  &quot;serviceWorkerRegistrations&quot;: 1561632<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å®é™…ä½¿ç”¨æ—¶ä¸€äº›æŠ€æœ¯é€‰æ‹©è€ƒé‡">å®é™…ä½¿ç”¨æ—¶ï¼Œä¸€äº›æŠ€æœ¯é€‰æ‹©è€ƒé‡</h1><h2 id="å­˜å‚¨å¤§æ–‡ä»¶å’Œæ•°æ®å—">å­˜å‚¨å¤§æ–‡ä»¶å’Œæ•°æ®å—</h2><p>IndexedDB åœ¨ WebApp ä¸­å¯ä»¥æ‹…ä»»æ•°æ®æŒä¹…å±‚ï¼Œæ¯”èµ·æ›´æ—©çš„åŸºäºå­—ç¬¦ä¸²çš„ LocalStorage ï¼Œå¯ä»¥å­˜å‚¨æ›´å¤æ‚ã€æ›´å¤šæ ·åŒ–å’Œæ›´å¤§çš„æ•°æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åœºæ™¯ï¼š</p><ul><li>ArrayBuffer/Uint8Array/Float32Array å­˜å‚¨ç­‰äºŒè¿›åˆ¶æ•°æ®å’Œè§†å›¾å¯¹è±¡ï¼Œç”¨ä½œå¯†é›†è®¡ç®—</li><li>ImageData åœ¨åŸºäº canvas çš„ç»˜å›¾ç¨‹åºæˆ–æ¸¸æˆä¸­åšç»˜åˆ¶ç»“æœç¼“å­˜</li><li>File/Blob æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œå¤§æ–‡ä»¶å­˜å‚¨</li></ul><h2 id="blob-ä¸å¸¸ç”¨äºŒè¿›åˆ¶æ•°æ®ç±»å‹äº’è½¬">Blob ä¸å¸¸ç”¨äºŒè¿›åˆ¶æ•°æ®ç±»å‹äº’è½¬</h2><p>å¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼Œå»ºè®®ä½¿ç”¨ File/Blobï¼Œç›®å‰åœ¨ mac chrome 79 ä¸Šæµ‹è¯•ï¼Œä¿å­˜åŒ…å« ArrayBuffer çš„å•æ¡è®°å½•è¶…è¿‡ 100MBï¼Œä¾¿ä¼šå†™å…¥å¤±è´¥ã€‚</p><p>ä½¿ç”¨ Blobï¼ˆæˆ–è€…åŸºäºå®ƒçš„ File å¯¹è±¡ï¼‰ è¿˜æœ‰è®¸å¤šå¥½å¤„ï¼Œå¦‚æœåº”ç”¨çš„ä¸»è¦åŠŸèƒ½æ˜¯éŸ³è§†é¢‘ç›¸å…³å¤„ç†ï¼Œä½¿ç”¨ <code>URL.createObjectURL(blob)</code> ç”Ÿæˆçš„å­—ç¬¦ä¸²æœ€åèƒ½ç›´æ¥ä½œä¸ºåŸç”Ÿ DOM çš„ img/video/audio æ ‡ç­¾æ¥å—çš„ srcã€‚è€Œä¸” <code>blob.type</code> æ˜¯æœ‰æ„ä¹‰çš„ MIME Typeï¼Œåœ¨è°ƒè¯•æ•°æ®çš„æ—¶å€™ä¹Ÿæœ‰æ›´å¤šçš„ä¿¡æ¯ã€‚å› æ­¤ Blob å¾ˆé€‚åˆä½œä¸ºå¤„ç†åå¯ä»¥ç›´æ¥å±•ç¤ºçš„æˆå“å­˜å‚¨ã€‚</p><p>ä½†è‹¥æ•°æ®éœ€è¦è¢«ä¿®æ”¹å’Œæ“ä½œï¼ŒBlob éœ€è¦è½¬åŒ–ä¸º ArrayBuffer ä»¥åŠå…·ä½“çš„ç±»å‹æ•°æ®è§†å›¾ Uint8Array ç­‰ä½¿ç”¨ã€‚</p><h3 id="blob---arraybuffer">Blob -&gt; ArrayBuffer</h3><p>ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼Œéƒ½ä¸ºå¼‚æ­¥è¿‡ç¨‹</p><p>1 ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob/arrayBuffer">blob.arrayBuffer()</a> æ–¹æ³•ã€‚æ­¤æ–¹æ³•ä¸ºæ ‡å‡†çš„æ¨èï¼Œä¸è¿‡ç›®å‰æµè§ˆå™¨æ”¯æŒæœ‰é™ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> arrayBuffer = awiat blob.arrayBuffer()<br></code></pre></td></tr></table></figure><p>2 ä½¿ç”¨ <code>FileReader</code></p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> arrayBuffer<br><span class="hljs-keyword">const</span> fr = <span class="hljs-keyword">new</span> FileReader()<br>fr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;<br>  arrayBuffer = e.target.value<br>&#125;<br>fr.readAsArrayBuffer(blob)<br></code></pre></td></tr></table></figure><h3 id="arraybuffer---blob">ArrayBuffer -&gt; Blob</h3><p>åŒæ­¥è¿‡ç¨‹</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> Blob([arrayBuffer], &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;video/mp4&#x27;</span> &#125;)<br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒ">å‚è€ƒ</h1><p>https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria</p><p>https://developers.google.com/web/updates/2016/06/persistent-storage</p><p>https://developer.chrome.com/apps/offline_storage</p><p>https://stackoverflow.com/questions/17809824/how-to-use-navigator-instead-of-window-webkitstorageinfo-html5-file-system-api</p>]]></content>
    
    
    <summary type="html">å¯¹ WebStorage å’Œ IndexedDB ä½¿ç”¨çš„ä¸€äº›ç»éªŒ</summary>
    
    
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="IndexedDB" scheme="http://hikerpig.github.io/tags/IndexedDB/"/>
    
    <category term="WebStorage" scheme="http://hikerpig.github.io/tags/WebStorage/"/>
    
    <category term="Browser" scheme="http://hikerpig.github.io/tags/Browser/"/>
    
  </entry>
  
  <entry>
    <title>ç¼–è¯‘ Skia canvaskit.wasm</title>
    <link href="http://hikerpig.github.io/2019/09/24/2019-09-24-Compile-Skia-Canvaskit-WASM/"/>
    <id>http://hikerpig.github.io/2019/09/24/2019-09-24-Compile-Skia-Canvaskit-WASM/</id>
    <published>2019-09-23T16:00:00.000Z</published>
    <updated>2020-03-30T03:57:45.634Z</updated>
    
    <content type="html"><![CDATA[<p>Skia æ˜¯ Google ä¸€ä¸ªå¼€æºçš„è·¨å¹³å°å›¾å½¢åº“ï¼Œç”¨äº Android, Chromium, Flutter ç­‰é¡¹ç›®ã€‚ç›®å‰é¡¹ç›®å†…æœ‰åœ¨å¼€å‘çš„ä¸€ä¸ª Skia + WebAssembly ç‰ˆçš„ <a href="https://skia.org/user/modules/canvaskit">CanvasKit</a>, å¯ä»¥ä½¿ç”¨ JS è°ƒç”¨é¢„å…ˆç¼–è¯‘å¥½çš„ c++ -&gt; wasm æ¨¡å—ï¼Œä¸ºä¸€äº›è·¨å¹³å°çš„å›¾å½¢é¡¹ç›®(ä¾‹å¦‚ lottie çš„ Skia ç‰ˆ <a href="https://skia.org/user/modules/skottie">skottie</a> )ç§»æ¤åˆ° web ç«¯æä¾›äº†ä¸€ç§æ–°çš„å¯èƒ½æ€§ã€‚</p><h1 id="ç¼–è¯‘">ç¼–è¯‘</h1><h2 id="skia-ä»£ç å‡†å¤‡">Skia ä»£ç å‡†å¤‡</h2><p>ä¸‹è½½å’Œç¼–è¯‘æºç éƒ¨åˆ†å‚çœ‹å®˜æ–¹æ–‡æ¡£ <a href="https://skia.org/user/build">How to build Skia</a>, å‡†å¤‡å¥½æ¢¯å­ã€‚</p><p>canvaskit ç›¸å…³æºç éƒ½åœ¨ <code>modules/canvaskit</code> ç›®å½•ä¸‹ã€‚</p><p>æ‹‰å–å®Œä»£ç åè¿›è¡Œåˆ°åŒæ­¥ä¾èµ–è¿™ä¸€æ­¥å°±è¡Œã€‚å› ä¸ºæˆ‘ä»¬çš„æ„å»ºè„šæœ¬åœ¨ <code>modules/canvaskit</code> é‡Œå·²ç»æœ‰äº†ï¼Œå¯ä»¥ä¸ç”¨ä»å¤´ç¼–è¯‘æ‰€æœ‰ skia æ ·ä¾‹ä»£ç å’Œå¯æ‰§è¡Œç¨‹åºï¼Œå½“ç„¶äº†ä½ ä¹Ÿå¯ä»¥è·Ÿç€æ•™ç¨‹æ„å»ºå®Œæ•´é¡¹ç›®ï¼ŒåŠ æ·±å¯¹å„åŠŸèƒ½æ¨¡å—çš„ç†è§£ã€‚</p><figure class="highlight dart"><table><tr><td class="code"><pre><code class="hljs dart">python2 tools/git-<span class="hljs-keyword">sync</span>-deps<br></code></pre></td></tr></table></figure><h2 id="é€‰æ‹©-emscripten-å·¥å…·é“¾">é€‰æ‹© emscripten å·¥å…·é“¾</h2><p>ä½¿ç”¨ <a href="https://github.com/emscripten-core/emsdk">emsdk</a> å®‰è£… emscripten ç›¸å…³å·¥å…·é“¾ã€‚</p><p>emsdk çš„å„ä¸ªå‘è¡Œ tag é‡Œæœ‰å‡ å¥—å‘½åï¼Œä¾‹å¦‚ <code>1.38.45</code> å’Œ <code>1.38.45-upstream</code>, åŒºåˆ«åœ¨äºå‰è€…ä½¿ç”¨ fastcomp åç«¯ï¼Œåè€…ä½¿ç”¨ llvm åç«¯ã€‚è™½ç„¶ emscripten å®˜æ–¹æ¨èä½¿ç”¨è¾ƒæ–°çš„ llvm åç«¯ï¼Œä½†æ˜¯åœ¨å¯¹ canvaskit é‡Œå®é™…ä½¿ç”¨çš„æ—¶å€™æˆ‘å‘ç° <code>wasm-ld</code> æ­¥éª¤ä¼šæŠ¥é”™ï¼Œæ— æ³•ç¼–è¯‘æˆåŠŸã€‚ å› æ­¤é€‰æ‹© fastcomp ç‰ˆã€‚</p><figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">emsdk</span> install <span class="hljs-number">1</span>.<span class="hljs-number">38</span>.<span class="hljs-number">45</span><br></code></pre></td></tr></table></figure><h2 id="canvaskitcompile.sh">canvaskit/compile.sh</h2><p>è¿™ä¸ªç¼–è¯‘è„šæœ¬ç»„ç»‡äº†è°ƒç”¨ gn å’Œ em++ çš„å‚æ•°ã€‚æœ‰ä»¥ä¸‹å¯é€‰å‚æ•°ï¼Œä¸ç»†çœ‹çš„è¯å¯ä»¥ç›´æ¥è·³åˆ°ä¸‹ä¸€æ­¥<a href="#ç¼–è¯‘æ­¥éª¤">ç¼–è¯‘æ­¥éª¤</a></p><ul><li><code>no_font</code> / <code>no_embedded_font</code> å­—ä½“ç®¡ç†ç›¸å…³ï¼Œä¸æŒ‡å®šçš„è¯ä¼šåŒ…æ‹¬ skia fontmgr ç›¸å…³å†…å®¹ï¼Œä¸”å†…åµŒä¸€ä¸ªé»˜è®¤å­—ä½“ <code>NotoMono-Regular.ttf</code></li><li><code>debug</code> / <code>profiling</code> ä¸æŒ‡å®šçš„è¯é»˜è®¤æŒ‰ç…§ release æ ‡å‡†ï¼Œå¼€å¯æœ€é«˜ä»£ç ä¼˜åŒ–æ¨¡å¼ã€‚</li><li><code>cpu</code> ä¸æŒ‡å®šçš„è¯é»˜è®¤ä¼šåŠ ä¸Š webgl æ”¯æŒã€‚</li><li><code>no_canvas</code> æŒ‡å®šçš„è¯ä¼šæ’é™¤æ‰ htmlcanvas/*.js æ–‡ä»¶</li></ul><h2 id="ç¼–è¯‘æ­¥éª¤">ç¼–è¯‘æ­¥éª¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> ~/dev/emsdk/emsdk_env.sh<br>emsdk activate 1.38.45<br><br><span class="hljs-built_in">cd</span> /path/to/skia<br>./modules/canvaskit/compile.sh<br></code></pre></td></tr></table></figure><p>å–æ¯èŒ¶ä¼¸ä¼¸æ‡’è…°ï¼Œå¤§æ¦‚å››äº”åˆ†é’Ÿåï¼Œç­‰åˆ°æœ€åä¸€æ­¥ log 'Generating final wasm' å®Œæˆï¼Œä¾¿å¯ä»¥åœ¨ <code>skia/out/canvaskit_wasm</code> é‡Œæ‰¾åˆ°ç»“æœæ–‡ä»¶ã€‚</p><figure class="highlight css"><table><tr><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">canvaskit</span><span class="hljs-selector-class">.js</span>  <span class="hljs-selector-tag">canvaskit</span><span class="hljs-selector-class">.wasm</span> ...<br></code></pre></td></tr></table></figure><h2 id="tips">TIPS</h2><ul><li>ä¸çŸ¥é“åˆ«çš„ emsdk ç¼–è¯‘çš„ä¹‹å‰ç»“æœæœ‰æ²¡æœ‰å½±å“ï¼Œæ‰€ä»¥å¦‚æœæ›´æ¢äº† emsdk çš„ç‰ˆæœ¬ï¼Œæ¨èå¼€å§‹å‰ <code>emcc --clear-cache</code></li></ul><h1 id="æŸ¥çœ‹æ•ˆæœ">æŸ¥çœ‹æ•ˆæœ</h1><p>ä½¿ç”¨åˆšæ‰ç¼–è¯‘å‡ºæ¥çš„ js/wasm æ–‡ä»¶æŸ¥çœ‹æ•ˆæœã€‚</p><figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/skia/m</span>odules/canvaskit<br>mkdir -p node_modules/canvaskit<br>ln -s <span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/skia/</span>out<span class="hljs-regexp">/canvaskit_wasm node_modules/</span>canvaskit/bin<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ http é™æ€æœåŠ¡å™¨ç¨‹åº (å¦‚ <a href="https://www.npmjs.com/package/http-server">http-server</a> ) ï¼š</p><figure class="highlight axapta"><table><tr><td class="code"><pre><code class="hljs axapta">http-<span class="hljs-keyword">server</span> .<br></code></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥åœ¨ <code>http://127.0.0.1:8080/canvaskit/example.html</code> å’Œ <code>http://127.0.0.1:8080/canvaskit/extra.html</code> é¡µé¢é‡Œçœ‹ç¤ºæ„æ•ˆæœã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Skia æ˜¯ Google ä¸€ä¸ªå¼€æºçš„è·¨å¹³å°å›¾å½¢åº“ï¼Œç”¨äº Android, Chromium, Flutter ç­‰é¡¹ç›®ã€‚ç›®å‰é¡¹ç›®å†…æœ‰åœ¨å¼€å‘çš„ä¸€ä¸ª Skia + WebAssembly ç‰ˆçš„ &lt;a href=&quot;https://skia.org/user/modules/can</summary>
      
    
    
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="WebAssembly" scheme="http://hikerpig.github.io/tags/WebAssembly/"/>
    
    <category term="Skia" scheme="http://hikerpig.github.io/tags/Skia/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨æµè§ˆå™¨ç«¯æ£€æµ‹ç”µè„‘æ˜¯å¦åˆšä»ä¼‘çœ ä¸­é†’æ¥</title>
    <link href="http://hikerpig.github.io/2019/09/04/2019-09-04-Detect-Computer-Resume-From-Sleep-In-Browser/"/>
    <id>http://hikerpig.github.io/2019/09/04/2019-09-04-Detect-Computer-Resume-From-Sleep-In-Browser/</id>
    <published>2019-09-03T16:00:00.000Z</published>
    <updated>2019-09-06T03:49:42.517Z</updated>
    
    <content type="html"><![CDATA[<p>å½“ç”µè„‘è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œæµè§ˆå™¨çš„ä¸€äº›æŒä¹…åŠŸèƒ½ä¼šå—åˆ°å½±å“(ä¾‹å¦‚ WebSocket è¿æ¥ä¸­æ–­)ï¼Œæœ‰æ—¶éœ€è¦åœ¨ä»ä¼‘çœ çŠ¶æ€ä¸­æ¢å¤è¿‡æ¥çš„æ—¶å€™åšä¸€äº›æ£€æŸ¥å’Œæ¢å¤å·¥ä½œã€‚</p><h1 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h1><h2 id="åˆ©ç”¨è®¡æ—¶å™¨">åˆ©ç”¨è®¡æ—¶å™¨</h2><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> lastTime = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime()<br><br><span class="hljs-comment">// å¯èƒ½ç”±äºè„šæœ¬è®¡ç®—é‡å¤§ï¼Œæˆ–æ˜¯ä½¿ç”¨äº† alert/confirm ç­‰é˜»å¡çº¿ç¨‹çš„å‡½æ•°ï¼Œçš„ç¡®ä¼šæœ‰äº›å°è¯¯å·®ï¼Œå¯ä»¥å¿½ç•¥æ‰</span><br><span class="hljs-keyword">const</span> THRESHOLD = <span class="hljs-number">15000</span><br><br><span class="hljs-built_in">setInterval</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">const</span> currentTime = <span class="hljs-built_in">Date</span>.now()<br>  <span class="hljs-keyword">if</span> (currentTime &gt; (lastTime + THRESHOLD)) &#123;<br>    <span class="hljs-comment">// åˆšé†’æ¥ï¼Œåšç‚¹ä»€ä¹ˆå‘¢</span><br>  &#125;<br>  lastTime = currentTime<br>&#125;, <span class="hljs-number">30000</span>); <span class="hljs-comment">// 30s æ¯”è¾ƒä¿å®ˆï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥è°ƒæ•´</span><br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒ">å‚è€ƒ</h1><ul><li><a href="https://stackoverflow.com/questions/4079115/can-any-desktop-browsers-detect-when-the-computer-resumes-from-sleep">Can any desktop browsers detect when the computer resumes from sleep?</a></li></ul>]]></content>
    
    
    <summary type="html">å½“ç”µè„‘è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œæµè§ˆå™¨çš„ä¸€äº›æŒä¹…åŠŸèƒ½ä¼šå—åˆ°å½±å“(ä¾‹å¦‚ WebSocket è¿æ¥ä¸­æ–­)ï¼Œæœ‰æ—¶éœ€è¦åœ¨ä»ä¼‘çœ çŠ¶æ€ä¸­æ¢å¤è¿‡æ¥çš„æ—¶å€™åšä¸€äº›æ£€æŸ¥å’Œæ¢å¤å·¥ä½œ</summary>
    
    
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="æµè§ˆå™¨" scheme="http://hikerpig.github.io/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>å‘½ä»¤è¡Œä¸‹çš„å›¾ç‰‡å‹ç¼©å·¥å…·</title>
    <link href="http://hikerpig.github.io/2019/08/20/2019-08-20-Run-Image-Optimize-With-Cli/"/>
    <id>http://hikerpig.github.io/2019/08/20/2019-08-20-Run-Image-Optimize-With-Cli/</id>
    <published>2019-08-19T16:00:00.000Z</published>
    <updated>2019-08-20T11:09:12.030Z</updated>
    
    <content type="html"><![CDATA[<h1 id="imagemin-cli">imagemin-cli</h1><p><a href="https://github.com/imagemin/imagemin-cli">imagemin/imagemin-cli</a> æ˜¯ä¸€ä¸ªç”¨ node.js å†™çš„å·¥å…·ï¼Œè°ƒç”¨çš„éƒ½æ˜¯çº¯ CLI çš„å¼€æºç¨‹åºï¼Œæ‰€ä»¥å¹³å°å…¼å®¹æ€§å¥½å¾ˆå¤šã€‚å…¶ä¾èµ–çš„ <a href="https://github.com/imagemin/imagemin">imagemin</a> é¡¹ç›®æ”¯æŒ <code>imagemin-*</code> å½¢å¼çš„ npm package æ’ä»¶æ‰©å±•ï¼Œcli é»˜è®¤çš„æ’ä»¶æœ‰è¿™ 4 ä¸ªã€‚</p><figure class="highlight scheme"><table><tr><td class="code"><pre><code class="hljs scheme"><span class="hljs-symbol">&#x27;gifsicle</span>&#x27;<br><span class="hljs-symbol">&#x27;jpegtran</span>&#x27;<br><span class="hljs-symbol">&#x27;optipng</span>&#x27;<br><span class="hljs-symbol">&#x27;svgo</span>&#x27;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨çš„æ—¶å€™ä¼šæ£€æµ‹å½“å‰ç³»ç»Ÿå˜é‡é‡Œæœ‰æ²¡æœ‰å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ²¡æœ‰çš„è¯ä¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…ï¼ŒçœŸæ­£åšåˆ°äº†å¼€ç®±å³ç”¨ã€‚imagemin åœ¨å‰ç«¯è‡ªåŠ¨åŒ–å·¥ä½œæµä¸­æœ‰è¯¸å¤šæ”¯æŒï¼Œä¾‹å¦‚ <a href="https://github.com/Klathmon/imagemin-webpack-plugin">imagemin-webpack-plugin</a>ï¼Œ<a href="https://github.com/sindresorhus/gulp-imagemin">gulp-imagemin</a>ã€‚</p><p>å®˜æ–¹ç»´æŠ¤çš„æ’ä»¶åˆ—è¡¨å’Œé¡¹ç›®æ„å»ºæ”¯æŒå¯è§ <a href="https://github.com/imagemin">github ä¸‹çš„ imagemin ç»„ç»‡</a> ã€‚</p><h2 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h2><p><code>--help</code> é‡Œç»™çš„ä¾‹å­:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><code class="hljs powershell">Examples<br>  <span class="hljs-variable">$</span> imagemin images/* -<span class="hljs-literal">-out</span><span class="hljs-literal">-dir</span>=build<br>  <span class="hljs-variable">$</span> imagemin foo.png &gt; foo<span class="hljs-literal">-optimized</span>.png<br>  <span class="hljs-variable">$</span> <span class="hljs-built_in">cat</span> foo.png | imagemin &gt; foo<span class="hljs-literal">-optimized</span>.png<br>  <span class="hljs-variable">$</span> imagemin -<span class="hljs-literal">-plugin</span>=pngquant foo.png &gt; foo<span class="hljs-literal">-optimized</span>.png<br></code></pre></td></tr></table></figure><h1 id="imageoptim-cli">ImageOptim-CLI</h1><p>ä»… Mac å¯ç”¨ï¼Œ<a href="https://github.com/JamieMason/ImageOptim-CLI">ImageOptim-CLI</a> åŒ…è£…äº†å‡ ä¸ª Mac ä¸‹ GUI/CLI å›¾ç‰‡å‹ç¼©å·¥å…·çš„è°ƒç”¨ï¼Œæ”¯æŒè°ƒç”¨çš„ App æœ‰ï¼š</p><pre><code>Supported Apps:ImageAlpha: https://pngmini.comImageOptim: https://imageoptim.comJPEGmini Lite: https://itunes.apple.com/us/app/jpegmini-lite/id525742250JPEGmini Pro: https://itunes.apple.com/us/app/jpegmini-pro/id887163276JPEGmini: https://itunes.apple.com/us/app/jpegmini/id498944723</code></pre><p>å¸¸è§çš„ JPEG/PNG/GIF/SVG ç­‰æ ¼å¼éƒ½å¯ä»¥å‹ç¼©ã€‚</p><p>è°ƒç”¨æ–¹å¼å¾ˆæš´åŠ›ï¼Œç›´æ¥ç¡¬ç¼–ç äº†åº”ç”¨çš„è·¯å¾„ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> PNGQUANT_BIN_PATH = <span class="hljs-string">&#x27;/Applications/ImageAlpha.app/Contents/MacOS/pngquant&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> IMAGEOPTIM_BIN_PATH = <span class="hljs-string">&#x27;/Applications/ImageOptim.app/Contents/MacOS/ImageOptim&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å…ˆè¦æå‰å®‰è£…å¥½ç›¸åº”çš„ Appã€‚</p><h2 id="å®‰è£…">å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">npm install -g imageoptim-cli<br></code></pre></td></tr></table></figure><p>é»˜è®¤ä½¿ç”¨çš„æ˜¯ <a href="https://imageoptim.com/mac">ImageOptim</a>ï¼Œä¸€ä¸ªå¼€æºçš„ GUI å›¾ç‰‡å‹ç¼©å·¥å…·ï¼Œé›†æˆäº†é’ˆå¯¹å„ç§æ ¼å¼å›¾ç‰‡çš„ä¼˜ç§€å¼€æºå‹ç¼©å·¥å…·ã€‚</p><blockquote><p><a href="https://imageoptim.com/">ImageOptim</a> is a GUI for lossless image optimization tools: Zopfli, PNGOUT, <a href="https://crates.rs/crates/oxipng">OxiPNG</a>, AdvPNG, PNGCrush, <a href="https://github.com/tjko/jpegoptim">JPEGOptim</a>, Jpegtran, <a href="https://github.com/google/guetzli">Guetzli</a>, <a href="https://kornel.ski/lossygif">Gifsicle</a>, <a href="https://github.com/svg/svgo">SVGO</a>, <a href="https://github.com/RazrFalcon/svgcleaner">svgcleaner</a> and <a href="https://github.com/mozilla/mozjpeg">MozJPEG</a>.</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">brew cask install imageoptim<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨">ä½¿ç”¨</h2><p>å¤„ç† JPEG æ ¼å¼è¿˜æ˜¯æŒºå¿«çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ imageoptim <span class="hljs-string">&#x27;**/*.jpg&#x27;</span> <span class="hljs-string">&#x27;**/*.jpeg&#x27;</span><br>i Running ImageOptim...<br>âœ“ coffeetags_tagbar.jpg was: 845kB now: 786kB saving: 58.4kB (6.91%)<br>âœ“ compare-shadow-blur.jpg was: 22.4kB now: 22.4kB saving: 0B (0.00%)<br>âœ“ stack-or-gtfo.jpg was: 98.1kB now: 68.1kB saving: 30kB (30.59%)<br>âœ“ truck.jpg was: 449kB now: 401kB saving: 47.7kB (10.63%)<br>âœ“ fonts/kosugi-maru-1.jpg was: 22.9kB now: 14.4kB saving: 8.54kB (37.29%)<br>âœ“ fonts/noto-sans-jp-1.jpg was: 24.9kB now: 15.8kB saving: 9.17kB (36.79%)<br>âœ“ tabs/santa_monica_dream_-_angus_and_julia.jpg was: 263kB now: 189kB saving: 73.4kB (27.94%)<br>âœ“ CSS_EX1.jpeg was: 538kB now: 495kB saving: 43.6kB (8.10%)<br>âœ“ TOTAL was: 2.26MB now: 1.99MB saving: 271kB (11.97%)<br>âœ“ Finished<br></code></pre></td></tr></table></figure><p>å¤„ç† PNG æ—¶æœ‰ç‚¹æ…¢ï¼Œå¯èƒ½æ˜¯å› ä¸ºä½¿ç”¨åº•å±‚çš„ <a href="https://pngquant.org/">pngquant</a> æ—¶çš„å‚æ•°é—®é¢˜ï¼Œè®¡ç®—é‡æœ‰ç‚¹å¤§ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ time imageoptim <span class="hljs-string">&#x27;**/*.png&#x27;</span><br>i Running ImageOptim...<br>âœ“ org-mode-code.png was: 36.6kB now: 15.8kB saving: 20.8kB (56.78%)<br>âœ“ screenshot.png was: 109kB now: 42kB saving: 67.2kB (61.55%)<br>âœ“ vimwiki-code.png was: 34kB now: 14.3kB saving: 19.7kB (57.90%)<br>âœ“ TOTAL was: 180kB now: 72.1kB saving: 108kB (59.89%)<br>âœ“ Finished<br>imageoptim <span class="hljs-string">&#x27;**/*.png&#x27;</span>  146.20s user 1.37s system 290% cpu 50.865 total<br></code></pre></td></tr></table></figure><p>å¦‚å·²ç»å®‰è£…äº† <a href="https://pngmini.com">ImageAlpha</a> ï¼ŒåŠ ä¸Šå‚æ•° <code>--imagealpha</code>ï¼Œå…ˆè°ƒç”¨ ImageAlphaï¼Œå¤„ç† PNG çš„æ•ˆç‡å’Œé€Ÿåº¦éƒ½æœ‰å¾ˆå¤§æå‡ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ time imageoptim --imagealpha <span class="hljs-string">&#x27;**/*.png&#x27;</span><br>i Running ImageAlpha...<br>i Running ImageOptim...<br>âœ“ org-mode-code.png was: 36.6kB now: 5.64kB saving: 31kB (84.60%)<br>âœ“ screenshot.png was: 109kB now: 15.8kB saving: 93.4kB (85.56%)<br>âœ“ vimwiki-code.png was: 34kB now: 4.72kB saving: 29.3kB (86.11%)<br>âœ“ TOTAL was: 180kB now: 26.1kB saving: 154kB (85.47%)<br>âœ“ Finished<br>imageoptim --imagealpha <span class="hljs-string">&#x27;**/*.png&#x27;</span>  55.98s user 0.75s system 298% cpu 18.985 total<br></code></pre></td></tr></table></figure><p>CLI æä¾›äº† <code>--quality</code> å’Œ <code>--speed</code> ä¸¤ä¸ªç»†åŒ–çš„è°ƒæ•´å‚æ•°ï¼Œä»”ç»†è°ƒæ•´å¯èƒ½æœ‰æ›´åˆé€‚çš„é€Ÿåº¦/å‹ç¼©ç‡ç»„åˆã€‚</p><p>å¯¹äºä¸åŒå·¥å…·å¯¹ä¸åŒæ ¼å¼å’Œç‰¹æ€§çš„å‹ç¼©æ•ˆæœï¼Œä½œè€…ç»™å‡ºäº†<a href="http://jamiemason.github.io/ImageOptim-CLI/">ä¸€ä»½è¯„æµ‹æ•°æ®</a>ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;imagemin-cli&quot;&gt;imagemin-cli&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/imagemin/imagemin-cli&quot;&gt;imagemin/imagemin-cli&lt;/a&gt; æ˜¯ä¸€ä¸ªç”¨ node.js å†™çš„å·¥å…·ï¼Œè°ƒç”¨</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://hikerpig.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="å·¥å…·" scheme="http://hikerpig.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="å›¾ç‰‡" scheme="http://hikerpig.github.io/tags/%E5%9B%BE%E7%89%87/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Typescript åŠ å¼º Vuex ä½¿ç”¨ä½“éªŒ</title>
    <link href="http://hikerpig.github.io/2019/06/17/2019-06-17-typescript-powered-vuex/"/>
    <id>http://hikerpig.github.io/2019/06/17/2019-06-17-typescript-powered-vuex/</id>
    <published>2019-06-16T16:00:00.000Z</published>
    <updated>2019-12-30T08:46:46.709Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¢°åˆ°çš„é—®é¢˜">ç¢°åˆ°çš„é—®é¢˜</h1><h2 id="å¦‚å±¥é’ˆæ¯¡çš„çŠ¶æ€ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘è°ƒç”¨">å¦‚å±¥é’ˆæ¯¡çš„çŠ¶æ€ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘è°ƒç”¨</h2><p>Vuex ä½¿ç”¨äº†ç»Ÿä¸€çš„ <code>dispatch</code>/<code>commit</code> æ–¹æ³•å»è§¦å‘ Action å’Œ Mutation, å¦‚æœä½¿ç”¨åµŒå¥—çš„ module, Vuex è¿˜ä¼šè§£æå‘½åç©ºé—´ï¼Œä»¥æ‰¾åˆ°æ­£ç¡®çš„ Action/Mutation å‡½æ•°ã€‚</p><p>å¯¹äºç»„ä»¶æ¥è¯´å¾ˆå‹å¥½ï¼Œä½†æ˜¯å¯¹äºé¡¹ç›®ç»´æŠ¤æ¥è¯´å¯èƒ½å°±ç¨æ˜¾ç—›è‹¦ã€‚è™½ç„¶å¯¹çŠ¶æ€çš„æ›´æ”¹éƒ½ä»è§†å›¾é€»è¾‘é‡Œåˆ†ç¦»å‡ºæ¥æ”¾åœ¨äº† store æ–‡ä»¶å¤¹ä¸‹ï¼Œä¸€ç›®äº†ç„¶ï¼Œä½†æ˜¯å¯¹äºè§¦å‘ Action çš„ç»„ä»¶æ¥è¯´ï¼Œç»´æŒä¸ store éƒ¨åˆ†çš„å‡½æ•°ç­¾åå’Œæ¥å£ç»Ÿä¸€ï¼Œå°±ä¸å¾—ä¸é å…¨å±€æœç´¢äº†ï¼ˆç”±æ­¤å‚¬å‘äº†ä¸€äº› Vuex ä¸‹çš„æœ€ä½³å®è·µï¼Œä¾‹å¦‚åŠ¨ä½œåç§°éƒ½ç”¨ CAPITAL_SNAKE_CASE å‘½åæ³•ï¼Œæˆ–æ˜¯æŠ½å–å‡º mutation-types.js æ–‡ä»¶ï¼‰ã€‚</p><p>éšç€é¡¹ç›®çš„æ¨è¿›ï¼Œä¸€æ—¦ Action æœ‰å˜åŠ¨ï¼ˆå¢å‡å‚æ•°æ•°é‡æˆ–æ˜¯æ”¹å˜ç±»å‹ç­‰ç­‰ï¼‰ï¼Œé¡¹ç›®é‡Œæœ‰5ä¸ªåœ°æ–¹ç”¨åˆ°äº†å®ƒï¼Œè€Œä½ ç²—å¿ƒåœ°åªæ”¹äº† 4 ä¸ªåœ°æ–¹ï¼Œåœ¨ä¸€ä¸ªçŠ„è§’æ—®æ—¯çš„å¹³æ—¶ä¸ä¼šç”¨åˆ°ä¹Ÿæ²¡æœ‰æµ‹è¯•è¦†ç›–çš„åœ°æ–¹ï¼Œä¸€ä¸ªç‚¸å¼¹é»˜é»˜åœ°å°±å†’äº†å‡ºæ¥ã€‚</p><p>åœ¨ Javascript èƒ½åŠ›çš„é™åˆ¶ä¸‹ï¼Œåªå¥½é å‘½åè§„èŒƒå’Œå°å¿ƒç¿¼ç¿¼ï¼ˆä¸æ–­æœç´¢å’Œç¡®è®¤ä¿®æ”¹ï¼‰æ¥è§„é¿çš„é—®é¢˜ã€‚å…¶å®å€ŸåŠ© Typescript å¼ºå¤§çš„ç±»å‹æ¨æ–­èƒ½åŠ›ï¼Œè¿™ç§å¿ƒæ™ºè´Ÿæ‹…æ˜¯å®Œå…¨å¯ä»¥é¿å…çš„ã€‚</p><h1 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h1><p>vuex çš„ d.ts æ–‡ä»¶æä¾›äº†ä¸€äº›å¾ˆæœ‰ç”¨çš„ç±»å‹ï¼Œä¸è¿‡é‡Œé¢æœ‰å¥½å¤š any, æˆ‘ä»¬å…¶å®å¯ä»¥åœ¨å…¶ä¹‹ä¸Šå†ç»†åŒ–ä¸€ä¸‹ç±»å‹é™åˆ¶ã€‚</p><h2 id="å…³é”®ä»£ç ">å…³é”®ä»£ç </h2><p>è¿™ä¸ªæ–‡ä»¶å¯¼å‡ºäº†ä¸€äº›ç±»å‹ï¼Œä»¥åŠä¸¤ä¸ªéœ€è¦ä¼ å…¥ç±»å‹çš„é«˜é˜¶å‡½æ•° <code>makeDispatcher</code> å’Œ <code>makeMutator</code>ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥çœ‹å†ä¹‹åçš„ç¤ºä¾‹ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// vuex-util.ts</span><br><span class="hljs-keyword">import</span> &#123; ActionContext, Store, Module &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><br><span class="hljs-keyword">type</span> DictOf&lt;T&gt; = &#123;[key: <span class="hljs-built_in">string</span>]: T &#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> ActionDescriptor = [<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>]<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> ModuleActions&lt;Context, Descriptor <span class="hljs-keyword">extends</span> DictOf&lt;ActionDescriptor&gt;&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> keyof Descriptor]: <span class="hljs-function">(<span class="hljs-params">ctx: Context, payload: Descriptor[K][<span class="hljs-number">0</span>]</span>) =&gt;</span> Descriptor[K][<span class="hljs-number">1</span>]<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> ModuleMutations&lt;State, PayloadTree&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> keyof PayloadTree]: <span class="hljs-function">(<span class="hljs-params">state: State, payload: PayloadTree[K]</span>) =&gt;</span> <span class="hljs-built_in">any</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isStore</span>(<span class="hljs-params">context: <span class="hljs-built_in">any</span></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> (<span class="hljs-string">&#x27;strict&#x27;</span> <span class="hljs-keyword">in</span> context)<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeDispatcher</span>&lt;<span class="hljs-title">Context</span> <span class="hljs-title">extends</span> <span class="hljs-title">ActionContext</span>&lt;<span class="hljs-title">any</span>, <span class="hljs-title">any</span>&gt;, <span class="hljs-title">Descriptor</span> <span class="hljs-title">extends</span> <span class="hljs-title">DictOf</span>&lt;<span class="hljs-title">ActionDescriptor</span>&gt;&gt;(<span class="hljs-params">ns?: <span class="hljs-built_in">string</span></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> &lt;K <span class="hljs-keyword">extends</span> keyof Descriptor&gt;(<br>    context: Store&lt;<span class="hljs-built_in">any</span>&gt; | Context,<br>    action: K,<br>    payload: Descriptor[K][<span class="hljs-number">0</span>],<br>  ) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> _context: <span class="hljs-built_in">any</span> = context<br>    <span class="hljs-keyword">let</span> actionName = action <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span><br>    <span class="hljs-keyword">if</span> (ns &amp;&amp; isStore(context)) &#123;<br>      actionName = <span class="hljs-string">`<span class="hljs-subst">$&#123;ns&#125;</span>/<span class="hljs-subst">$&#123;action&#125;</span>`</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> _context.dispatch(actionName, payload)<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å½“æ­¤æ¨¡å—ä¸º namespaced çš„æ—¶å€™, `$store.commit(mutation)` å’Œåœ¨ action handler å†…çš„ `ctx.commit(mutation)` æ˜¯ä¸ä¸€æ ·çš„</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeMutator</span>&lt;<span class="hljs-title">Context</span> <span class="hljs-title">extends</span> <span class="hljs-title">ActionContext</span>&lt;<span class="hljs-title">any</span>, <span class="hljs-title">any</span>&gt;, <span class="hljs-title">MutationPayloadTree</span>&gt;(<span class="hljs-params">ns?: <span class="hljs-built_in">string</span></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> &lt;K <span class="hljs-keyword">extends</span> keyof MutationPayloadTree&gt;(<br>    context: Store&lt;<span class="hljs-built_in">any</span>&gt; | Context,<br>    mutation: K,<br>    payload: MutationPayloadTree[K],<br>  ) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> mutationName = mutation <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span><br>    <span class="hljs-keyword">if</span> (ns &amp;&amp; isStore(context)) &#123;<br>      mutationName = <span class="hljs-string">`<span class="hljs-subst">$&#123;ns&#125;</span>/<span class="hljs-subst">$&#123;mutation&#125;</span>`</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> context.commit(mutationName, payload)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ç¤ºä¾‹-ä¸€ä¸ª-todo-app">ä½¿ç”¨ç¤ºä¾‹, ä¸€ä¸ª Todo App</h2><h3 id="å¯¼å‡º-vuex-module">å¯¼å‡º Vuex Module</h3><p>é¦–å…ˆåˆ—ä¸€ä¸‹æœ€åå¯¼å‡ºçš„ Vuex Module å£°æ˜:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; ActionContext, Module &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> VUEX_NS = <span class="hljs-string">&#x27;todo&#x27;</span><br><br><span class="hljs-comment">/** æ­¤å¯¹è±¡æ¥æ”¶ç±»å‹å˜é‡, åˆ†åˆ«ä»£è¡¨ module state å’Œ rootState ç±»å‹ */</span><br><span class="hljs-keyword">type</span> TodoContext = ActionContext&lt;TodosState, GlobalState&gt;<br><br><span class="hljs-comment">// ...</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  namespaced: <span class="hljs-literal">true</span>,<br>  state: &#123;...&#125;,<br>  actions: ACTIONS,<br>  mutations: MUTATIONS,<br>&#125; <span class="hljs-keyword">as</span> Module&lt;TodosState, GlobalState&gt;<br></code></pre></td></tr></table></figure><h3 id="ç®€å•çš„-actions-å’Œ-mutations">ç®€å•çš„ ACTIONS å’Œ MUTATIONS</h3><p>å£°æ˜ ACTIONSï¼Œéå¸¸ç®€å•åœ°ä» localStorage é‡Œå–å‡ºæ•°æ®ï¼Œç„¶åè°ƒç”¨ <code>SET_TODOS</code> mutation:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> ActionDescriptors = &#123;<br>  GET_USER_TODOS: [&#123;&#125;, <span class="hljs-built_in">void</span>]<br>&#125;<br><br><span class="hljs-keyword">const</span> ACTIONS: ModuleActions&lt;TodoContext, ActionDescriptors&gt; = &#123;<br>  GET_USER_TODOS(ctx) &#123;<br>    <span class="hljs-keyword">const</span> todos = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&#x27;todoItems&#x27;</span>)) || []<br>    ctx.dispatch(<span class="hljs-string">&#x27;SET_TODOS&#x27;</span>, &#123; todos &#125;)<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å®ç° MUTAIONSï¼Œå…ˆå£°æ˜å¥½æ‰€æœ‰ Mutation éœ€è¦çš„å‚æ•°ï¼Œå¹¶ä½¿ç”¨å·¥å…·ç±»å‹ <code>ModuleMutations</code> æ ‡æ³¨å³å°†ç»™ Vuex Module ä¼ é€’çš„ mutations å¯¹è±¡ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> MutationPayloads = &#123;<br>  SET_TODOS: &#123; todos: TodoItem[] &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> MUTATIONS: ModuleMutations&lt;TodosState, MutationPayloads&gt; = &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼ŒTS ç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ï¼Œæ˜¯å› ä¸º <code>ModuleMutations</code> è¿™ä¸ªå·¥å…·ç±»å‹è¦æ±‚åŒ…å«ç¬¬äºŒä¸ªç±»å‹å‚æ•°ä¸­æ‰€æœ‰çš„ keyï¼Œä¸€ä¸ªç©º Object æ²¡æœ‰å®ç° <code>MutationPayloads</code> æ‰€è¦æ±‚çš„ <code>SET_TODOS</code> æ–¹æ³•ï¼Œå› æ­¤ä¼šæŠ›å‡º TS Errorã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"> <span class="hljs-keyword">const</span>  MUTATIONS:  ModuleMutations&lt;TodosState,  MutationPayloads&gt; <br><br><span class="hljs-string">&#x27;MUTATIONS&#x27;</span> is declared but its value is <span class="hljs-built_in">never</span> read.ts(<span class="hljs-number">6133</span>)<br><br>Property <span class="hljs-string">&#x27;SET_TODOS&#x27;</span> is missing <span class="hljs-keyword">in</span> <span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span> but required <span class="hljs-keyword">in</span> <span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;ModuleMutations&lt;TodosState, MutationPayloads&gt;&#x27;</span>.ts(<span class="hljs-number">2741</span>)<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¯ä»¥çœ‹çœ‹é¡ºæ»‘çš„ç¼–è¾‘å™¨æç¤ºä½“éªŒï¼š</p><figure><img src="https://i.loli.net/2019/06/18/5d08ee57943b421476.gif" alt="" /><figcaption>å®ç° MUTATIONS</figcaption></figure><p>å£°æ˜å¥½ <code>MutationPayloads</code> ä»¥åï¼Œå¯ä»¥å€ŸåŠ©ä¸€ä¸ªå·¥å…·å‡½æ•°ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»ä¼¼äº <code>commit</code> çš„å‡½æ•°ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¸€ä¸ªå¸¦æœ‰ç±»å‹å˜é‡çš„å‡½æ•°ï¼Œä½¿ç”¨ç¤ºä¾‹ todoItemMutate(actionContext, &#x27;mutationName&#x27;, mutationPayload)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> todoItemMutate = makeMutator&lt;TodoContext, MutationPayloads&gt;(VUEX_NS)<br></code></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥æ”¹ä¸€æ”¹ <code>GET_USER_TODOS</code> é‡Œæäº¤ mutation çš„æ–¹å¼ï¼ŒåŒæ—¶äº«å—åˆ°ä»£ç æç¤ºï¼š</p><figure><img src="https://i.loli.net/2019/06/18/5d08f24166d5812315.gif" alt="" /><figcaption>è°ƒç”¨ mutator</figcaption></figure><p>å¥½çš„ï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å¸¦æœ‰ç±»å‹é™åˆ¶çš„ç±»ä¼¼äº <code>dispatch</code> çš„å‡½æ•°ï¼Œå¹¶åœ¨åˆ«å¤„è°ƒç”¨ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¸€ä¸ªå¸¦æœ‰ç±»å‹å˜é‡çš„å‡½æ•°ï¼Œä½¿ç”¨ç¤ºä¾‹ todoItemDispatch(actionContext, &#x27;actionName&#x27;, actionName)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> todoItemDispatch = makeDispatcher&lt;TodoContext, ActionDescriptors&gt;(VUEX_NS)<br><br>...<br><br>todoItemDispatch(store, <span class="hljs-string">&#x27;GET_USER_TODOS&#x27;</span>, &#123;&#125;)<br></code></pre></td></tr></table></figure><h3 id="ç„¶åéœ€æ±‚æ”¹äº†">ç„¶åï¼Œéœ€æ±‚æ”¹äº†ï¼</h3><p>æ­¤æ—¶ä½ å†³å®š TodoApp éœ€è¦èƒ½æ”¯æŒå¤šç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰è‡ªå·±çš„è®°å½•ã€‚é‚£ä¹ˆ ACTIONS æ¥å£è¯´æ˜éœ€è¦æ›´æ”¹ï¼š</p><figure class="highlight elm"><table><tr><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">type</span> <span class="hljs-type">ActionDescriptors</span> = &#123;<br>  <span class="hljs-type">GET_USER_TODOS</span>: [&#123; userName: string &#125;, void]<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œåœ¨ä¸Šä¸€èŠ‚æœ€åçš„ <code>todoItemDispatch</code> è°ƒç”¨å¤„ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts">Argument <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span> is not assignable to parameter <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;&#123; userName: string; &#125;&#x27;</span>.<br>  Property <span class="hljs-string">&#x27;userName&#x27;</span> is missing <span class="hljs-keyword">in</span> <span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;&#123;&#125;&#x27;</span> but required <span class="hljs-keyword">in</span> <span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;&#123; userName: string; &#125;&#x27;</span>.ts(<span class="hljs-number">2345</span>)<br>todo.ts(., .): <span class="hljs-string">&#x27;userName&#x27;</span> is declared here.<br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œç°åœ¨å¼€å¿ƒåœ°æ¥åˆ°å‡ºé”™åœ°æ–¹ï¼Œæ”¹ä¸€æ”¹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts">todoItemDispatch(store, <span class="hljs-string">&#x27;GET_USER_TODOS&#x27;</span>, &#123; userName: <span class="hljs-string">&#x27;hikerpig&#x27;</span> &#125;)<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰å…¨å±€æœç´¢ï¼Œä¸ç”¨åšæ— è°“çš„å‚æ•°æ£€æŸ¥å•å…ƒæµ‹è¯•ã€‚</p><h1 id="æ€»ç»“">æ€»ç»“</h1><h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2><ul><li>ä¼˜åŒ–å¼€å‘æ—¶çš„ä½“éªŒ</li><li>ä¸æ”¹å˜åŸå…ˆ actions å’Œ mutations æˆå‘˜å‡½æ•°å®ç°çš„æ–¹å¼ï¼Œä¹Ÿä¸åƒ vuex-typescript å¼•å…¥äº†ä¸€äº›é¢å¤–çš„ class</li></ul><h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2><ul><li>æ¥å£æè¿°çš„ç±»å‹éœ€è¦æå‰å•ç‹¬å£°æ˜ï¼Œæ²¡æ³•ç›´æ¥ä½¿ç”¨å‡½æ•°çš„ç­¾å</li><li>æ²¡æ³•æŠŠæ‰€æœ‰ç±»å‹å¢å¼ºåˆå¹¶ä¸ºä¸€ä¸ªç»Ÿä¸€çš„ <code>dispath</code> å‡½æ•°ï¼Œå…¶ä»–æ–‡ä»¶é‡Œçš„ä»£ç è‹¥æƒ³äº«å—è¿™ä¸ªç±»å‹å¢å¼ºï¼Œå¿…é¡»æ˜¾å¼åœ° import <code>todoItemDispatch</code>/<code>todoItemMutate</code> æ–¹æ³•ï¼Œç•¥å¾®éº»çƒ¦</li></ul>]]></content>
    
    
    <summary type="html">Typescript powered vuex, ä½¿ç”¨ Typescript åŠ å¼º Vuex ä½¿ç”¨ä½“éªŒ</summary>
    
    
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Typescript" scheme="http://hikerpig.github.io/tags/Typescript/"/>
    
    <category term="Vuex" scheme="http://hikerpig.github.io/tags/Vuex/"/>
    
  </entry>
  
  <entry>
    <title>å›¾åƒè¿‘ä¼¼é«˜æ–¯æ¨¡ç³Šçš„å¿«é€Ÿå®ç°ï¼Œä»¥åŠ WebAssembly æ¨¡å—çš„å¯¼å‡º</title>
    <link href="http://hikerpig.github.io/2019/05/13/2019-05-13-Fastblur-implemetation-with-rust/"/>
    <id>http://hikerpig.github.io/2019/05/13/2019-05-13-Fastblur-implemetation-with-rust/</id>
    <published>2019-05-12T16:00:00.000Z</published>
    <updated>2020-03-16T05:26:52.900Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å›¾åƒå¤„ç†è½¯ä»¶ä¸­çš„æ¨¡ç³Šæ»¤é•œä¸€èˆ¬éƒ½ä¼šæœ‰<a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A?oldformat=true">é«˜æ–¯æ¨¡ç³Šï¼ˆGaussian Blurï¼‰</a>ï¼Œå› ä¸ºå®ƒæ•ˆæœæœ€å¥½ï¼Œæ¥è¿‘äººçœ¼çš„æ¨¡ç³Šæ•ˆæœï¼ˆä¹Ÿè®¸æ˜¯ç”±äºæ­£æ€åˆ†å¸ƒçš„æ— å¤„ä¸åœ¨ï¼Ÿï¼‰ã€‚ä½†å¯¹å›¾åƒåšçœŸæ­£çš„é«˜æ–¯æ¨¡ç³Šï¼ˆåœ¨æˆ‘çš„ç†è§£ï¼Œä¹Ÿå³ä½¿ç”¨æ»¡è¶³äºŒé˜¶æ­£æ€åˆ†å¸ƒçš„å·ç§¯æ ¸å¯¹äºŒç»´ç¦»æ•£åˆ†å¸ƒçš„ç©ºé—´åŸŸåšå¹³æ»‘å¤„ç†ï¼‰ï¼Œç”±äºå·ç§¯çš„å®šä¹‰ï¼Œè®¡ç®—é‡é¢‡å¤§ã€‚å¯ä»¥é‡‡ç”¨ä¸€äº›å¿«é€Ÿçš„ç®—æ³•å»æ¨¡æ‹Ÿè¿™ä¸ªæ•ˆæœã€‚</p><h1 id="ä½¿ç”¨ç›’æ¨¡ç³Šæ¨¡æ‹Ÿé«˜æ–¯æ¨¡ç³Š">ä½¿ç”¨ç›’æ¨¡ç³Šæ¨¡æ‹Ÿé«˜æ–¯æ¨¡ç³Š</h1><p>æ ¹æ® <a href="http://blog.ivank.net/fastest-gaussian-blur.html">Photopea ä½œè€…çš„è¿™ä¸ª JS å®ç°</a> å’Œ <a href="http://www.peterkovesi.com/papers/FastGaussianSmoothing.pdf">è®ºæ–‡ ã€ŠFast Almost-Gaussian Filteringã€‹</a>ä¸­çš„è®ºè¯ï¼Œé€šè¿‡å¯¹å›¾åƒè¿›è¡Œå¤šæ¬¡ç›’æ¨¡ç³Šæ“ä½œï¼Œå¯æ¨¡æ‹Ÿé«˜æ–¯æ¨¡ç³Šçš„æ•ˆæœã€‚è®¾ç›’æ¨¡ç³Šæ¬¡æ•°ä¸º nï¼Œå½“ n = 5 æ—¶ï¼Œæ¨¡æ‹Ÿæ•ˆæœå·²è¶³å¤Ÿå¥½ã€‚</p><h2 id="ç›’æ»¤æ³¢-box-filter">ç›’æ»¤æ³¢ Box filter</h2><p>å¹³å‡æ»¤æ³¢ï¼ˆAverage filterï¼‰ï¼Œæˆ–ç§°å‡å€¼æ»¤æ³¢ï¼ˆMean filterï¼‰å·ç§¯æ ¸çš„æ¯ä¸€ç‚¹æƒé‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ2 ç»´æƒ…å†µä¸‹å°±åƒåœ¨å›¾åƒä¸Šæ‰£ç€çš„ä¸€ä¸ªæ–¹ç›’å­ï¼Œæ‰€ä»¥ä¹Ÿç§°ä½œç›’æ»¤æ³¢ã€‚ä¸€ä¸ªè¾¹é•¿ä¸º 3 çš„äºŒç»´ç›’æ»¤æ³¢çš„å·ç§¯æ ¸å¦‚ä¸‹</p><p><br /><span class="math display">$$\left[ \begin{array}{lll}{1} &amp; {1} &amp; {1} \\ {1} &amp; {1} &amp; {1} \\ {1} &amp; {1} &amp; {1}\end{array}\right]$$</span><br /></p><p>ä¸ºä»€ä¹ˆä½¿ç”¨ç›’æ»¤æ³¢å‘¢ï¼Ÿé™¤äº†å®ç°ç®€å•ä»¥å¤–ï¼Œè¿˜æœ‰æ€§èƒ½ä¸Šçš„è€ƒé‡ã€‚ç”±äºæƒé‡ç›¸åŒï¼Œä½¿ç”¨ç›’æ»¤æ³¢æ—¶æœ‰ä¸€ä¸ªå¯çˆ±çš„ç‰¹æ€§èƒ½ä½¿å¾—è®¡ç®—å˜å¾—æ›´åŠ å¿«é€Ÿï¼šå¯¹å›¾åƒåœ¨æ°´å¹³æ–¹å‘è¿›è¡Œä¸€æ¬¡ä¸€ç»´å¹³å‡æ»¤æ³¢ï¼Œå†åœ¨å‚ç›´æ–¹å‘è¿›è¡Œä¸€æ¬¡ï¼Œç­‰ä»·äºå¯¹æ•´ä¸ªå›¾ç‰‡åšä¸€æ¬¡äºŒç»´ç›’æ»¤æ³¢ã€‚</p><h2 id="è®ºæ–‡çš„å¤§æ¦‚æ“ä½œæ€è·¯">è®ºæ–‡çš„å¤§æ¦‚æ“ä½œæ€è·¯</h2><p>è®ºæ–‡çš„è®ºè¯ç›®æ ‡åŸºæœ¬ä¸Šä¸ºï¼šéœ€è¦æ‰§è¡Œ<strong>å¤šå°‘æ¬¡</strong>ç›’æ»¤æ³¢ï¼Œä»¥åŠæ¯ä¸€æ¬¡çš„<strong>æ»¤æ³¢å®½åº¦</strong>éœ€è¦æ˜¯å¤šå°‘ï¼Œæ‰èƒ½å¤Ÿæ¨¡æ‹Ÿå‡ºè¿‘ä¼¼äºé«˜æ–¯æ»¤æ³¢å™¨çš„<strong>æ ‡å‡†å·®</strong>ã€‚</p><p>é¦–å…ˆç›’æ»¤æ³¢æœ‰ä¸€äº›ç‰¹æ€§ï¼šå¯¹äºå›¾åƒç»è¿‡ n æ¬¡ç›’æ»¤æ³¢åï¼Œæ ‡å‡†å·®å¦‚ä¸‹ï¼Œå…¶ä¸­ <span class="math inline"><em>w</em></span> ä¸ºæ»¤æ³¢å™¨å®½åº¦ã€‚</p><p><br /><span class="math display">$$\sigma_{n a v}=\sqrt{\frac{n w^{2}-n}{12}}$$</span><br /></p><p>é‚£ä¹ˆä¸ºäº†ä½¿å¾—æ ‡å‡†å·®ä¸é«˜æ–¯æ»¤æ³¢ç›¸åŒï¼Œç†æƒ³çš„æ»¤æ³¢å™¨å®½åº¦ <span class="math inline"><em>w</em><sub><em>i</em><em>d</em><em>e</em><em>a</em><em>l</em></sub></span> æ±‚æ³•ï¼š</p><p><br /><span class="math display">$$w_{i d e a l}=\sqrt{\frac{12 \sigma^{2}}{n}+1}$$</span><br /></p><p>å¯¹äºå›¾åƒæ»¤æ³¢æ¥è¯´ï¼Œw éœ€è¦æ˜¯æ•´æ•°ï¼Œä¸”æœ€å¥½æ˜¯å¥‡æ•°ï¼Œå¦‚æ­¤ä¸€æ¥æ€»ä¼šæœ‰ä¸€ä¸ªä¸­å¿ƒç‚¹çš„åƒç´ å€¼å¯ä»¥è¢«æŒ‡å®šã€‚äºæ˜¯åœ¨ç†æƒ³å®½åº¦é™„è¿‘æ‰¾åˆ°ä¸¤ä¸ªå¥‡æ•°ï¼Œ<span class="math inline"><em>w</em><sub><em>l</em></sub>â€„&lt;â€„<em>w</em><sub><em>i</em><em>d</em><em>e</em><em>a</em><em>l</em></sub>â€„&lt;â€„<em>w</em><sub><em>u</em></sub></span>ï¼Œåˆ†åˆ«ä¸ºä¸‹é™(l)å’Œä¸Šé™(u)ï¼Œæ˜¾ç„¶ <span class="math inline"><em>w</em><sub><em>l</em></sub>â€…+â€…2â€„=â€„<em>w</em><sub><em>u</em></sub></span>ã€‚æ¥ä¸‹æ¥è¦è¿›è¡Œ n æ¬¡å¹³å‡æ»¤æ³¢ï¼Œè®¾ c ä¸ºå½“å‰æ»¤æ³¢çš„è½®æ•°ï¼Œä» 1 å¼€å§‹ï¼Œåœ¨ <span class="math inline">0â€„&lt;â€„<em>c</em>â€„&lt;â€„â€„=â€„<em>m</em></span> æ—¶ï¼Œæ»¤æ³¢å™¨å®½åº¦ä¸º <span class="math inline"><em>w</em><sub><em>l</em></sub></span>ï¼Œåœ¨ <span class="math inline"><em>m</em>â€„&lt;â€„<em>c</em>â€„&lt;â€„â€„=â€„<em>n</em></span> æ—¶ï¼Œæ»¤æ³¢å™¨å®½åº¦ä¸º <span class="math inline"><em>w</em><sub><em>u</em></sub></span>ã€‚</p><p><br /><span class="math display">$$\begin{aligned} \sigma &amp;=\sqrt{\frac{m w_{l}^{2}+(n-m) w_{u}^{2}-n}{12}} \\ &amp;=\sqrt{\frac{m w_{l}^{2}+(n-m)\left(w_{l}+2\right)^{2}-n}{12}} \end{aligned}$$</span><br /></p><p>å› æ­¤ç®—å‡º m:</p><p><br /><span class="math display">$$m=\frac{12 \sigma^{2}-n w_{l}^{2}-4 n w_{l}-3 n}{-4 w_{l}-4}$$</span><br /></p><h1 id="å¼€å‘å’Œä½¿ç”¨-webassembly">å¼€å‘å’Œä½¿ç”¨ WebAssembly</h1><p>æˆ‘ä»¬åŸºäº github ä¸Šç”¨ rust å†™çš„ä¸€ä¸ªå®ç°ï¼Œç»§ç»­å¡«å……ä¸€äº›ç»†èŠ‚ï¼Œå®Œæˆäº† <a href="https://github.com/bestminr/fastblur">fastblur</a> è¿™ä¸ªæ¨¡å—ã€‚</p><p>è€ƒè™‘åˆ°ä¸­é—´æ¶‰åŠå¤§é‡è¿ç®—ï¼Œä½¿ç”¨ WebAssembly åº”è¯¥æ¯”çº¯ js æ›´å¿«ç‚¹ã€‚ä½¿ç”¨ rust å’Œ <a href="https://crates.io/crates/image">image crate</a> ä½¿å¾—ç®—æ³•éªŒè¯å’Œè°ƒè¯•è¾“å‡ºèƒ½å¿«é€Ÿè¿›è¡Œï¼ŒåŒæ—¶ rust æœ‰ç€ç›®å‰ç¼–è¯‘åˆ° WebAssembly æœ€ä½³çš„å·¥å…·é“¾ <a href="https://github.com/rustwasm/wasm-pack">wasm-pack</a>ï¼ˆæ¯•ç«Ÿè¿™ä¿©éƒ½æ˜¯ Mozilla åœ¨ç§¯ææ¨è¡Œçš„æ ‡å‡†ï¼‰ã€‚</p><h2 id="åœ¨-typescript-webpack-é¡¹ç›®ä¸­å¼•å…¥å’Œä½¿ç”¨">åœ¨ Typescript + Webpack é¡¹ç›®ä¸­å¼•å…¥å’Œä½¿ç”¨</h2><p>ç¡®ä¿ <code>tsconfig.json</code> ä¸­çš„ <code>compilerOptions.module: esnext</code>ï¼Œæ‰èƒ½æ–¹ä¾¿åœ°ä½¿ç”¨ <code>import().then()</code>ã€‚</p><figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyFastBlur</span>(<span class="hljs-params">imageData: ImageData, blurRadius: <span class="hljs-built_in">number</span></span>): <span class="hljs-title">Bluebird</span>&lt;<span class="hljs-title">ImageData</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@bestminr/fastblur&#x27;</span>)<br>      .then(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> &#123; width, height &#125; = imageData<br>        <span class="hljs-keyword">const</span> inputDataArr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(imageData.data)<br>        m.do_fast_blur(inputDataArr, width, height, blurRadius)<br>        <span class="hljs-keyword">const</span> outputImageData = <span class="hljs-keyword">new</span> ImageData(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8ClampedArray</span>(inputDataArr), width, height)<br>        <span class="hljs-keyword">return</span> resolve(outputImageData)<br>      &#125;).catch(reject)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒ">å‚è€ƒ</h2><ul><li><a href="http://blog.ivank.net/fastest-gaussian-blur.html">Fastest Gaussian Blur (in linear time)</a></li><li>http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf</li><li><a href="http://www.peterkovesi.com/papers/FastGaussianSmoothing.pdf">FastGaussianSmoothing è®ºæ–‡</a></li><li>https://stackoverflow.com/questions/1696113/how-do-i-gaussian-blur-an-image-without-using-any-in-built-gaussian-functions</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨å›¾åƒå¤„ç†è½¯ä»¶ä¸­çš„æ¨¡ç³Šæ»¤é•œä¸€èˆ¬éƒ½ä¼šæœ‰&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A?oldformat=true&quot;&gt;é«˜æ–¯æ¨¡ç³Šï¼ˆGaussian Blurï¼‰&lt;/a&gt;ï¼Œå› ä¸ºå®ƒ</summary>
      
    
    
    
    <category term="å›¾åƒå¤„ç†" scheme="http://hikerpig.github.io/categories/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
    
    <category term="WebAssembly" scheme="http://hikerpig.github.io/tags/WebAssembly/"/>
    
    <category term="Rust" scheme="http://hikerpig.github.io/tags/Rust/"/>
    
    <category term="å›¾åƒå¤„ç†" scheme="http://hikerpig.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ d8 å¿«é€Ÿæµ‹è¯• WebAssembly æ¨¡å—æ€§èƒ½</title>
    <link href="http://hikerpig.github.io/2019/05/05/2019-05-05-Benchmark-WASM-with-d8/"/>
    <id>http://hikerpig.github.io/2019/05/05/2019-05-05-Benchmark-WASM-with-d8/</id>
    <published>2019-05-04T16:00:00.000Z</published>
    <updated>2019-05-07T03:09:36.652Z</updated>
    
    <content type="html"><![CDATA[<p>d8 æ˜¯ v8 çš„ç®€æ˜“ CLIï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæç®€çš„ JS å®¿ä¸»ç¯å¢ƒï¼Œå¯ç”¨äº v8 çš„å­¦ä¹ å’Œè°ƒè¯•ï¼Œæ¯”èµ· nodejsï¼Œå®ƒæ›´ç²¾ç®€å’Œä¸“æ³¨ã€‚</p><p>é™¤äº† JS ä»¥å¤–ï¼Œd8 ä¹Ÿå…·æœ‰ WASM çš„è§£é‡ŠåŠŸèƒ½ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç”¨äºæµ‹è¯• WASM æ¨¡å—çš„æ€§èƒ½ã€‚å¦‚æœä½ çš„ WASM æ˜¯è¦åœ¨æµè§ˆå™¨é‡Œè¿è¡Œçš„ï¼Œæ¯”èµ· wasmtimeï¼Œv8ï¼ˆä»¥åŠ spidermonkey ç­‰ä¸»æµæµè§ˆå™¨ JS å¼•æ“ï¼‰æ˜¾ç„¶æ˜¯ä¸ªæ›´åˆé€‚çš„å‘½ä»¤è¡Œæµ‹è¯•æ–¹æ¡ˆã€‚</p><h2 id="å®‰è£…-v8">å®‰è£… v8</h2><h3 id="ä½¿ç”¨åŒ…ç®¡ç†å™¨">ä½¿ç”¨åŒ…ç®¡ç†å™¨</h3><figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">brew </span><span class="hljs-keyword">install </span>v8<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-jsvu">ä½¿ç”¨ jsvu</h3><p><a href="https://github.com/GoogleChromeLabs/jsvu">jsvu</a> æ˜¯ GoogleChromeLabs å‡ºå“çš„ä¸€ä¸ªå·¥å…·, å¯ä»¥å¿«é€Ÿå®‰è£…å¤šä¸ªä¸»æµ JS å¼•æ“(spidermonkey/v8/chakra/javascriptcore)ã€‚ä¸è¿‡ç”¨å®ƒå®‰è£…çš„ CLI åå­—æ˜¯ <code>v8</code>ã€‚</p><h2 id="ä½¿ç”¨ä¾‹å­">ä½¿ç”¨ä¾‹å­</h2><p>ä¸åŒäº nodejs çš„æ¨¡å—ç³»ç»Ÿå’Œåº“å‡½æ•°ï¼Œd8 æä¾›ç»™è„šæœ¬çš„å…¨å±€å‡½æ•°å¾ˆå…‹åˆ¶ã€‚<a href="https://v8.dev/docs/d8">ç®€æ˜“çš„æ–‡æ¡£</a>è¯´æ˜äº†å‡ ä¸ªï¼Œå¦‚ç›´æ¥ä½¿ç”¨ <code>load()</code> åŠ è½½å’Œæ‰§è¡Œå¤–éƒ¨è„šæœ¬è‡³å½“å‰ä¸Šä¸‹æ–‡ï¼Œæˆ–æ˜¯ä½¿ç”¨ <code>read()</code> è¯»å–æ–‡ä»¶å†…å®¹ã€‚</p><p>é™¤äº†çœ‹æ–‡æ¡£å¤–ï¼Œè¿˜å¯ä»¥å»æŸ¥çœ‹ <a href="https://chromium.googlesource.com/v8/v8/+/master/src/d8.cc">d8.cc æºç </a> è·çŸ¥ d8 script æ”¯æŒçš„å…¨éƒ¨å…¨å±€æ–¹æ³•ã€‚</p><p>å¯ä½¿ç”¨ <code>readbuffer()</code> æ–¹æ³•è·å– WASM äºŒè¿›åˆ¶å†…å®¹ã€‚</p><p>å‡å¦‚ç”¨ rust ç¼–è¯‘å‡ºäº†ä¸€ä¸ª <code>rotate.wasm</code> æ¨¡å— ï¼Œå¯¼å‡ºäº†ä¸€ä¸ªç®€å•æ–¹æ³• <code>rotate_90</code>ï¼Œç”¨äºå°†å›¾ç‰‡æ—‹è½¬ 90 åº¦ã€‚</p><figure class="highlight rust"><table><tr><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">rotate_90</span></span>(width: <span class="hljs-built_in">usize</span>, height: <span class="hljs-built_in">usize</span>, image_data_ptr: *<span class="hljs-keyword">mut</span> <span class="hljs-built_in">u8</span>)<br></code></pre></td></tr></table></figure><p>ç®€å•çš„æµ‹è¯•è„šæœ¬ <code>benchmark.js</code> å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> iterTimes = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">const</span> imageDimensions = <span class="hljs-number">4096</span>;<br><span class="hljs-keyword">const</span> iterations = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(iterTimes);<br><br><span class="hljs-keyword">const</span> imageByteSize = imageDimensions * imageDimensions * <span class="hljs-number">4</span>;<br><span class="hljs-keyword">const</span> wasmPageSize = <span class="hljs-number">64</span> * <span class="hljs-number">1024</span>;<br><br><span class="hljs-keyword">const</span> buffer = readbuffer(<span class="hljs-string">&quot;rotate.wasm&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; instance &#125; = <span class="hljs-keyword">await</span> WebAssembly.instantiate(buffer);<br><br><span class="hljs-keyword">const</span> pagesAvailable = <span class="hljs-built_in">Math</span>.floor(<br>instance.exports.memory.buffer.byteLength / wasmPageSize<br>);<br><span class="hljs-keyword">const</span> pagesNeeded = <span class="hljs-built_in">Math</span>.floor((imageByteSize * <span class="hljs-number">2</span> + <span class="hljs-number">4</span>) / wasmPageSize) + <span class="hljs-number">1</span>;<br><span class="hljs-keyword">const</span> additionalPagesNeeded = pagesNeeded - pagesAvailable;<br><span class="hljs-keyword">if</span> (additionalPagesNeeded &gt; <span class="hljs-number">0</span>) &#123;<br>instance.exports.memory.grow(additionalPagesNeeded);<br>&#125;<br><br><span class="hljs-keyword">const</span> imageData = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(imageByteSize)<br><br>print(<span class="hljs-string">`==============================`</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterTimes; i++) &#123;<br>  <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8ClampedArray</span>(instance.exports.memory.buffer);<br>  <span class="hljs-keyword">const</span> dataPtr = <span class="hljs-number">8</span>;<br>  view.set(imageData.data, dataPtr);<br><br>  <span class="hljs-keyword">const</span> start = <span class="hljs-built_in">Date</span>.now();<br>  instance.exports.rotate_90(imageDimensions, imageDimensions, dataPtr);<br>  iterations[i] = <span class="hljs-built_in">Date</span>.now() - start;<br>&#125;<br><span class="hljs-keyword">const</span> average = iterations.reduce(<span class="hljs-function">(<span class="hljs-params">sum, c</span>) =&gt;</span> sum + c) / iterations.length;<br><span class="hljs-keyword">const</span> stddev = <span class="hljs-built_in">Math</span>.sqrt(<br>  iterations<br>    .map(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> <span class="hljs-built_in">Math</span>.pow(i - average, <span class="hljs-number">2</span>))<br>    .reduce(<span class="hljs-function">(<span class="hljs-params">sum, c</span>) =&gt;</span> sum + c) / iterations.length<br>);<br>print(<span class="hljs-string">`n = <span class="hljs-subst">$&#123;iterations.length&#125;</span>`</span>);<br>print(<span class="hljs-string">`Average: <span class="hljs-subst">$&#123;average&#125;</span>`</span>);<br>print(<span class="hljs-string">`StdDev: <span class="hljs-subst">$&#123;stddev&#125;</span>`</span>);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ d8 è¿è¡Œè„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">d8 benchmark.js<br></code></pre></td></tr></table></figure><p>ç»“æœæ‰“å°å‡ºå¹³å‡æ—¶é—´å’Œæ–¹å·®ï¼š</p><figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">==============================</span><br><span class="hljs-string">n</span> <span class="hljs-string">=</span> <span class="hljs-number">10</span><br><span class="hljs-attr">Average:</span> <span class="hljs-number">45.8</span><br><span class="hljs-attr">StdDev:</span> <span class="hljs-number">19.75246820020222</span><br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒ">å‚è€ƒ</h2><p>Squoosh é¡¹ç›®çš„ <a href="https://github.com/GoogleChromeLabs/squoosh/blob/master/codecs/rotate/rotate.rs">codecs/rotate</a> æ¨¡å—ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;d8 æ˜¯ v8 çš„ç®€æ˜“ CLIï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæç®€çš„ JS å®¿ä¸»ç¯å¢ƒï¼Œå¯ç”¨äº v8 çš„å­¦ä¹ å’Œè°ƒè¯•ï¼Œæ¯”èµ· nodejsï¼Œå®ƒæ›´ç²¾ç®€å’Œä¸“æ³¨ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† JS ä»¥å¤–ï¼Œd8 ä¹Ÿå…·æœ‰ WASM çš„è§£é‡ŠåŠŸèƒ½ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç”¨äºæµ‹è¯• WASM æ¨¡å—çš„æ€§èƒ½ã€‚å¦‚æœä½ çš„ WASM æ˜¯è¦åœ¨æµè§ˆ</summary>
      
    
    
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="WebAssembly" scheme="http://hikerpig.github.io/tags/WebAssembly/"/>
    
    <category term="Benchmark" scheme="http://hikerpig.github.io/tags/Benchmark/"/>
    
    <category term="V8" scheme="http://hikerpig.github.io/tags/V8/"/>
    
  </entry>
  
  <entry>
    <title>Handy Video Analyze Tool</title>
    <link href="http://hikerpig.github.io/2019/03/14/2019-03-13-Handy-Video-Analyze-Tool/"/>
    <id>http://hikerpig.github.io/2019/03/14/2019-03-13-Handy-Video-Analyze-Tool/</id>
    <published>2019-03-13T16:00:00.000Z</published>
    <updated>2019-05-25T05:34:27.181Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å†™ä¸€äº›è·Ÿè§†é¢‘è§£ç ç›¸å…³çš„ç®€å•ç¨‹åºï¼Œå­¦ä¹  avcodec æŠ€æœ¯æ—¶æœ‰ä¸€äº›å¼ºå¤§çš„åˆ†æå·¥å…·ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚</p><h1 id="ç æµä¸å°è£…å®¹å™¨ç›¸å…³">ç æµä¸å°è£…å®¹å™¨ç›¸å…³</h1><h2 id="iso-viewer">ISO Viewer</h2><p><a href="https://github.com/sannies/isoviewer">isoviewer</a> æ˜¯ Mac ä¸‹ä¸€ä¸ªæ£€æŸ¥ mp4 æ–‡ä»¶æ„æˆçš„ GUI ç¨‹åºï¼Œèƒ½ç›´è§‚åœ°çœ‹åˆ°å„ä¸ª box çš„æ•°æ®ã€‚</p><img src="//images-hikerpig.oss-cn-beijing.aliyuncs.com/image/iso-viewer.png" alt="undefined" title="undefined"><h2 id="bento4">bento4</h2><p><a href="https://www.bento4.com/">bento4</a> æ˜¯ä¸€å¥—ä¸“ç”¨äº mp4 æ ¼å¼æ–‡ä»¶åˆ†æå’Œç¼–è¾‘çš„ SDKï¼Œæ”¯æŒçš„åŠŸèƒ½éå¸¸å¤šã€‚</p><table><colgroup><col style="width: 11%" /><col style="width: 88%" /></colgroup><thead><tr class="header"><th>å·¥å…·</th><th>ç”¨é€”</th></tr></thead><tbody><tr class="odd"><td>mp4info</td><td>displays high level info about an MP4 file, including all tracks and codec details</td></tr><tr class="even"><td>mp4dump</td><td>displays the entire atom/box structure of an MP4 file</td></tr><tr class="odd"><td>mp4edit</td><td>add/insert/remove/replace atom/box items of an MP4 file</td></tr><tr class="even"><td>mp4extract</td><td>extracts an atom/box from an MP4 file</td></tr><tr class="odd"><td>mp4encrypt</td><td>encrypts an MP4 file (multiple encryption schemes are supported)</td></tr><tr class="even"><td>mp4decrypt</td><td>decrypts an MP4 file (multiple encryption schemes are supported)</td></tr><tr class="odd"><td>mp4dcfpackager</td><td>encrypts a media file into an OMA DCF file</td></tr><tr class="even"><td>mp4compact</td><td>converts 'stsz' tables into 'stz2' tables to create more compact MP4 files</td></tr><tr class="odd"><td>mp4fragment</td><td>creates a fragmented MP4 file from a non-fragmented one.</td></tr><tr class="even"><td>mp4split</td><td>splits a fragmented MP4 file into discrete files</td></tr><tr class="odd"><td>mp4tag</td><td>show/edit MP4 metadata (iTunes-style and others)</td></tr><tr class="even"><td>mp4mux</td><td>multiplexes one or more elementary streams (H264/AVC, H265/HEVC, AAC) into an MP4 file</td></tr><tr class="odd"><td>mp42aac</td><td>extract a raw AAC elementary stream from an MP4 file</td></tr><tr class="even"><td>mp42avc</td><td>extract a raw AVC/H.264 elementary stream from an MP4 file</td></tr><tr class="odd"><td>mp42hls</td><td>converts an MP4 file to an HLS (HTTP Live Streaming) presentation, including the generation of the segments and .m3u8 playlist as well as AES-128 and SAMPLE-AES (for Fairplay) encryption. This can be used as a replacement for Apple's mediafilesegmenter tool.</td></tr><tr class="even"><td>mp42ts</td><td>converts an MP4 file to an MPEG2-TS file.</td></tr><tr class="odd"><td>mp4dash</td><td>creates an MPEG DASH output from one or more MP4 files, including encryption. This is a full-featured MPEG DASH packager.</td></tr><tr class="even"><td>mp4dashclone</td><td>creates a local clone of a remote or local MPEG DASH presentation, optionally encrypting the segments as they are cloned.</td></tr><tr class="odd"><td>mp4hls</td><td>creates a multi-bitrate HLS master playlist from one or more MP4 files, including support for encryption and I-frame-only playlists. This tool uses the 'mp42hls' low level tool internally, so all the options supported by that low level tool are also available. This can be used as a replacement for Apple's variantplaylistcreator tool.</td></tr></tbody></table><h2 id="gpac">GPAC</h2><p><a href="https://gpac.wp.imt.fr/">GPAC</a> æ˜¯ä¸€ä¸ªä¸ºç§‘ç ”å’Œå­¦æœ¯é¢†åŸŸå¼€å‘çš„å¤šåª’ä½“çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬å‡ ä¸ªè§†é¢‘åˆ†æå’Œç æµç¼–è¾‘çš„ CLI å·¥å…·ã€‚å®˜ç½‘ä¸»è¦ feature å¦‚ä¸‹:</p><blockquote><p>GPAC features encoders and multiplexers, publishing and content distribution tools for MP4 and 3GPP or 3GPP2 files and many tools for scene descriptions (BIFS/VRML/X3D converters, SWF/BIFS, SVG/BIFS, etcâ€¦). MP4Box provides all these tools in a single command-line application. An exhaustive list of packaging features is available here but a good summary of what MP4Box can do for you is the following:</p><ul><li>MP4/3GP Conversion from MP3, AVI, MEPG-2 TS, MPEG-PS, AAC, H263, H264, AMR, and many others,</li><li>3GPP DIMS Packaging from SVG files,</li><li>File layout: fragmentation or interleaving, and cleaning,</li><li>File hinting for RTP/RTSP and QTSS/DSS servers (MPEG-4 / ISMA / 3GP / 3GP2 files),</li><li>File splitting by size or time, extraction from file and file concatenation,</li><li>XML information dumping for MP4 and RTP hint tracks,</li><li>Media Track extractions,</li><li>ISMA E&amp;A encryption and decryption,</li><li>3GPP timed text tools (SUB/SRT/TTXT/TeXML), VobSub import/export,</li><li>BIFS codec and scene conversion between MP4, BT and XMT-A,</li><li>LASeR codec and scene conversion between MP4, SAF, SVG and XSR (XML LASeR),</li><li>XML scene statistics for BIFS scene (BT, XMT-A and MP4),</li><li>Conversion to and from BT, XMT-A, WRL, X3D and X3DV with support for gzip.</li><li>Preparing MP4,3GP and MPEG-2 TS files for DASH streaming</li></ul></blockquote><p>ä¸»è¦ä½¿ç”¨çš„å¯èƒ½æ˜¯ <code>MP4Box</code> å·¥å…·ï¼ŒåŠŸèƒ½å¾ˆå¤šï¼Œå‡ ä¸ªä¾‹å­:</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">MP4Box -add file.av1 file_av1.mp4 <span class="hljs-comment"># å°† av1 ç æµå°è£…å†™å…¥ mp4 æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h2 id="ffprobe">ffprobe</h2><p>å¤§åé¼é¼çš„ ffmpeg é¡¹ç›®ä¸€å‘˜ï¼Œä¸€èº«<a href="https://ffmpeg.org/ffprobe.html">æŠ€èƒ½å’Œ API å‚æ•°</a>ã€‚</p><p>å…¶ä¸­ä¸€ä¸ªç”¨æ³•æ˜¯ dump å‡ºæ‰€æœ‰çš„ frame:</p><figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ffprobe</span> -show_frames some.mp<span class="hljs-number">4</span> &gt; probe-mp<span class="hljs-number">4</span>.txt<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[FRAME]</span><br><span class="hljs-attr">media_type</span>=video<br><span class="hljs-attr">stream_index</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">key_frame</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">pkt_pts</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">pkt_pts_time</span>=<span class="hljs-number">0.000000</span><br><span class="hljs-attr">pkt_dts</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">pkt_dts_time</span>=<span class="hljs-number">0.000000</span><br><span class="hljs-attr">best_effort_timestamp</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">best_effort_timestamp_time</span>=<span class="hljs-number">0.000000</span><br><span class="hljs-attr">pkt_duration</span>=<span class="hljs-number">512</span><br><span class="hljs-attr">pkt_duration_time</span>=<span class="hljs-number">0.040000</span><br><span class="hljs-attr">pkt_pos</span>=<span class="hljs-number">48</span><br><span class="hljs-attr">pkt_size</span>=<span class="hljs-number">27979</span><br><span class="hljs-attr">width</span>=<span class="hljs-number">320</span><br><span class="hljs-attr">height</span>=<span class="hljs-number">564</span><br><span class="hljs-attr">pix_fmt</span>=yuv420p<br><span class="hljs-attr">sample_aspect_ratio</span>=N/A<br><span class="hljs-attr">pict_type</span>=I<br><span class="hljs-attr">coded_picture_number</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">display_picture_number</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">interlaced_frame</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">top_field_first</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">repeat_pict</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">color_range</span>=unknown<br><span class="hljs-attr">color_space</span>=unknown<br><span class="hljs-attr">color_primaries</span>=unknown<br><span class="hljs-attr">color_transfer</span>=unknown<br><span class="hljs-attr">chroma_location</span>=left<br><span class="hljs-section">[/FRAME]</span><br><span class="hljs-section">[FRAME]</span><br><span class="hljs-attr">media_type</span>=audio<br><span class="hljs-attr">stream_index</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">key_frame</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">pkt_pts</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">pkt_pts_time</span>=<span class="hljs-number">0.000000</span><br><span class="hljs-attr">pkt_dts</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">pkt_dts_time</span>=<span class="hljs-number">0.000000</span><br><span class="hljs-attr">best_effort_timestamp</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">best_effort_timestamp_time</span>=<span class="hljs-number">0.000000</span><br><span class="hljs-attr">pkt_duration</span>=<span class="hljs-number">1024</span><br><span class="hljs-attr">pkt_duration_time</span>=<span class="hljs-number">0.021333</span><br><span class="hljs-attr">pkt_pos</span>=<span class="hljs-number">28243</span><br><span class="hljs-attr">pkt_size</span>=<span class="hljs-number">6</span><br><span class="hljs-attr">sample_fmt</span>=fltp<br><span class="hljs-attr">nb_samples</span>=<span class="hljs-number">1024</span><br><span class="hljs-attr">channels</span>=<span class="hljs-number">2</span><br><span class="hljs-attr">channel_layout</span>=stereo<br><span class="hljs-section">[/FRAME]</span><br></code></pre></td></tr></table></figure><h1 id="äºŒè¿›åˆ¶æ˜¾ç¤ºç¼–è¾‘">äºŒè¿›åˆ¶æ˜¾ç¤º/ç¼–è¾‘</h1><h2 id="hex-fiend">Hex Fiend</h2><p><a href="https://github.com/ridiculousfish/HexFiend">Hex Fiend</a>, Mac ä¸‹çš„ hex ç¼–è¾‘ GUI å·¥å…·ï¼Œæ”¯æŒæŒ‰æ–‡æœ¬æˆ–hexæœç´¢/ç¼–è¾‘/diffï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚</p><figure><img src="https://raw.githubusercontent.com/ridiculousfish/HexFiend/master/docs/screenshot.png" alt="" /><figcaption>HexFiend</figcaption></figure><h2 id="hexyl">hexyl</h2><p><a href="https://github.com/sharkdp/hexyl">hexyl</a> ï¼Œä¸€ä¸ªè½»é‡ CLI æŸ¥çœ‹äºŒè¿›åˆ¶æ•°æ®çš„å·¥å…·ï¼Œç”¨ rust ç¼–å†™ã€‚ä¼˜ç‚¹æ˜¯å¿«é€Ÿï¼Œå¥½çœ‹ã€‚</p><figure><img src="https://camo.githubusercontent.com/1f71ee7031e1962b23f21c8cc89cb837e1201238/68747470733a2f2f692e696d6775722e636f6d2f4d574f3975534c2e706e67" alt="" /><figcaption>hexyl æ•ˆæœå›¾</figcaption></figure>]]></content>
    
    
    <summary type="html">åˆ†äº«ä¸€äº›å­¦ä¹  avcodec æŠ€æœ¯æ—¶å¥½ç”¨çš„åˆ†æå·¥å…·</summary>
    
    
    
    <category term="å·¥å…·" scheme="http://hikerpig.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="video" scheme="http://hikerpig.github.io/tags/video/"/>
    
  </entry>
  
  <entry>
    <title>Decode Video Using ffmpeg In Browser</title>
    <link href="http://hikerpig.github.io/2019/03/06/2019-03-06-Decode-Video-Using-FFMpeg-In-Browser/"/>
    <id>http://hikerpig.github.io/2019/03/06/2019-03-06-Decode-Video-Using-FFMpeg-In-Browser/</id>
    <published>2019-03-05T16:00:00.000Z</published>
    <updated>2020-02-15T04:22:23.566Z</updated>
    
    <content type="html"><![CDATA[<p>éŸ³è§†é¢‘å¼€å‘å…¥é—¨ï¼Œå¯èƒ½ç»•ä¸å¼€ ffmpeg è¿™ä¸ªé¡¹ç›®ï¼Œæœ€è¿‘çœ‹äº†ç¯‡ <a href="https://zhuanlan.zhihu.com/p/40786748">çŸ¥ä¹ä¸“æ </a>ï¼Œè§‰å¾—è¿™ä¸ªäº‹æƒ…å¾ˆæœ‰æ„æ€ã€‚</p><p>æ¯”èµ·ç›´æ¥ç¼–è¾‘æ•´ä¸ª ffmpeg é¡¹ç›®çš„ CLI åˆ°å‰ç«¯ï¼Œæ›´ç¬¦åˆå®é™…éœ€æ±‚çš„æ–¹å¼ï¼Œæ˜¯å…ˆåŸºäº ffmpeg å„ç§ lib äºŒæ¬¡å¼€å‘å‡ºåˆé€‚çš„åŠŸèƒ½ï¼Œæ­¤æ—¶ç»“æœæ˜¯å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ lldb æˆ–è€… gdb è°ƒè¯•ã€‚ç„¶åå†ä½¿ç”¨ Emscripten ç¼–è¯‘åˆ° Webassemblyï¼Œå¦‚æ­¤ä¸€æ¥å¯ä»¥è§£å†³ wasm ä¸æ˜“è°ƒè¯•çš„é—®é¢˜ã€‚</p><p>è·Ÿç€æ•™ç¨‹å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼šè§£æå‡ºè§†é¢‘ä»»æ„ä¸€å¸§çš„å›¾åƒå¹¶ç»˜åˆ¶åˆ° canvas ä¸Šã€‚</p><h2 id="web-demo-åº”ç”¨æµç¨‹">Web demo åº”ç”¨æµç¨‹</h2><p>demo é¡µçš„ç®€å•æµç¨‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><code class="hljs mermaid">graph TD<br>    P1[è·å–è§†é¢‘ buffer å¹¶å†™å…¥wasmå°†è¦ä½¿ç”¨çš„çº¿æ€§å†…å­˜ç©ºé—´] -- è¿›å…¥wasmè°ƒç”¨ --&gt; A<br><br>subgraph C ç¨‹åºè½¬æˆçš„ wasm<br>    A[avcodec è§£æè§†é¢‘æ–‡ä»¶ buffer] --&gt; B[è§£å‡ºæŒ‡å®šæ—¶é—´çš„å›¾åƒå¹¶è½¬æˆ RGB æ ¼å¼æ•°æ®]<br>    B --&gt; C[å°†å›¾åƒç­‰æ•°æ®å†™å…¥å†…å­˜, å¹¶å°†æŒ‡é’ˆè¿”ç»™ js ç«¯]<br>end<br><br>    C  -- å›åˆ° js --&gt;  D[æ ¹æ®æŒ‡é’ˆè¯»å‡ºæ•°æ®, æ„å»º ImageData, ç»˜åˆ¶åˆ° canvas ä¸Š]<br></code></pre></td></tr></table></figure><h2 id="ä»æºç ç¼–è¯‘-ffmpeg">ä»æºç ç¼–è¯‘ ffmpeg</h2><p>æœ¬æ–‡å†™å°±çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ ffmpeg <code>n4.2-dev</code> ç‰ˆï¼Œå°†å…¶æºç ç½®äºé¡¹ç›®ç›¸å¯¹ç›®å½• <code>lib/ffmpeg</code> ä¸‹ã€‚</p><p>ffmpeg æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é¡¹ç›®ï¼ŒåŒ…å«çš„å¾ˆå¤šåŠŸèƒ½å¯¹äºæˆ‘ä»¬çš„éœ€æ±‚æ¥è¯´ï¼Œéƒ½ç”¨ä¸ä¸Šï¼Œå¯ä»¥é€šè¿‡ <a href="https://github.com/FFmpeg/FFmpeg/blob/master/configure">configure</a> é…ç½®ç•™ä¸‹åˆé€‚çš„åŠŸèƒ½é›†ã€‚è¿™ä¸ªå…¶å®å°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„ sh è„šæœ¬ï¼Œæ¯”è¾ƒå¤æ‚çš„é¡¹ç›®ï¼Œé€šå¸¸åœ¨å®é™…ç¼–è¯‘ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ configure æ ¹æ®å‚æ•°å’Œç¯å¢ƒç”Ÿæˆå®é™…ç¼–è¯‘è¿‡ç¨‹éœ€è¦çš„ Makefileã€‚</p><h3 id="é¡¹ç›®-makefile">é¡¹ç›® Makefile</h3><p>å‚è€ƒ <a href="https://github.com/Kagami/ffmpeg.js/">ffmpeg.js</a> é¡¹ç›®çš„ä¸€äº›é…ç½®</p><figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile">COMMON_FILTERS = scale crop overlay<br>COMMON_DEMUXERS = matroska ogg avi mov flv mpegps image2 mp3 concat<br>COMMON_DECODERS = \<br>mpeg2video mpeg4 h264 hevc \<br>png mjpeg \<br>mp3 ac3 aac<br><br>MUXERS = mp4 null image2<br>ENCODERS = mjpeg<br><br>FFMPEG_CONFIGURE_ARGS = \<br>--cc=emcc \<br>--ar=emar \<br>--enable-cross-compile \<br>--target-os=none \<br>--cpu=generic \<br>--arch=x86 \<br>--disable-runtime-cpudetect \<br>--disable-asm \<br>--disable-fast-unaligned \<br>--disable-pthreads \<br>--disable-w32threads \<br>--disable-os2threads \<br>--disable-debug \<br>--disable-stripping \<br>\<br>--disable-all \<br>--enable-avcodec \<br>--enable-avformat \<br>--enable-avutil \<br>--enable-swscale \<br>--enable-shared \<br>--enable-protocol=file \<br><span class="hljs-variable">$(<span class="hljs-built_in">addprefix</span> --enable-decoder=,<span class="hljs-variable">$(COMMON_DECODERS)</span>)</span> \<br><span class="hljs-variable">$(<span class="hljs-built_in">addprefix</span> --enable-demuxer=,<span class="hljs-variable">$(COMMON_DEMUXERS)</span>)</span> \<br><span class="hljs-variable">$(<span class="hljs-built_in">addprefix</span> --enable-encoder=,<span class="hljs-variable">$(ENCODERS)</span>)</span> \<br><span class="hljs-variable">$(<span class="hljs-built_in">addprefix</span> --enable-muxer=,<span class="hljs-variable">$(MUXERS)</span>)</span> \<br><span class="hljs-variable">$(<span class="hljs-built_in">addprefix</span> --enable-<span class="hljs-built_in">filter</span>=,<span class="hljs-variable">$(COMMON_FILTERS)</span>)</span> <br><br><span class="hljs-comment"># to run ffmpeg configure and emmake</span><br><span class="hljs-section">lib/ffmpeg/libavcodec/libavcodec.a:</span><br>cd lib/ffmpeg &amp;&amp; \<br>patch -p1 &lt; ../swscale.c.patch &amp;&amp; \<br>emconfigure ./configure \<br><span class="hljs-variable">$(FFMPEG_CONFIGURE_ARGS)</span> \<br>&amp;&amp; \<br>emmake make<br></code></pre></td></tr></table></figure><p>è¯´ä¸‹ <code>lib/ffmpeg/libavcodec/libavcodec.a</code> è¿™ä¸ªç›®æ ‡ï¼Œåˆ†æˆå‡ æ­¥:</p><ul><li><code>emconfigure</code> æ˜¯ emsdk æä¾›çš„å·¥å…·ï¼Œæ‰§è¡Œå®Œè¿™ä¸€æ­¥ä¹‹åï¼Œä¼šç”Ÿæˆ <code>lib/ffmpeg/Makefile</code></li><li><code>emmake make</code> ä¾¿æ˜¯å¼€å§‹ç¼–è¯‘äº†ï¼Œç”±äºæˆ‘ä»¬åœ¨å‰ä¸€æ­¥ configure çš„æ—¶å€™æœ‰ <code>--enable-avcodec</code>ï¼Œæ‰€ä»¥ç”¨è¿™ä¸ª Makefile ç¼–è¯‘ï¼Œä¼šç”Ÿæˆ <code>lib/ffmpeg/libavcodec/libavcodec.a</code> è¿™ä¸ªé™æ€åº“æ–‡ä»¶</li><li>ç¼–è¯‘åŸæœ¬çš„ ffmpeg ä»£ç ä¼šæŠ¥é”™ï¼Œå®šä½åˆ° <code>libswscale/swscale.c</code> æ–‡ä»¶é‡Œï¼Œä¸ºäº†ç¼–è¯‘é€šè¿‡ï¼Œåœ¨ç¼–è¯‘å‰åŠ äº†ä¸ªä¸å½±å“ä¸»è¦åŠŸèƒ½çš„ç®€å•çš„ patch</li></ul><p>è¿è¡Œ <code>make lib/ffmpeg/libavcodec/libavcodec.a</code>ï¼Œç­‰å¾…å¤§çº¦ä¸€ä¸¤åˆ†é’Ÿï¼Œemscripten ç¼–è¯‘ ffmpeg é™æ€åº“å®Œæˆï¼Œé—ªè¿‡äº†ä¸€å † warning å¯ä»¥ä¼˜é›…åœ°æ— è§†æ‰ã€‚æ¥ä¸‹æ¥å°±æ˜¯ç¼–å†™æˆ‘ä»¬çš„åº”ç”¨æ¥å£ä»£ç å¹¶ç¼–è¯‘åˆ° WebAssembly äº†ã€‚</p><h2 id="ç¼–è¯‘å’Œä½¿ç”¨">ç¼–è¯‘å’Œä½¿ç”¨</h2><h3 id="ç”Ÿæˆ-js-å’Œ-wasm-æ–‡ä»¶">ç”Ÿæˆ JS å’Œ WASM æ–‡ä»¶</h3><figure class="highlight makefile"><table><tr><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">dist/vidy-standalone.js:</span><br>    emcc transcoder/web.c transcoder/process.c \<br>                lib/ffmpeg/libavformat/libavformat.a \<br>                lib/ffmpeg/libavcodec/libavcodec.a \<br>                lib/ffmpeg/libswscale/libswscale.a \<br>                lib/ffmpeg/libavutil/libavutil.a \<br>                -s TOTAL_MEMORY=33554432 \<br>                -s MODULARIZE=1 \<br>                -O1 -s WASM=1 -s EXTRA_EXPORTED_RUNTIME_METHODS=&#x27;[<span class="hljs-string">&quot;ccall&quot;</span>, <span class="hljs-string">&quot;cwrap&quot;</span>]&#x27; -s ALLOW_MEMORY_GROWTH=1  \<br>                -Ilib/ffmpeg \<br>                --post-js transcoder/js/post.js \<br>                -o dist/vidy-standalone.js<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>emcc</code> ç¼–è¯‘ï¼š</p><ul><li>å­˜æ”¾æš´éœ²ç»™æµè§ˆå™¨çš„ç›¸å…³æ¥å£çš„ <code>web.c</code></li><li>å­˜æ”¾é€šç”¨çš„ ffmpeg æ–¹æ³•è°ƒç”¨çš„ <code>process.c</code></li><li>ä»¥åŠä¹‹å‰ç”Ÿæˆä¸ªå‡ ä¸ªé™æ€åº“æ–‡ä»¶ <code>.a</code></li></ul><p>å…¶ä¸­ä¸€äº›å‚æ•°è¯´æ˜ä¸€ä¸‹ï¼š - <code>-s MODULARIZE=1</code> è®© emcc ç”Ÿæˆæ¨¡å—å·¥å‚å‡½æ•°ï¼ˆè€Œä¸”è¿˜æ˜¯ UMD æ ¼å¼çš„ï¼‰ï¼Œç•™å¾…ä¹‹åè°ƒç”¨ã€‚å¦åˆ™é»˜è®¤æƒ…å†µä¸‹ç”Ÿæˆçš„ JS ä¼šç«‹åˆ»æ‰§è¡Œï¼Œè€Œä¸”è¿˜ä¼šæ±¡æŸ“å…¶æ‰€åœ¨å…¨å±€ç¯å¢ƒï¼ˆä¾‹å¦‚æ·»åŠ ä¸€ä¸ª self.Module å¯¹è±¡ï¼‰</p><p>ä¸€èµ·ç”Ÿæˆç›®æ ‡æ–‡ä»¶ <code>dist/vidy-standalone.js</code>ï¼Œç”±äºä¼ é€’äº† <code>-s WASM=1</code>ï¼Œè¿˜ä¼šç”ŸæˆåŒåçš„ <code>dist/vidy-standalone.wasm</code> æ–‡ä»¶ã€‚JS æ˜¯ä¸€ä¸ªä¸€åƒæ¥è¡Œçš„èƒ¶æ°´ä»£ç ï¼Œè´Ÿè´£ WASM æ¨¡å—çš„åˆå§‹åŒ–å’Œè°ƒç”¨é€‚é…ã€‚WASM æ–‡ä»¶å¤§æ¦‚ 4.7Mã€‚</p><p>æŸ¥çœ‹ <a href="%5Bhttps://emscripten.org/docs/tools_reference/emcc.html">emcc æ–‡æ¡£</a> å’Œ <a href="https://github.com/emscripten-core/emscripten/blob/master/src/settings.js">å…³äº <code>-s</code> çš„å…¨éƒ¨å¯é€‰ setting</a>ã€‚</p><h3 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h3><h4 id="ç®€å•çš„ä¾‹å­">ç®€å•çš„ä¾‹å­</h4><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Module <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../dist/vidy-standalone&#x27;</span><br><br><span class="hljs-keyword">let</span> vidyModule<br><br>fetch(<span class="hljs-string">&#x27;//path/to/dist/vidy-standalone.wasm&#x27;</span>)<br>    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.arrayBuffer())<br>    .then(<span class="hljs-function">(<span class="hljs-params">arrayBuffer</span>) =&gt;</span> &#123;<br>        vidyModule = Module(&#123;<br>            wasmBinary: arrayBuffer<br>        &#125;)<br>        decodeVideoFrameImage(<span class="hljs-string">&#x27;some.mp4&#x27;</span>, <span class="hljs-number">1.2</span>)<br>    &#125;)<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decodeVideoFrameImage</span>(<span class="hljs-params">videoPath, timeStamp</span>) </span>&#123;<br>    fetch(videoPath).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.arrayBuffer())<br>        .then(<span class="hljs-function">(<span class="hljs-params">videoBuffer</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> imageResult = vidyModule.getImage(<span class="hljs-built_in">this</span>.result, <span class="hljs-built_in">parseFloat</span>(timeStamp))<br>            <span class="hljs-comment">// ...</span><br>        &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç¨å¾®å¤æ‚ç‚¹çš„ä¾‹å­">ç¨å¾®å¤æ‚ç‚¹çš„ä¾‹å­</h4><p>ä¸ºäº†å°†æ¨¡å—æ›´å¥½åœ°æ•´åˆåˆ°å‰ç«¯å·¥ç¨‹ä¸­ï¼Œæœ‰å¿…è¦è€ƒè™‘åœ¨ä½¿ç”¨ webpack çš„æƒ…å†µä¸‹å¦‚ä½•å¼•å…¥ã€‚</p><p>å‚è€ƒ <a href="https://github.com/GoogleChromeLabs/squoosh/">GoogleChromeLabs/squoosh</a> é¡¹ç›®ä¸­çš„ä¸€äº›ç»éªŒï¼Œé¦–å…ˆçœ‹ä¸‹ webpack é…ç½®ã€‚webpack å›¢é˜Ÿåœ¨ v4 ä»¥ååšäº†å¾ˆå¤šåŠªåŠ›ï¼Œæƒ³è¦è®© WASM æ¨¡å—çš„å¼•å…¥å’Œä½¿ç”¨ä¸ js æ–‡ä»¶ä¸€æ ·æ–¹ä¾¿ï¼Œä½†å®é™…å®ç”¨ä¸­æœ‰å¾ˆå¤šè¾¹è¾¹è§’è§’ <a href="https://github.com/webpack/webpack/issues/6725">å¥‡æ€ªçš„é—®é¢˜å’ŒæŠ¥é”™</a>ï¼Œè€Œä¸”å¤„ç†ä¸€ä¸ªå¥½å‡ å…†çš„ wasm æ–‡ä»¶æ‹–æ…¢ webpack å†·å¯åŠ¨è®¸å¤šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸‹é…ç½®è®© webpack ä¸å»è¯»å– WASM æ–‡ä»¶ã€‚ä½¿ç”¨ file-loader ä¹Ÿå¯ä»¥ç®€å•åœ°é…ç½®å¸¦å“ˆå¸Œçš„æ–‡ä»¶åï¼Œæ¯”èµ·åœ¨é¡¹ç›®ä¸­ç¡¬ç¼–ç  WASM æ–‡ä»¶è·¯å¾„ï¼Œå°‘å»ä¸€äº›ç¼“å­˜é—®é¢˜ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// webpack config</span><br>    rules: [<br>    ...<br>      &#123;<br>        test: <span class="hljs-regexp">/\.wasm$/</span>,<br>        <span class="hljs-comment">// This is needed to make webpack NOT process wasm files.</span><br>        type: <span class="hljs-string">&#x27;javascript/auto&#x27;</span>,<br>        loader: <span class="hljs-string">&#x27;file-loader&#x27;</span>,<br>        options: &#123;<br>          name: <span class="hljs-string">&#x27;[name].[hash:5].[ext]&#x27;</span>,<br>        &#125;,<br>      &#125;,<br>    ...<br>    ]<br></code></pre></td></tr></table></figure><p>è·Ÿä¸Šé¢ç®€å•ä¾‹å­é‡Œæ•ˆæœç›¸ä¼¼çš„å†™æ³•å¯ä»¥å˜æˆè¿™æ ·:</p><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Module <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../dist/vidy-standalone&#x27;</span><br><span class="hljs-keyword">import</span> vidyWasmUrl <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../dist/vidy-standalone.wasm&#x27;</span> <span class="hljs-comment">// ä¼šè¢« file-loader å¤„ç†æˆä¸€ä¸ªé™æ€æ–‡ä»¶çš„ url</span><br><br><span class="hljs-keyword">const</span> vidyModule = Module(&#123;<br>    locateFile(url) &#123;<br>        <span class="hljs-comment">// Redirect the request for the wasm binary to whatever webpack gave us.</span><br>        <span class="hljs-keyword">if</span> (url.endsWith(<span class="hljs-string">&#x27;.wasm&#x27;</span>)) <span class="hljs-keyword">return</span> vidyWasmUrl;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure><p>emcc ç”Ÿæˆçš„èƒ¶æ°´ä»£ç é‡Œï¼Œé»˜è®¤è¯·æ±‚çš„ WASM æ–‡ä»¶è·¯å¾„æ˜¯ <code>vidy-standalone.wasm</code>ï¼Œä½†çœ‹çœ‹ <a href="https://github.com/emscripten-core/emscripten/blob/master/emcc.py#L2800">emcc è¿™ä¸€éƒ¨åˆ†å®ç°</a> çŸ¥é“ï¼Œå¦‚æœç»™æ¨¡å—å·¥å‚å‡½æ•° Module ä¼ é€’äº† <code>locateFile</code> å‡½æ•°ï¼Œå°±å¯ä»¥æ”¹å†™å…¶å†…éƒ¨ä¼šå»è¯·æ±‚çš„ WASM æ–‡ä»¶è·¯å¾„ã€‚ä½¿ç”¨æ¨¡å—å·¥å‚å‡½æ•°çš„è¯ï¼Œä¹Ÿä¸ç”¨è‡ªå·±å»è°ƒç”¨ <code>fetch</code> äº†ã€‚</p><h2 id="ä¸€äº›å…·ä½“å®ç°çš„ä»£ç ">ä¸€äº›å…·ä½“å®ç°çš„ä»£ç </h2><p>é¦–å…ˆçœ‹çœ‹ <code>web.c</code> é‡Œæš´éœ²å‡ºçš„æ–¹æ³•ç­¾åï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-function">EMSCRIPTEN_KEEPALIVE MyImageData *<span class="hljs-title">seek_video_to</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *buff, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> buff_length, <span class="hljs-keyword">float</span> time_stamp)</span></span><br></code></pre></td></tr></table></figure><p>buffer æ•°ç»„å¤´æŒ‡é’ˆ <code>buff</code>ï¼Œbuffer é•¿åº¦ <code>buff_length</code>ï¼Œä»¥åŠç”¨å•ç²¾åº¦æµ®ç‚¹æ•°è¡¨ç¤ºçš„éœ€è¦æå–å›¾åƒçš„æ—¶é—´ã€‚è¿”å›æ•°æ®ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„ç»“æ„ã€‚</p><h3 id="js-å°†è§†é¢‘æ•°æ®å†™å…¥-wasm-çº¿æ€§å†…å­˜">[JS] å°†è§†é¢‘æ•°æ®å†™å…¥ WASM çº¿æ€§å†…å­˜</h3><p>åœ¨ <code>post.js</code> é‡Œï¼Œæ·»åŠ çš„ä¸€éƒ¨åˆ†ä»£ç ã€‚</p><ul><li>æ ¹æ® C çš„æ–¹æ³•ç­¾åï¼Œä½¿ç”¨ emscripten çš„èƒ¶æ°´ä»£ç å·¥å…·å‡½æ•° <code>Module.cwrap</code> åŒ…è£…ä¸€ä¸ª JS çš„è°ƒç”¨æ–¹æ³•</li><li>ç»™ emscripten æ¨¡å—åŠ ä¸Šäº† <code>Module.getImage</code> æ–¹æ³•ï¼Œä¾›å¤–éƒ¨è°ƒç”¨</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> seek_video_to = <span class="hljs-literal">null</span><br><br>Module.onRuntimeInitialized = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  seek_video_to = Module.cwrap(<span class="hljs-string">&#x27;seek_video_to&#x27;</span>, <span class="hljs-string">&#x27;number&#x27;</span>, [<span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-string">&#x27;number&#x27;</span>]);<br>&#125;;<br><br>Module.getImage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer, timeStamp</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (!seek_video_to) &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">errcode</span>: <span class="hljs-number">1</span> &#125;<br>  &#125;<br>  <span class="hljs-keyword">let</span> ptr = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> before = <span class="hljs-built_in">Date</span>.now()<br>    <span class="hljs-keyword">let</span> data_arr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(buffer);<br>    offset = Module._malloc(data_arr.length);<br>    Module.HEAP8.set(data_arr, offset);<br>    ptr = seek_video_to(offset, data_arr.length, timeStamp);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;seek_video_to costs&#x27;</span>, <span class="hljs-built_in">Date</span>.now() - before)<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    <span class="hljs-keyword">throw</span> e;<br>  &#125;<br>  ...<br></code></pre></td></tr></table></figure><h3 id="c-ç¨‹åºå¤´éƒ¨">[C] ç¨‹åºå¤´éƒ¨</h3><p>é¦–å…ˆå£°æ˜ä¸€äº›æ–¹ä¾¿æ•°æ®è¯»å–çš„å…¨å±€å˜é‡:</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">uint8_t</span> *ptr;<br>    <span class="hljs-keyword">size_t</span> size;<br>&#125; BufferData;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * some global variables</span><br><span class="hljs-comment"> */</span><br>BufferData global_buffer_data;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-keyword">uint32_t</span> width;<br>    <span class="hljs-keyword">uint32_t</span> height;<br>    <span class="hljs-keyword">uint8_t</span> *data;<br>&#125; MyImageData;<br></code></pre></td></tr></table></figure><p>å…¨å±€å˜é‡ <code>global_buffer_data</code> ç•™ä½œå­˜æ”¾åŸå§‹è§†é¢‘æ•°æ®çš„ç»“æ„ï¼Œå®ƒæ‰€åœ¨çš„å†…å­˜åŒºåŸŸä¼šè¢« JS ç›´æ¥å†™å…¥ã€‚</p><h3 id="c-avcodec-è§£æè§†é¢‘æ–‡ä»¶">[C] avcodec è§£æè§†é¢‘æ–‡ä»¶</h3><p>æˆ‘ä»¬éœ€è¦è®© ffmpeg èƒ½å¤Ÿä»å†…å­˜ï¼ˆè€Œä¸æ˜¯æ–‡ä»¶ï¼‰ä¸­è¯»å–è§†é¢‘æ•°æ®ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">...<br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *avio_ctx_buffer = <span class="hljs-literal">NULL</span>;<br>  <span class="hljs-comment">// å¯¹äºæ™®é€šçš„mp4æ–‡ä»¶ï¼Œè¿™ä¸ªsizeåªè¦1MBå°±å¤Ÿäº†ï¼Œä½†æ˜¯å¯¹äºmov/m4véœ€è¦å’Œbuffä¸€æ ·å¤§</span><br>  <span class="hljs-keyword">size_t</span> avio_ctx_buffer_size = buff_length;<br><br>  global_buffer_data.ptr = buff;         <span class="hljs-comment">/* will be grown as needed by the realloc above */</span><br>  global_buffer_data.size = buff_length; <span class="hljs-comment">/* no data at this point */</span><br><br>  AVFormatContext *pFormatCtx = avformat_alloc_context();<br><br>  <span class="hljs-keyword">uint8_t</span> *avio_ctx_buffer = (<span class="hljs-keyword">uint8_t</span> *)av_malloc(avio_ctx_buffer_size);<br><br>  <span class="hljs-comment">/* è¯»å†…å­˜æ•°æ® */</span><br>  AVIOContext *avio_ctx = avio_alloc_context(avio_ctx_buffer, avio_ctx_buffer_size, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, read_packet, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<br><br>  pFormatCtx-&gt;pb = avio_ctx;<br>  pFormatCtx-&gt;flags = AVFMT_FLAG_CUSTOM_IO;<br>...<br></code></pre></td></tr></table></figure><p>æ–°å»º <code>AVIOContext *avio_ctx</code>ï¼ŒæŒ‡å®šç›®æ ‡ buffer æŒ‡é’ˆï¼Œç›®æ ‡ buffer å¤§å°ï¼Œä»¥åŠæˆ‘ä»¬æä¾›çš„è¯»å–æ•°æ®çš„ <code>read_packet</code> å‡½æ•°ï¼Œè¯¥ iocontext éœ€è¦è¯»ä¸‹ä¸€æ®µæ•°æ®æ—¶ï¼Œ <code>read_packet</code> å‡½æ•°å°±å°† <code>global_buffer_data</code> ä¸­æŒ‡å®šå¤§å°çš„æ•°æ®å†™å…¥ç›®æ ‡ <code>*buf</code> ä½ç½®</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">read_packet</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *opaque, <span class="hljs-keyword">uint8_t</span> *buf, <span class="hljs-keyword">int</span> buf_size)</span></span><br><span class="hljs-function"></span>&#123;<br>    buf_size = FFMIN(buf_size, global_buffer_data.size);<br><br>    <span class="hljs-comment">/* copy internal buffer data to buf */</span><br>    <span class="hljs-built_in">memcpy</span>(buf, global_buffer_data.ptr, buf_size);<br>    global_buffer_data.ptr += buf_size;<br>    global_buffer_data.size -= buf_size;<br><br>    <span class="hljs-keyword">return</span> buf_size;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="c-è·å–å›¾ç‰‡-rgb-æ•°æ®">[C] è·å–å›¾ç‰‡ rgb æ•°æ®</h3><p>è¿™é‡Œå†…å®¹å¤ªå¤šï¼Œä¸»è¦æ¶‰åŠ FFMpeg çš„æ¥å£å’Œè§†é¢‘ç¼–è§£ç çš„çŸ¥è¯†ï¼Œå‡†å¤‡å¦å†™ä¸€ç¯‡ã€‚</p><h3 id="c-å°†å›¾åƒç­‰æ•°æ®å†™å…¥å†…å­˜">[C] å°†å›¾åƒç­‰æ•°æ®å†™å…¥å†…å­˜</h3><p>å½“æ‹¿åˆ°åŒ…å« RGB æ ¼å¼å›¾åƒæ•°æ®çš„ <code>AVFrame *pFrameRGB</code> åï¼Œæ˜¯æ—¶å€™å°†å…¶ä¸­çš„é¢œè‰²ä¿¡æ¯å–å‡ºï¼Œè½¬åŒ–ä¸ºçº¿æ€§å­˜å‚¨çš„ï¼Œåˆ©äº JS ä¸­ Canvas å…ƒç´ ä½¿ç”¨çš„æ•°æ®æ ¼å¼ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">uint8_t</span> *<span class="hljs-title">get_image_frame_buffer</span><span class="hljs-params">(AVFrame *pFrame, AVCodecContext *pCodecCtx)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> width = pCodecCtx-&gt;width;<br>    <span class="hljs-keyword">int</span> height = pCodecCtx-&gt;height;<br><br>    <span class="hljs-keyword">int</span> buffer_size = height * width * <span class="hljs-number">3</span>;<br><br>    <span class="hljs-keyword">uint8_t</span> *buffer = (<span class="hljs-keyword">uint8_t</span> *)<span class="hljs-built_in">malloc</span>(buffer_size);<br><br>    <span class="hljs-comment">// Write pixel data</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++)<br>    &#123;<br>        <span class="hljs-built_in">memcpy</span>(buffer + y * pFrame-&gt;linesize[<span class="hljs-number">0</span>], pFrame-&gt;data[<span class="hljs-number">0</span>] + y * pFrame-&gt;linesize[<span class="hljs-number">0</span>], width * <span class="hljs-number">3</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> buffer;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤å‡½æ•°è¿”å›çš„ <code>buffer</code> æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒºåŸŸï¼Œä¼šæŒ‰ç…§ <code>rgbrgb...</code> çš„é¡ºåºå­˜å‚¨å›¾åƒé¢œè‰²æ•°æ®ã€‚æ¯ä¸ªåƒç´ éœ€è¦ 3 ä¸ªå­˜å‚¨å•å…ƒï¼Œæ‰€ä»¥æ•´ä¸ªçš„ <code>buffer_size</code> ä¼šæ˜¯ <code>height * width * 3</code>ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å›åˆ° JS ç«¯ã€‚</p><h3 id="js-æ ¹æ®æŒ‡é’ˆè¯»å‡ºæ•°æ®æ„å»º-imagedata">[JS] æ ¹æ®æŒ‡é’ˆè¯»å‡ºæ•°æ®ï¼Œæ„å»º ImageData</h3><p>WASM è¿”å›çš„åªæ˜¯ä¸€ä¸ªå†…å­˜åç§»é‡ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰‹ä¸Šæœ‰æ•´ä¸ª WASM å®ä¾‹çš„å†…å­˜åŒºåŸŸï¼Œå¾—æƒ³åŠæ³•æŠŠæœ‰ç”¨çš„æ•°æ®è¯»å–å‡ºæ¥ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ <code>MyImageData</code> ç»“æ„ä½“å®½å’Œé«˜éƒ½æ˜¯ç”¨ <code>uint32_t</code>ï¼Œç´§æ¥ç€å­˜æ”¾é¢œè‰²ä¿¡æ¯çš„æ•°ç»„å•å…ƒç±»å‹ä¸º <code>uint8_t</code>ã€‚</p><p>Emscripten çš„èƒ¶æ°´ä»£ç æœ‰æä¾› HEAPU (8/16/32/64) å‡ ç§æ­¥é•¿çš„ dataviewerï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹æ³•è¯»å‡ºæ•°å­—å’Œé¢œè‰²æ•°ç»„ã€‚</p><figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">let</span> heap32Start = ptr / <span class="hljs-number">4</span><br>  <span class="hljs-keyword">let</span> width = Module.HEAPU32[heap32Start]<br>  <span class="hljs-keyword">let</span> height = Module.HEAPU32[heap32Start + <span class="hljs-number">1</span>],<br>    imgBufferPtr = Module.HEAPU32[heap32Start + <span class="hljs-number">2</span>],<br>    imageBuffer = Module.HEAP.subarray(imgBufferPtr, imgBufferPtr + width * height * <span class="hljs-number">3</span>)<br><br>  <span class="hljs-keyword">let</span> imageInfo = &#123; width, height, imageDataArr: imageBuffer &#125;<br>  <span class="hljs-keyword">let</span> imageData = imageInfoToImageData(imageInfo)<br><span class="hljs-comment">// ...</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imageInfoToImageData</span>(<span class="hljs-params">imageInfo: VidyImageInfo</span>) </span>&#123;<br>  <span class="hljs-keyword">const</span> &#123; width, height, imageDataArr &#125; = imageInfo<br>  <span class="hljs-keyword">const</span> imageData = <span class="hljs-keyword">new</span> ImageData(width, height)<br>  <span class="hljs-comment">// ç›®å‰åªè¿”å› RGB24 æ ¼å¼çš„æ•°æ®, ä¸å¤„ç†é€æ˜åº¦</span><br>  <span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; imageDataArr.length; i++) &#123;<br>    <span class="hljs-keyword">if</span> (i &amp;&amp; i % <span class="hljs-number">3</span> === <span class="hljs-number">0</span>) &#123;<br>      imageData.data[k++] = <span class="hljs-number">255</span><br>    &#125;<br>    imageData.data[k++] = imageDataArr[i]<br>  &#125;<br>  imageData.data[k] = <span class="hljs-number">255</span><br>  <span class="hljs-keyword">return</span> imageData<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»˜åˆ¶åˆ° canvas ä¸Šå°±å¾ˆç®€å•äº†</p><figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts">canvas.width = width<br>canvas.height = height<br><span class="hljs-keyword">let</span> ctx = canvas.getContext(<span class="hljs-string">&#x27;2d&#x27;</span>)<br>ctx.drawImage(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><p>è·Ÿç€åˆ«äººçš„æ–‡ç« æ€è·¯ï¼Œå°å°ä¿®æ”¹ï¼Œè·‘é€šäº†ä¸€ä¸ª demoï¼Œå¤§è‡´ç†Ÿæ‚‰ä¸€ä¸‹ C é¡¹ç›®ä½¿ç”¨ Emscripten è½¬åŒ–ä¸ºå‰ç«¯å¯ç”¨æ¨¡å—çš„æ–¹æ¡ˆã€‚</p><p>ä¸æ˜¯å¾ˆç†Ÿæ‚‰ C è¯­è¨€ï¼ŒåŒæ—¶åœ¨ JS å’Œ C ç«¯æ‰‹åŠ¨ç®¡ç†å†…å­˜è™½ç„¶å¯¹äºå…¥é—¨è€…æ¥è¯´å¾ˆå®¹æ˜“æ“ä½œï¼Œä½†ç¨æ˜¾ç¹çã€‚</p><p>Emscripten å¤šç”¨äºç¿»è¯‘ç°æœ‰çš„ C/C++ åº“ä»£ç ï¼Œå¯¹äº Web API å’Œå‰ç«¯ç”Ÿæ€çš„æ”¯æŒï¼Œæ˜æ˜¾æ²¡æœ‰éš”å£ Mozilla çš„ Rust ç¤¾åŒºç§¯æã€‚ä¸è¿‡éŸ³è§†é¢‘æŠ€æœ¯å®ç°ï¼Œçš„ç¡®æ˜¯ C çš„ä¼ ç»Ÿå¼ºé¡¹é¢†åŸŸï¼Œè‹¥æƒ³å°‘é€ è½®å­ï¼Œè¿˜æ˜¯è¦å¥½å¥½å­¦ä¹ çš„ã€‚</p><h2 id="å‚è€ƒ">å‚è€ƒ</h2><p>https://zhuanlan.zhihu.com/p/40786748</p>]]></content>
    
    
    <summary type="html">å€ŸåŠ© Emscriptenï¼ŒåŸºäº ffmpeg äºŒæ¬¡å¼€å‘å‰ç«¯éŸ³è§†é¢‘åŠŸèƒ½</summary>
    
    
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Avtech" scheme="http://hikerpig.github.io/tags/Avtech/"/>
    
    <category term="Webassembly" scheme="http://hikerpig.github.io/tags/Webassembly/"/>
    
    <category term="Emscripten" scheme="http://hikerpig.github.io/tags/Emscripten/"/>
    
    <category term="ffmpeg" scheme="http://hikerpig.github.io/tags/ffmpeg/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ docker ç¯å¢ƒä¸­ä» gitlab æ‹‰å–æºç </title>
    <link href="http://hikerpig.github.io/2019/02/15/2019-02-14-Setup-CI-in-docker/"/>
    <id>http://hikerpig.github.io/2019/02/15/2019-02-14-Setup-CI-in-docker/</id>
    <published>2019-02-14T16:00:00.000Z</published>
    <updated>2020-03-03T10:53:43.809Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ³¨ï¼šåœ¨ docker é•œåƒä¸­æ‹‰å– git ä»“åº“ä¼¼ä¹æ˜¯ä¸€ç§ anti-patternï¼Œæœ¬æ–‡åªæ˜¯è®°å½•ä¸­é—´çš„è¸©å‘ç»å†ã€‚</p><p>æ‰˜ç®¡åœ¨å…¬å¸ gitlab ä¸Šçš„ä¸€ä¸ªå‰ç«¯é¡¹ç›®ï¼Œæœ€è¿‘åœ¨å°è¯• docker åŒ–ã€‚</p><h1 id="å‡†å¤‡é˜¶æ®µ">å‡†å¤‡é˜¶æ®µ</h1><h2 id="gitlab-ä¸Šçš„ä¸€äº›é—®é¢˜">Gitlab ä¸Šçš„ä¸€äº›é—®é¢˜</h2><p>å¦‚æœé¡¹ç›®ä¸æ˜¯å…¬å¼€çš„ï¼Œä» docker ç¯å¢ƒä¸­æ‹‰å–ä»£ç ä¼šæœ‰äº›è®¸æƒé™é—®é¢˜ï¼Œå¯ä¸€ä¸€è§£å†³ã€‚</p><h3 id="clone-with-deploy-token">clone with deploy token</h3><p>åˆ° Gitlab ä¸­å¯¹åº”é¡¹ç›®çš„ settings/repository é¡µé¢ï¼Œç”Ÿæˆ Deploy Tokens, ä¾¿å¯ä»¥ä½¿ç”¨ https clone é¡¹ç›®ï¼Œä¸ç”¨è¾“å…¥ç”¨æˆ·å¯†ç ï¼Œä¹Ÿä¸å¿…ä½¿ç”¨è®¾ç½®ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦çš„ ssh deploy key æ–¹å¼ã€‚</p><p>å…‹éš†é¡¹ç›®çš„å‘½ä»¤ä¸º</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://&lt;name&gt;:&lt;token&gt;@gitlab.com/&lt;USER&gt;/&lt;REPO&gt;.git<br></code></pre></td></tr></table></figure><p>æ­¤å¤„çš„ <code>name</code> æ˜¯ token name, ä¸æ˜¯ç”¨æˆ·åã€‚åªå¯¹æ­¤é¡¹ç›®ç”Ÿæ•ˆï¼Œé¿å…ä½¿ç”¨æƒé™è¾ƒé«˜çš„ç”¨æˆ· tokenã€‚</p><h3 id="git-lfs-æ‹‰å–æ–‡ä»¶å‡ºé”™">git-lfs æ‹‰å–æ–‡ä»¶å‡ºé”™</h3><p>å³ä¾¿ä½¿ç”¨äº† deploy token å¯ä»¥å…‹éš†é¡¹ç›®æ–‡ä»¶ï¼Œä½†å…¶ä¸­ä½¿ç”¨ git-lfs è¿½è¸ªçš„ä¸€äº›æ–‡ä»¶ä¼šå¤±è´¥ï¼š</p><figure class="highlight txt"><table><tr><td class="code"><pre><code class="hljs txt">Error downloading object: some/filename/blah: Smudge error: https://&lt;name&gt;:&lt;token&gt;@gitlab.com/some/repo.git/info/lfs/objects/batch<br></code></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯æƒé™é—®é¢˜ï¼Œå¯ä»¥è¶Šè¿‡ git-lfs çš„ smudge æ­¥éª¤æ¥è§„é¿æ­¤é—®é¢˜ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">GIT_LFS_SKIP_SMUDGE=1 git <span class="hljs-built_in">clone</span> &lt;SERVER-REPOSITORY&gt;<br></code></pre></td></tr></table></figure><p>å‚è€ƒ: https://stackoverflow.com/questions/42019529/how-to-clone-pull-a-git-repository-ignoring-lfs</p><h1 id="å¼€å§‹">å¼€å§‹</h1><h2 id="dockerfile">Dockerfile</h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">8.15</span>.<span class="hljs-number">0</span>-slim<br><br><span class="hljs-comment"># install git-lfs</span><br><span class="hljs-keyword">RUN</span><span class="bash"> curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh |  bash</span><br><span class="hljs-keyword">RUN</span><span class="bash"> apt-get install -y git-lfs</span><br><br><span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span><br><br><span class="hljs-keyword">RUN</span><span class="bash"> GIT_LFS_SKIP_SMUDGE=1 git <span class="hljs-built_in">clone</span> https://&lt;name&gt;:&lt;token&gt;@gitlab.com/&lt;USER&gt;/&lt;REPO&gt;.git myrepo</span><br><br><span class="hljs-keyword">WORKDIR</span><span class="bash"> /app/myrepo</span><br><br><span class="hljs-keyword">RUN</span><span class="bash"> yarn</span><br></code></pre></td></tr></table></figure><h2 id="æ„å»ºé•œåƒ">æ„å»ºé•œåƒ</h2><p>åœ¨ Dockerfile æ‰€åœ¨ç›®å½•ä¸‹:</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">docker build -t my-app .<br></code></pre></td></tr></table></figure><p>ç­‰å¾…å‡ åˆ†é’Ÿï¼Œæ„å»ºå®Œæˆä¾¿å¯ä½¿ç”¨ <code>docker inspect my-app</code> å‘½ä»¤çœ‹çœ‹æ–°æ·»åŠ çš„é•œåƒã€‚</p><p>è‹¥ package.json ä¾èµ–è¾ƒå¤šï¼Œä¸”å¯ä»¥æ¥å—åœ¨ docker host å’Œ vm ä¹‹é—´å…±äº«æ–‡ä»¶ï¼Œå¯ä»¥å»æ‰ <code>RUN yarn</code> è¿™ä¸€æ­¥ï¼Œç„¶åä½¿ç”¨ <a href="https://docs.docker.com/storage/volumes/">docker volume</a> å…±äº«å®¿ä¸»ç¯å¢ƒä¸­å·²ç»æå‰å®‰è£…å¥½çš„ node_modules æ–‡ä»¶å¤¹ã€‚</p><h2 id="å¯åŠ¨å®¹å™¨">å¯åŠ¨å®¹å™¨</h2><p>å¯åŠ¨ä¸€ä¸ªå¸¦ tty çš„ interactive å®¹å™¨å¹¶è¿è¡Œ bashï¼Œå¯ä»¥åœ¨å®¹å™¨é‡Œè½¬ä¸€è½¬ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆä¸œè¥¿:</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">docker run -v /path/to/current/node_modules:/app/myrepo/node_modules -it my-app  --name app-tty /bin/bash<br></code></pre></td></tr></table></figure><p>æˆ–æ˜¯ç›´æ¥è·‘æµ‹è¯•:</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">docker run -v /path/to/current/node_modules:/app/myrepo/node_modules -it my-app  --name <span class="hljs-built_in">test</span>-container /bin/bash -c <span class="hljs-string">&#x27;cd /app/myrepo &amp;&amp; npm run test&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">åœ¨ docker ç¯å¢ƒä¸­ä» gitlab æ‹‰å–æºç </summary>
    
    
    
    <category term="è¿ç»´" scheme="http://hikerpig.github.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="git" scheme="http://hikerpig.github.io/tags/git/"/>
    
    <category term="å‰ç«¯" scheme="http://hikerpig.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="docker" scheme="http://hikerpig.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Tips On Viewing Logs</title>
    <link href="http://hikerpig.github.io/2019/02/15/2019-03-08-Tips-On-Viewing-Logs/"/>
    <id>http://hikerpig.github.io/2019/02/15/2019-03-08-Tips-On-Viewing-Logs/</id>
    <published>2019-02-14T16:00:00.000Z</published>
    <updated>2019-08-20T10:19:05.390Z</updated>
    
    <content type="html"><![CDATA[<p>é¢å¯¹æµ©å¦‚çƒŸæµ·çš„ logï¼Œåœ¨æ’æŸ¥é”™è¯¯å’ŒæŸ¥æ‰¾ä¿¡æ¯æ—¶ä½¿ç”¨ä¸€äº›è¶æ‰‹çš„å·¥å…·ï¼Œå¿«é€Ÿå®šä½ï¼Œå…³çˆ±è§†åŠ›ï¼Œæœ‰ç›Šèº«å¿ƒå¥åº·ã€‚</p><h1 id="é«˜çº§çš„å·¥å…·">é«˜çº§çš„å·¥å…·</h1><h2 id="lnav">lnav</h2><p><a href="http://lnav.org/">lnav</a> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ—¥å¿—æŸ¥çœ‹å™¨ï¼Œæœ‰å¤šç§è§†å›¾å’Œè¿‡æ»¤åŠŸèƒ½ï¼Œä¸è¿‡æœ€å–œæ¬¢çš„å…¶å®è¿˜æ˜¯è‡ªåŠ¨çš„é¢œè‰²é«˜äº®ã€‚</p><figure><img src="https://static1.squarespace.com/static/51bd4e13e4b0052d7873ad34/t/551aa43fe4b065952ea849ad/1427809346467/?format=1500w" alt="" /><figcaption>lnav å®˜ç½‘ç»™å‡ºçš„æ•ˆæœå›¾</figcaption></figure><h1 id="ç³»ç»Ÿè‡ªå¸¦å·¥å…·">ç³»ç»Ÿè‡ªå¸¦å·¥å…·</h1><p>ä¸ç”¨å®‰è£…é¢å¤–çš„ç¨‹åºï¼Œlinux å¤šæ•°å‘è¡Œç‰ˆéƒ½æœ‰çš„åŸºç¡€å·¥å…·ã€‚</p><h2 id="less">less</h2><h3 id="é«˜äº®æœç´¢å‘½ä¸­å†…å®¹">é«˜äº®æœç´¢å‘½ä¸­å†…å®¹</h3><p><a href="https://unix.stackexchange.com/questions/179173/make-less-highlight-search-patterns-instead-of-italicizing-them">Make Less highlight search patterns instead of italicizing them</a></p><figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">LESS_TERMCAP_se</span>=$&#x27;\E[39;49m<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä¸€äº›çœ‹ LOG æ—¶æ–¹ä¾¿çš„å·¥å…·å’ŒæŠ€å·§</summary>
    
    
    
    <category term="Tips" scheme="http://hikerpig.github.io/categories/Tips/"/>
    
    
    <category term="tip" scheme="http://hikerpig.github.io/tags/tip/"/>
    
    <category term="å·¥å…·" scheme="http://hikerpig.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
</feed>
