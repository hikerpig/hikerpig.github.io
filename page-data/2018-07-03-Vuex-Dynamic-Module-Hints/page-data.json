{"componentChunkName":"component---src-templates-page-js","path":"/2018-07-03-Vuex-Dynamic-Module-Hints/","result":{"data":{"site":{"siteMetadata":{"title":"HP goes FE","author":"@hikerpig"}},"markdownRemark":{"id":"e384de2c-ffdb-50cd-99ba-6e659880b0d3","html":"<h1 id=\"å‰è¨€\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"å‰è¨€ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å‰è¨€</h1>\n<p>æ„å»ºå¤§å‹ SPA åº”ç”¨æ—¶ï¼Œä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼Œåœ¨ Vue ç”Ÿæ€ä¸‹ï¼Œä½¿ç”¨ vue-router å¾ˆå®¹æ˜“å®ç°ç»„ä»¶çš„æ‡’åŠ è½½ã€‚</p>\n<p>ä½†åº”ç”¨é‡Œé™¤äº†ç»„ä»¶ï¼Œè¿˜æœ‰åºå¤§çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™éƒ¨åˆ†å¦‚ä½•åˆ†å‰²å’Œæ‡’åŠ è½½æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿ</p>\n<p>ä½¿ç”¨ Vuex ç®¡ç†çŠ¶æ€çš„è¯ï¼Œå…¶æä¾›äº†æ–¹æ³• <code>registerModule</code> ç”¨äº<a href=\"https://vuex.vuejs.org/guide/modules.html#dynamic-module-registration\">åŠ¨æ€æ³¨å†Œ</a> Moduleã€‚</p>\n<p>å› æ­¤æŸä¸ªé¡µé¢ç‹¬æœ‰çš„ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†ï¼Œåœ¨åˆå§‹åŒ–å…¨å±€ store çš„æ—¶å€™å¯ä»¥ä¸ç”¨å¼•å…¥ï¼Œä¹‹ååœ¨è¯¥é¡µé¢è·¯ç”±ç»„ä»¶ä¸­å†å¼•å…¥å’Œæ³¨å†Œ Vuex æ¨¡å—ã€‚</p>\n<h1 id=\"ç®€å•çš„ç¤ºä¾‹\" style=\"position:relative;\"><a href=\"#%E7%AE%80%E5%8D%95%E7%9A%84%E7%A4%BA%E4%BE%8B\" aria-label=\"ç®€å•çš„ç¤ºä¾‹ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ç®€å•çš„ç¤ºä¾‹</h1>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">PageA</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./views/PageA.js'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">VueRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  routes<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> path<span class=\"token operator\">:</span> <span class=\"token string\">'/page-a'</span><span class=\"token punctuation\">,</span> component<span class=\"token operator\">:</span> PageA <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ç®€å•çš„ Vuex æ¨¡å—ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// store/modules/page-a.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">VUEX_NS</span> <span class=\"token operator\">=</span> <span class=\"token string\">'page-a'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  namespaced<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      inventory<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        list<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  getters<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">inventoryList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">.</span>inventory<span class=\"token punctuation\">.</span>list\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å®è·µæ—¶é­é‡äº†å‡ ä¸ªé—®é¢˜ï¼š</p>\n<h2 id=\"é—®é¢˜-1ï¼šæœåŠ¡å™¨å®¢æˆ·ç«¯-åœ¨å°šæœªæ³¨å†Œ-module-æ—¶ï¼Œè°ƒç”¨å…¶ä¸‹çš„-actionmutation-ï¼Œvuex-å› æ‰¾ä¸åˆ°å¯¹åº”å‡½æ•°è€Œå‡ºé”™\" style=\"position:relative;\"><a href=\"#%E9%97%AE%E9%A2%98-1%EF%BC%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%A2%E6%88%B7%E7%AB%AF-%E5%9C%A8%E5%B0%9A%E6%9C%AA%E6%B3%A8%E5%86%8C-module-%E6%97%B6%EF%BC%8C%E8%B0%83%E7%94%A8%E5%85%B6%E4%B8%8B%E7%9A%84-actionmutation-%EF%BC%8Cvuex-%E5%9B%A0%E6%89%BE%E4%B8%8D%E5%88%B0%E5%AF%B9%E5%BA%94%E5%87%BD%E6%95%B0%E8%80%8C%E5%87%BA%E9%94%99\" aria-label=\"é—®é¢˜ 1ï¼šæœåŠ¡å™¨å®¢æˆ·ç«¯ åœ¨å°šæœªæ³¨å†Œ module æ—¶ï¼Œè°ƒç”¨å…¶ä¸‹çš„ actionmutation ï¼Œvuex å› æ‰¾ä¸åˆ°å¯¹åº”å‡½æ•°è€Œå‡ºé”™ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>é—®é¢˜ 1ï¼šæœåŠ¡å™¨/å®¢æˆ·ç«¯ åœ¨å°šæœªæ³¨å†Œ Module æ—¶ï¼Œè°ƒç”¨å…¶ä¸‹çš„ action/mutation ï¼ŒVuex å› æ‰¾ä¸åˆ°å¯¹åº”å‡½æ•°è€Œå‡ºé”™</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// views/PageA.js</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token constant\">PAGE_A_MODULE</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">VUEX_NS</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'store/modules/page-a'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'PageA'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">beforeCreate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$store<span class=\"token punctuation\">.</span><span class=\"token function\">registerModule</span><span class=\"token punctuation\">(</span><span class=\"token constant\">VUEX_NS</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">PAGE_A_MODULE</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$store<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">VUEX_NS</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/fetchInventory</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"è€ƒè™‘æœåŠ¡å™¨ç«¯é¢„å–æ•°æ®æ³¨å…¥ç»™å®¢æˆ·ç«¯çš„æ—¶å€™\" style=\"position:relative;\"><a href=\"#%E8%80%83%E8%99%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E9%A2%84%E5%8F%96%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5%E7%BB%99%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E6%97%B6%E5%80%99\" aria-label=\"è€ƒè™‘æœåŠ¡å™¨ç«¯é¢„å–æ•°æ®æ³¨å…¥ç»™å®¢æˆ·ç«¯çš„æ—¶å€™ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>è€ƒè™‘æœåŠ¡å™¨ç«¯é¢„å–æ•°æ®æ³¨å…¥ç»™å®¢æˆ·ç«¯çš„æ—¶å€™</h3>\n<p>å®¢æˆ·ï¼ˆæµè§ˆå™¨ï¼‰ç«¯åˆå§‹åŒ–ä»£ç ï¼Œåœ¨åˆå§‹åŒ– router ä¹‹å‰ï¼Œç»™ Vuex å…¨å±€ store æ³¨å…¥æ•°æ®ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// entry-client.js</span>\nstore<span class=\"token punctuation\">.</span><span class=\"token function\">replaceState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>__INITIAL_STATE__<span class=\"token punctuation\">)</span></code></pre></div>\n<p>æ­¤å¤„çš„ <code>__INITIAL_STATE__</code> æ˜¯ Vue SSR æä¾›çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä½¿å¾—æµè§ˆå™¨ç«¯å¯ä»¥å¤ç”¨æœåŠ¡å™¨ç«¯å·²ç»é¢„å–è¿‡çš„æ•°æ®ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// åœ¨æ‰€æœ‰é¢„å–é’©å­(preFetch hook) resolve åï¼Œ</span>\n<span class=\"token comment\">// æˆ‘ä»¬çš„ store ç°åœ¨å·²ç»å¡«å……å…¥æ¸²æŸ“åº”ç”¨ç¨‹åºæ‰€éœ€çš„çŠ¶æ€ã€‚</span>\n<span class=\"token comment\">// å½“æˆ‘ä»¬å°†çŠ¶æ€é™„åŠ åˆ°ä¸Šä¸‹æ–‡ï¼Œ</span>\n<span class=\"token comment\">// å¹¶ä¸” `template` é€‰é¡¹ç”¨äº renderer æ—¶ï¼Œ</span>\n<span class=\"token comment\">// çŠ¶æ€å°†è‡ªåŠ¨åºåˆ—åŒ–ä¸º `window.__INITIAL_STATE__`ï¼Œå¹¶æ³¨å…¥ HTMLã€‚</span>\ncontext<span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> store<span class=\"token punctuation\">.</span>state</code></pre></div>\n<p>æ­¤å¤„çš„ <code>asyncData</code> ä¸ <a href=\"https://ssr.vuejs.org/zh/guide/data.html#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%8F%96%E5%AD%98%E5%82%A8%E5%AE%B9%E5%99%A8-data-store\">Vue SSR æ–‡æ¡£ä¸­çš„ä¾‹å­</a>ç±»ä¼¼ï¼Œä¸ Nuxt.js ä¸­çš„åŒåå‡½æ•°ç”¨æ³•ç•¥æœ‰ä¸åŒã€‚</p>\n<p><code>prepareVuex</code> ä¸ºè‡ªå®šä¹‰çš„ç»„ä»¶é’©å­å‡½æ•°ï¼Œä¼šå…ˆäº asyncData è°ƒç”¨ï¼Œå…·ä½“è¿‡ç¨‹ä¹‹åæ¢è®¨ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>export default {\n<span class=\"token prefix unchanged\"> </span>  name: 'PageA',\n</span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span>  beforeCreate() {\n<span class=\"token prefix deleted\">-</span>    this.$store.registerModule(VUEX_NS, PAGE_A_MODULE)\n<span class=\"token prefix deleted\">-</span>    return this.$store.dispatch(`${VUEX_NS}/fetchInventory`)\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  prepareVuex({ store }) {\n<span class=\"token prefix inserted\">+</span>    store.registerModule(VUEX_NS, PAGE_A_MODULE)\n<span class=\"token prefix inserted\">+</span>  },\n<span class=\"token prefix inserted\">+</span>  asyncData({ store }) {\n<span class=\"token prefix inserted\">+</span>    return store.dispatch(`${VUEX_NS}/fetchInventory`)\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>  },\n<span class=\"token prefix unchanged\"> </span>}</span></code></pre></div>\n<p>æ­¤æ—¶ä¼šé‡è§</p>\n<h2 id=\"é—®é¢˜2-å®¢æˆ·ç«¯æ²¡æœ‰ç”¨ä¸ŠæœåŠ¡å™¨ç«¯é¢„å–çš„æ•°æ®\" style=\"position:relative;\"><a href=\"#%E9%97%AE%E9%A2%982-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B2%A1%E6%9C%89%E7%94%A8%E4%B8%8A%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E9%A2%84%E5%8F%96%E7%9A%84%E6%95%B0%E6%8D%AE\" aria-label=\"é—®é¢˜2 å®¢æˆ·ç«¯æ²¡æœ‰ç”¨ä¸ŠæœåŠ¡å™¨ç«¯é¢„å–çš„æ•°æ® permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>é—®é¢˜2: å®¢æˆ·ç«¯æ²¡æœ‰ç”¨ä¸ŠæœåŠ¡å™¨ç«¯é¢„å–çš„æ•°æ®</h2>\n<p>è§£å†³æ–¹å¼ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>export default {\n<span class=\"token prefix unchanged\"> </span>  name: 'PageA',\n</span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span>  prepareVuex({ store }) {\n<span class=\"token prefix deleted\">-</span>    store.registerModule(VUEX_NS, PAGE_A_MODULE)\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  prepareVuex({ store, isClientInitialRoute }) {\n<span class=\"token prefix inserted\">+</span>    store.registerModule(VUEX_NS, PAGE_A_MODULE, { preserveState: isClientInitialRoute })\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>  },\n<span class=\"token prefix unchanged\"> </span>  asyncData({ store }) {\n<span class=\"token prefix unchanged\"> </span>    return store.dispatch(`${VUEX_NS}/fetchInventory`)\n<span class=\"token prefix unchanged\"> </span>  },\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  beforeDestroy() {\n<span class=\"token prefix inserted\">+</span>    // é”€æ¯è¯¥æ¨¡å—\n<span class=\"token prefix inserted\">+</span>    this.$store.unregisterModule(VUEX_NS)\n<span class=\"token prefix inserted\">+</span>  }\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>}</span></code></pre></div>\n<p>æ³¨å†Œ Vuex æ¨¡å—çš„æ—¶å€™ä½¿ç”¨äº† <code>preserveState</code> ï¼Œè‹¥å¯ç”¨æ­¤é€‰é¡¹ï¼Œæ³¨å†Œ Module æ—¶è‹¥ <code>store.state[namespace]</code> ä¸‹å·²å­˜åœ¨æ•°æ®ï¼Œä¾¿ä¸ä¼šä½¿ç”¨å£°æ˜ vuex æ¨¡å—æ—¶çš„åˆå§‹ state è¦†ç›–å·²æœ‰æ•°æ®ã€‚ä½†éœ€è¦æ³¨æ„ï¼Œè‹¥ state ä¸­æ²¡æœ‰ namespace ç›¸åº”æ•°æ®å´å¼€å¯äº†æ­¤é€‰é¡¹ï¼ŒVuex è¿˜æ˜¯ä¼šæŠ¥é”™ã€‚å› æ­¤æ­¤å¤„æ·»åŠ äº†ä¸€ä¸ªè¾“å…¥å‚æ•° <code>isClientInitialRoute</code> ï¼Œ åªæœ‰åœ¨å®¢æˆ·ç«¯åˆæ¬¡è¿›å…¥é¡µé¢ï¼ˆå¯ä»¥ä½¿ç”¨æœåŠ¡å™¨é¢„å–æ•°æ®ï¼‰æ—¶æ‰å¼€å¯ <code>preserveState</code> é€‰é¡¹ã€‚</p>\n<h2 id=\"é—®é¢˜3-ç»„ä»¶çƒ­æ›´æ–°æ—¶ï¼Œvuex-æ¨¡å—è¢«é”€æ¯\" style=\"position:relative;\"><a href=\"#%E9%97%AE%E9%A2%983-%E7%BB%84%E4%BB%B6%E7%83%AD%E6%9B%B4%E6%96%B0%E6%97%B6%EF%BC%8Cvuex-%E6%A8%A1%E5%9D%97%E8%A2%AB%E9%94%80%E6%AF%81\" aria-label=\"é—®é¢˜3 ç»„ä»¶çƒ­æ›´æ–°æ—¶ï¼Œvuex æ¨¡å—è¢«é”€æ¯ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>é—®é¢˜3: ç»„ä»¶çƒ­æ›´æ–°æ—¶ï¼ŒVuex æ¨¡å—è¢«é”€æ¯</h2>\n<p>å¼€å‘æœŸé—´ä½¿ç”¨ HotModuleReplacementPlugin å’Œ vue-loaderï¼Œè‹¥æ”¹å˜äº† PageA.js ä¸­çš„ä»£ç ï¼Œä¼šè§¦å‘çƒ­æ›´æ–°ã€‚åœ¨ <a href=\"https://github.com/vuejs/vue-hot-reload-api/blob/master/src/index.js\">vue-hot-reload-api</a> ä¸­ï¼Œå½“ä½¿ç”¨ vue-hot-reload-api çš„ <code>reload</code> æ–¹æ³•å¤„ç†ç»„ä»¶å®ä¾‹æ—¶ï¼Œè¯¥å®ä¾‹ä¼šè¢«é”€æ¯è€Œåé‡æ–°åˆ›å»ºã€‚<code>beforeDestroy</code> ä¸­é”€æ¯äº† Vuex çš„ <code>page-a</code> æ¨¡å—ï¼Œå´æ²¡æœ‰è°ƒç”¨ <code>prepareVuex</code> æ–¹æ³•é‡æ–°æ³¨å†Œï¼Œå› æ­¤çƒ­æ›´æ–°ä¹‹åï¼Œä½¿ç”¨è¯¥æ¨¡å—ä¹Ÿä¼šæŠ¥é”™ã€‚</p>\n<p>è§£å†³æ–¹æ¡ˆï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>  asyncData({ store }) {\n<span class=\"token prefix unchanged\"> </span>    return store.dispatch(`${VUEX_NS}/fetchInventory`)\n<span class=\"token prefix unchanged\"> </span>  },\n</span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span>  beforeDestroy() {\n<span class=\"token prefix deleted\">-</span>    // é”€æ¯è¯¥æ¨¡å—\n<span class=\"token prefix deleted\">-</span>    this.$store.unregisterModule(VUEX_NS)\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  beforeRouteLeave(to, from, next) {\n<span class=\"token prefix inserted\">+</span>    this.$once('hook:beforeDestroy', () => {\n<span class=\"token prefix inserted\">+</span>      // é”€æ¯è¯¥æ¨¡å—\n<span class=\"token prefix inserted\">+</span>      this.$store.unregisterModule(VUEX_NS)\n<span class=\"token prefix inserted\">+</span>    })\n<span class=\"token prefix inserted\">+</span>    next()\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>  }\n<span class=\"token prefix unchanged\"> </span>}</span></code></pre></div>\n<p>ä»”ç»†æƒ³æƒ³ï¼Œæ³¨å†Œæ¨¡å—çš„æ—¶æœºæ˜¯ä¸è·¯ç”±ç›¸å…³çš„ï¼ˆè¿›å…¥é¡µé¢ä¹‹å‰ï¼‰ï¼Œé‚£ä¹ˆé”€æ¯çš„æ—¶æœºä¹Ÿå¯ä»¥ä¸è·¯ç”±ç›¸å…³ã€‚ä¸è¿‡å¹¶ä¸é€‚åˆåœ¨ <code>beforeRouteLeave</code> é’©å­ä¸­ç«‹åˆ»é”€æ¯æ¨¡å—ã€‚å› ä¸ºæ ¹æ®ä»¥ä¸‹ vue-router æ–‡æ¡£å†…å®¹ï¼Œåœ¨æ­¤é’©å­è¢«è°ƒç”¨å®Œæˆæ—¶ï¼Œæ•´ä¸ªé¡µé¢è¿˜æ˜¯åœ¨æ­£å¸¸å·¥ä½œçš„ï¼ˆç¬¬2æ­¥åˆ°ç¬¬11æ­¥ä¸­é—´ï¼‰ï¼Œä»æœªè¿›å…¥ç»„ä»¶çš„ destroy è¿‡ç¨‹ï¼Œæ­¤æ—¶é”€æ¯æ¨¡å—ä¼šå¯¼è‡´ä¾èµ–å…¶çš„æ‰€æœ‰ç»„ä»¶å¼‚å¸¸ã€‚</p>\n<blockquote>\n<p><cite><a href=\"https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%AE%8C%E6%95%B4%E7%9A%84%E5%AF%BC%E8%88%AA%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B\">vue-router æ–‡æ¡£ä¸­å…³äºå¯¼èˆªè§£ææµç¨‹çš„éƒ¨åˆ†</a></cite></p>\n<ol>\n<li>å¯¼èˆªè¢«è§¦å‘ã€‚</li>\n<li>åœ¨å¤±æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ç¦»å¼€å®ˆå«ã€‚</li>\n<li>è°ƒç”¨å…¨å±€çš„ beforeEach å®ˆå«ã€‚</li>\n<li>åœ¨é‡ç”¨çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteUpdate å®ˆå« (2.2+)ã€‚</li>\n<li>åœ¨è·¯ç”±é…ç½®é‡Œè°ƒç”¨ beforeEnterã€‚</li>\n<li>è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶ã€‚</li>\n<li>åœ¨è¢«æ¿€æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteEnterã€‚</li>\n<li>è°ƒç”¨å…¨å±€çš„ beforeResolve å®ˆå« (2.5+)ã€‚</li>\n<li>å¯¼èˆªè¢«ç¡®è®¤ã€‚</li>\n<li>è°ƒç”¨å…¨å±€çš„ afterEach é’©å­ã€‚</li>\n<li>è§¦å‘ DOM æ›´æ–°ã€‚</li>\n<li>ç”¨åˆ›å»ºå¥½çš„å®ä¾‹è°ƒç”¨ beforeRouteEnter å®ˆå«ä¸­ä¼ ç»™ next çš„å›è°ƒå‡½æ•°ã€‚</li>\n</ol>\n</blockquote>\n<p>å› æ­¤å®‰å…¨çš„æ¨¡å—é”€æ¯æ—¶æœºéœ€è¦åœ¨ DOM æ›´æ–°ä¸­æˆ–åï¼Œæ—§çš„é¡µé¢ç»„ä»¶å®ä¾‹é”€æ¯è¿‡ç¨‹è°ƒç”¨æ—¶ã€‚</p>\n<h1 id=\"ç›¸å…³ä»£ç \" style=\"position:relative;\"><a href=\"#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81\" aria-label=\"ç›¸å…³ä»£ç  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ç›¸å…³ä»£ç </h1>\n<p>æœ€åçš„ PageA.jsï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token constant\">PAGE_A_MODULE</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">VUEX_NS</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'store/modules/page-a'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'PageA'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">prepareVuex</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> store<span class=\"token punctuation\">,</span> isClientInitialRoute <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    store<span class=\"token punctuation\">.</span><span class=\"token function\">registerModule</span><span class=\"token punctuation\">(</span><span class=\"token constant\">VUEX_NS</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">PAGE_A_MODULE</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> preserveState<span class=\"token operator\">:</span> isClientInitialRoute <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">asyncData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> store<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">VUEX_NS</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/fetchInventory</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">beforeRouteLeave</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">to<span class=\"token punctuation\">,</span> <span class=\"token keyword\">from</span><span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$once</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hook:beforeDestroy'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// é”€æ¯è¯¥æ¨¡å—</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$store<span class=\"token punctuation\">.</span><span class=\"token function\">unregisterModule</span><span class=\"token punctuation\">(</span><span class=\"token constant\">VUEX_NS</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä¸¤ç«¯çš„å…¥å£æ–‡ä»¶ä¸­ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// router-util.ts</span>\n\n<span class=\"token keyword\">import</span> Vue<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> VueConstructor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">VueCtor</span> <span class=\"token operator\">=</span> VueConstructor<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getHookFromComponent</span><span class=\"token punctuation\">(</span>compo<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> compo<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>compo<span class=\"token punctuation\">.</span>options <span class=\"token operator\">&amp;&amp;</span> compo<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">callComponentsHookWith</span><span class=\"token punctuation\">(</span>compoList<span class=\"token operator\">:</span> VueCtor<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> hookName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> context<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> compoList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> hook <span class=\"token operator\">=</span> <span class=\"token function\">getHookFromComponent</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">,</span> hookName<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hook<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">hook</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>_ <span class=\"token operator\">=></span> _<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// entry-server.js</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token parameter\">context</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// set router's location</span>\n    router<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span>\n\n    router<span class=\"token punctuation\">.</span><span class=\"token function\">onReady</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> matchedComponents <span class=\"token operator\">=</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">getMatchedComponents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// åŠ ä¸Š try/catch é¿å…æ­¤ block å†…æŠ›å‡ºçš„é”™è¯¯é€ æˆ promise unhandledRejection</span>\n        <span class=\"token function\">callComponentsHookWith</span><span class=\"token punctuation\">(</span>matchedComponents<span class=\"token punctuation\">,</span> <span class=\"token string\">'prepareVuex'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">const</span> asyncDataResults <span class=\"token operator\">=</span> <span class=\"token function\">callComponentsHookWith</span><span class=\"token punctuation\">(</span>matchedComponents<span class=\"token punctuation\">,</span> <span class=\"token string\">'asyncData'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            store<span class=\"token punctuation\">,</span>\n            route<span class=\"token operator\">:</span> router<span class=\"token punctuation\">.</span>currentRoute<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n        Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>asyncDataResults<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          context<span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> store<span class=\"token punctuation\">.</span>state\n          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>reject<span class=\"token punctuation\">)</span>\n\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// entry-client.js</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">onReady</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">initialRoute</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> initialMatched <span class=\"token operator\">=</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">getMatchedComponents</span><span class=\"token punctuation\">(</span>initialRoute<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">callComponentsHookWith</span><span class=\"token punctuation\">(</span>initialMatched<span class=\"token punctuation\">,</span> <span class=\"token string\">'prepareVuex'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> store<span class=\"token punctuation\">,</span> isClientInitialRoute<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  router<span class=\"token punctuation\">.</span><span class=\"token function\">beforeResolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">to<span class=\"token punctuation\">,</span> <span class=\"token keyword\">from</span><span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> matched <span class=\"token operator\">=</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">getMatchedComponents</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">callComponentsHookWith</span><span class=\"token punctuation\">(</span>matched<span class=\"token punctuation\">,</span> <span class=\"token string\">'prepareVuex'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token function\">callComponentsHookWith</span><span class=\"token punctuation\">(</span>activated<span class=\"token punctuation\">,</span> <span class=\"token string\">'asyncData'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> store<span class=\"token punctuation\">,</span> route<span class=\"token operator\">:</span> to <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// actually mount to DOM</span>\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">$mount</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#app'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>","excerpt":"å‰è¨€ æ„å»ºå¤§å‹ SPA åº”ç”¨æ—¶ï¼Œä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼Œåœ¨ Vue ç”Ÿæ€ä¸‹ï¼Œä½¿ç”¨ vue-router å¾ˆå®¹æ˜“å®ç°ç»„ä»¶çš„æ‡’åŠ è½½ã€‚ ä½†åº”ç”¨é‡Œé™¤äº†ç»„ä»¶ï¼Œè¿˜æœ‰åºå¤§çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™éƒ¨åˆ†å¦‚ä½•åˆ†å‰²å’Œæ‡’åŠ è½½æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿ ä½¿ç”¨ Vuexâ€¦","tableOfContents":"<ul>\n<li><a href=\"/2018-07-03-Vuex-Dynamic-Module-Hints/#%E5%89%8D%E8%A8%80\">å‰è¨€</a></li>\n<li>\n<p><a href=\"/2018-07-03-Vuex-Dynamic-Module-Hints/#%E7%AE%80%E5%8D%95%E7%9A%84%E7%A4%BA%E4%BE%8B\">ç®€å•çš„ç¤ºä¾‹</a></p>\n<ul>\n<li>\n<p><a href=\"/2018-07-03-Vuex-Dynamic-Module-Hints/#%E9%97%AE%E9%A2%98-1%EF%BC%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%A2%E6%88%B7%E7%AB%AF-%E5%9C%A8%E5%B0%9A%E6%9C%AA%E6%B3%A8%E5%86%8C-module-%E6%97%B6%EF%BC%8C%E8%B0%83%E7%94%A8%E5%85%B6%E4%B8%8B%E7%9A%84-actionmutation-%EF%BC%8Cvuex-%E5%9B%A0%E6%89%BE%E4%B8%8D%E5%88%B0%E5%AF%B9%E5%BA%94%E5%87%BD%E6%95%B0%E8%80%8C%E5%87%BA%E9%94%99\">é—®é¢˜ 1ï¼šæœåŠ¡å™¨/å®¢æˆ·ç«¯ åœ¨å°šæœªæ³¨å†Œ Module æ—¶ï¼Œè°ƒç”¨å…¶ä¸‹çš„ action/mutation ï¼ŒVuex å› æ‰¾ä¸åˆ°å¯¹åº”å‡½æ•°è€Œå‡ºé”™</a></p>\n<ul>\n<li><a href=\"/2018-07-03-Vuex-Dynamic-Module-Hints/#%E8%80%83%E8%99%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E9%A2%84%E5%8F%96%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5%E7%BB%99%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E6%97%B6%E5%80%99\">è€ƒè™‘æœåŠ¡å™¨ç«¯é¢„å–æ•°æ®æ³¨å…¥ç»™å®¢æˆ·ç«¯çš„æ—¶å€™</a></li>\n</ul>\n</li>\n<li><a href=\"/2018-07-03-Vuex-Dynamic-Module-Hints/#%E9%97%AE%E9%A2%982-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B2%A1%E6%9C%89%E7%94%A8%E4%B8%8A%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E9%A2%84%E5%8F%96%E7%9A%84%E6%95%B0%E6%8D%AE\">é—®é¢˜2: å®¢æˆ·ç«¯æ²¡æœ‰ç”¨ä¸ŠæœåŠ¡å™¨ç«¯é¢„å–çš„æ•°æ®</a></li>\n<li><a href=\"/2018-07-03-Vuex-Dynamic-Module-Hints/#%E9%97%AE%E9%A2%983-%E7%BB%84%E4%BB%B6%E7%83%AD%E6%9B%B4%E6%96%B0%E6%97%B6%EF%BC%8Cvuex-%E6%A8%A1%E5%9D%97%E8%A2%AB%E9%94%80%E6%AF%81\">é—®é¢˜3: ç»„ä»¶çƒ­æ›´æ–°æ—¶ï¼ŒVuex æ¨¡å—è¢«é”€æ¯</a></li>\n</ul>\n</li>\n<li><a href=\"/2018-07-03-Vuex-Dynamic-Module-Hints/#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81\">ç›¸å…³ä»£ç </a></li>\n</ul>","fields":{"slug":"/2018-07-03-Vuex-Dynamic-Module-Hints/","featureImageSrc":null},"frontmatter":{"title":"Vuex æ¨¡å—åŠ¨æ€æ³¨å†Œçš„ä¸€äº›å®è·µç»éªŒ","date":"2018-07-03","author":null,"tags":["Vue","Vuex"],"use_toc":true,"coverImage":null}}},"pageContext":{"type":"posts","next":{"fields":{"slug":"/2018-05-03-Try-Rust-Webassemly/"},"frontmatter":{"title":"Try Rust WebAssembly","tags":["WebAssembly","Rust"]},"fileAbsolutePath":"/Users/bytedance/mydemos/gatsby-hello-friend/content/posts/2018-05-03-Try-Rust-Webassemly.md"},"previous":{"fields":{"slug":"/2018-07-31-Goodbye My Santa Monica Dream/"},"frontmatter":{"title":"Goodbye My Santa Monica Dream ğŸµ","tags":["å‰ä»–","éŸ³ä¹"]},"fileAbsolutePath":"/Users/bytedance/mydemos/gatsby-hello-friend/content/posts/2018-07-31-Goodbye My Santa Monica Dream.md"},"slug":"/2018-07-03-Vuex-Dynamic-Module-Hints/"}},"staticQueryHashes":["1425477374","3128451518"]}