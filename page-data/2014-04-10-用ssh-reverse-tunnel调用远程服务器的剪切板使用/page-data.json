{"componentChunkName":"component---src-templates-page-js","path":"/2014-04-10-用ssh-reverse-tunnel调用远程服务器的剪切板使用/","result":{"data":{"site":{"siteMetadata":{"title":"HP goes FE","author":"@hikerpig"}},"markdownRemark":{"id":"084f3479-f991-5a2c-a70f-5684bd89be17","html":"<p>用ssh在远程服务器上工作的时候看着vim的满屏代码，突然怎么都没办法复制下来（其实鼠标还是可以用的，不过如果内容多到跨屏那就呵呵呵了），真是急死人，万能的google啊帮助我吧。</p>\n<h1 id=\"在本机上要做的事\" style=\"position:relative;\"><a href=\"#%E5%9C%A8%E6%9C%AC%E6%9C%BA%E4%B8%8A%E8%A6%81%E5%81%9A%E7%9A%84%E4%BA%8B\" aria-label=\"在本机上要做的事 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>在本机上要做的事</h1>\n<p>先用netcat建立一个剪贴板服务在后台运行：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">PORT</span><span class=\"token operator\">=</span><span class=\"token number\">5566</span>\n<span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">;</span><span class=\"token keyword\">do</span> <span class=\"token function\">nc</span> -l localhost <span class=\"token variable\">$PORT</span> <span class=\"token operator\">|</span> pbcopy <span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span> <span class=\"token operator\">&amp;</span></code></pre></div>\n<p>现在这两个命令的效果是一样的了：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"剪贴板\"</span> <span class=\"token operator\">|</span> pbcopy\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"剪贴板\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">nc</span> localhost <span class=\"token number\">5566</span></code></pre></div>\n<p>然后我们在ssh的时候加上反向代理参数:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 表明当前ssh会话所有向远程服务器B的5566端口发送的信息都会转到本机A的5566端口上</span>\n<span class=\"token function\">ssh</span> user@remote-server.com -R <span class=\"token number\">5566</span>:localhost:5566</code></pre></div>\n<p>现在在ssh会话中尝试下：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> test_file.txt <span class=\"token operator\">|</span> <span class=\"token function\">nc</span> -v localhost <span class=\"token number\">5566</span></code></pre></div>\n<p>然后ctrl + v 试试，哈哈。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Connection to localhost <span class=\"token number\">5566</span> port <span class=\"token punctuation\">[</span>tcp/*<span class=\"token punctuation\">]</span> succeeded<span class=\"token operator\">!</span></code></pre></div>\n<p>去掉-v(verbose)选项可以让一切在默默中进行。</p>\n<p>我整理出一个脚本，运行这个脚本就能搞出一个能偷用剪贴板的ssh会话了。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">PORT</span><span class=\"token operator\">=</span><span class=\"token number\">5566</span>\n<span class=\"token assign-left variable\">ssh_server</span><span class=\"token operator\">=</span><span class=\"token string\">'ubuntu@crmdev'</span>\n\n<span class=\"token comment\"># using mac</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> -n <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">which</span> pbcopy<span class=\"token variable\">`</span></span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"@Mac\"</span>\n  <span class=\"token assign-left variable\">copy_command</span><span class=\"token operator\">=</span><span class=\"token string\">'pbcopy'</span>\n<span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> -n <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">which</span> xsel<span class=\"token variable\">`</span></span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"you can use xsel on ubuntu\"</span>\n  <span class=\"token assign-left variable\">copy_command</span><span class=\"token operator\">=</span><span class=\"token string\">'xsel'</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"you don't have clipboard utility\"</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token assign-left variable\">existed</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">ps</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token function\">nc</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> $PORT<span class=\"token variable\">`</span></span>\n\n<span class=\"token comment\"># start a netcat server</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> -n <span class=\"token variable\">$existed</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"nc <span class=\"token variable\">$PORT</span> already existed\"</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"nc <span class=\"token variable\">$PORT</span> does not exist\"</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> -n <span class=\"token variable\">$copy_command</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">;</span><span class=\"token keyword\">do</span> <span class=\"token function\">nc</span> -l localhost <span class=\"token variable\">$PORT</span> <span class=\"token operator\">|</span> <span class=\"token variable\">$copy_command</span> <span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span> <span class=\"token operator\">&amp;</span>\n  <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token comment\"># ssh the server</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> -n <span class=\"token variable\">$copy_command</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token function\">ssh</span> -R <span class=\"token variable\">$PORT</span>:localhost:<span class=\"token variable\">$PORT</span> <span class=\"token variable\">$ssh_server</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token function\">ssh</span> <span class=\"token variable\">$ssh_server</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<h2 id=\"其他方法\" style=\"position:relative;\"><a href=\"#%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95\" aria-label=\"其他方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>其他方法</h2>\n<p>还有一个方法是<a href=\"https://defuse.ca/blog/clipboard-over-ssh-with-vim\">开启ssh的X11Forwarding选项</a>，还没试过。</p>\n<h1 id=\"在远程服务器需要做的事\" style=\"position:relative;\"><a href=\"#%E5%9C%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9C%80%E8%A6%81%E5%81%9A%E7%9A%84%E4%BA%8B\" aria-label=\"在远程服务器需要做的事 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>在远程服务器需要做的事</h1>\n<p>使用vim编辑的时候，为了使用系统剪贴板并传到5566端口上，需要覆盖下我们在vim里的复制键位映射：</p>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\">vmap <span class=\"token comment\">\"+y ::w !nc localhost 5566&lt;CR></span></code></pre></div>\n<p>其中<code>'&#x3C;,'></code>对应的是在Vim的Visual模式下选中的文本，使用<code>!nc</code>调用shell中的<code>nc</code>程序，便可以转发选中内容。</p>\n<p>离鼠标依赖又远了一点。</p>\n<h1 id=\"参考文章\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0\" aria-label=\"参考文章 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考文章</h1>\n<ul>\n<li><a href=\"http://gistflow.com/posts/934-copy-from-a-remote-server-to-the-local-mac-clipboard\">http://gistflow.com/posts/934-copy-from-a-remote-server-to-the-local-mac-clipboard</a></li>\n<li><a href=\"http://evolvingweb.ca/blog/exposing-your-clipboard-over-ssh\">exposing-your-clipboard-over-ssh</a></li>\n<li><a href=\"http://superuser.com/questions/407888/synchronize-pasteboard-between-remote-tmux-session-and-local-mac-os-pasteboard\">synchronize-pasteboard-between-remote-tmux-session-and-local-mac-os-pasteboard</a></li>\n<li><a href=\"http://benninger.ca/posts/vim-use-selected-text-as-input-to-a-shell-command/\">vim-use-selected-text-as-input-to-a-shell-command</a></li>\n</ul>","excerpt":"用ssh在远程服务器上工作的时候看着vim的满屏代码，突然怎么都没办法复制下来（其实鼠标还是可以用的，不过如果内容多到跨屏那就呵呵呵了），真是急死人，万能的google啊帮助我吧。 在本机上要做的事 先用netcat…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/2014-04-10-%E7%94%A8ssh-reverse-tunnel%E8%B0%83%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%89%AA%E5%88%87%E6%9D%BF%E4%BD%BF%E7%94%A8/#%E5%9C%A8%E6%9C%AC%E6%9C%BA%E4%B8%8A%E8%A6%81%E5%81%9A%E7%9A%84%E4%BA%8B\">在本机上要做的事</a></p>\n<ul>\n<li><a href=\"/2014-04-10-%E7%94%A8ssh-reverse-tunnel%E8%B0%83%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%89%AA%E5%88%87%E6%9D%BF%E4%BD%BF%E7%94%A8/#%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95\">其他方法</a></li>\n</ul>\n</li>\n<li><a href=\"/2014-04-10-%E7%94%A8ssh-reverse-tunnel%E8%B0%83%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%89%AA%E5%88%87%E6%9D%BF%E4%BD%BF%E7%94%A8/#%E5%9C%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9C%80%E8%A6%81%E5%81%9A%E7%9A%84%E4%BA%8B\">在远程服务器需要做的事</a></li>\n<li><a href=\"/2014-04-10-%E7%94%A8ssh-reverse-tunnel%E8%B0%83%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%89%AA%E5%88%87%E6%9D%BF%E4%BD%BF%E7%94%A8/#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0\">参考文章</a></li>\n</ul>","fields":{"slug":"/2014-04-10-用ssh-reverse-tunnel调用远程服务器的剪切板使用/","featureImageSrc":null},"frontmatter":{"title":"用 ssh reverse tunnel 调用远程服务器的剪切板使用","date":"2014-04-10","author":null,"tags":["Vim"],"use_toc":null,"coverImage":null}}},"pageContext":{"type":"posts","next":{"fields":{"slug":"/2014-04-08-在Jekyll博客里优雅地嵌入Github-Gist/"},"frontmatter":{"title":"在Jekyll博客里优雅地嵌入Github Gist","tags":["Jekyll","Github"]},"fileAbsolutePath":"/Users/bytedance/mydemos/gatsby-hello-friend/content/posts/2014-04-08-在Jekyll博客里优雅地嵌入Github-Gist.md"},"previous":{"fields":{"slug":"/2014-04-22-Coffeescript小角落，和javascript混写/"},"frontmatter":{"title":"Coffeescript小角落，和javascript混写","tags":["Coffeescript"]},"fileAbsolutePath":"/Users/bytedance/mydemos/gatsby-hello-friend/content/posts/2014-04-22-Coffeescript小角落，和javascript混写.md"},"slug":"/2014-04-10-用ssh-reverse-tunnel调用远程服务器的剪切板使用/"}},"staticQueryHashes":["1425477374","3128451518"]}