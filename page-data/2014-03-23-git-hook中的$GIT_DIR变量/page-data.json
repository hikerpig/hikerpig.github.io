{"componentChunkName":"component---src-templates-page-js","path":"/2014-03-23-git-hook中的$GIT_DIR变量/","result":{"data":{"site":{"siteMetadata":{"title":"HP goes FE","author":"@hikerpig"}},"markdownRemark":{"id":"8b16a752-c7a3-5ff7-860d-2f7639a579fc","html":"<p>一直使用githook post-update来部署我的jekyll博客，每次push到远程git仓库的时候，在vps上的生产目录会自动更新和重新生成页面和静态资源， post-update文件是这样的：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/usr/zsh</span>\n\n<span class=\"token assign-left variable\">branchName</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> rev-parse --symbolic --abbrev-ref $1<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/home/******\n<span class=\"token assign-left variable\">BLOG_DIR</span><span class=\"token operator\">=</span><span class=\"token environment constant\">$HOME</span>/*******\n\n<span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$BLOG_DIR</span>\n<span class=\"token function\">git</span> pull origin <span class=\"token variable\">$branchName</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$branchName</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"master\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token punctuation\">[</span> -s <span class=\"token environment constant\">$HOME</span>/.nvm/nvm.sh <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">.</span> <span class=\"token environment constant\">$HOME</span>/.nvm/nvm.sh <span class=\"token comment\"># This loads NVM</span>\n  <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token environment constant\">$HOME</span>/.rvm/bin <span class=\"token comment\"># Add RVM to PATH for scripting</span>\n  nvm use <span class=\"token number\">113</span>\n  <span class=\"token environment constant\">$HOME</span>/.rvm/bin/rvm use ruby-2.0.0\n  jekyll build\n  <span class=\"token function\">make</span> front\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token builtin class-name\">exec</span> <span class=\"token function\">git</span> update-server-info</code></pre></div>\n<p>但是执行的时候会出现一个奇怪的问题：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Counting objects: <span class=\"token number\">5</span>, done.\nDelta compression using up to <span class=\"token number\">4</span> threads.\nCompressing objects: <span class=\"token number\">100</span>% <span class=\"token punctuation\">(</span><span class=\"token number\">3</span>/3<span class=\"token punctuation\">)</span>, done.\nWriting objects: <span class=\"token number\">100</span>% <span class=\"token punctuation\">(</span><span class=\"token number\">3</span>/3<span class=\"token punctuation\">)</span>, <span class=\"token number\">281</span> bytes <span class=\"token operator\">|</span> <span class=\"token number\">0</span> bytes/s, done.\nTotal <span class=\"token number\">3</span> <span class=\"token punctuation\">(</span>delta <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>, reused <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span>delta <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\nremote: fatal: Not a <span class=\"token function\">git</span> repository: <span class=\"token string\">'.'</span>\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>最后的这一句表示出错了，而且git pull也没有正确进行。</p>\n<p>有人在<a href=\"(http://stackoverflow.com/questions/4043609/getting-fatal-not-a-git-repository-when-using-post-update-hook-to-execut)\">这个问题</a>中谈到解决方法，改进的部分在这里：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$BLOG_DIR</span> <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">exit</span>\n<span class=\"token builtin class-name\">unset</span> GIT_DIR\n<span class=\"token function\">git</span> pull origin <span class=\"token variable\">$branchName</span></code></pre></div>\n<p>之后果然就可以正确地pull代码了。</p>","excerpt":"一直使用githook post-update来部署我的jekyll博客，每次push到远程git仓库的时候，在vps上的生产目录会自动更新和重新生成页面和静态资源， post-update文件是这样的： 但是执行的时候会出现一个奇怪的问题： 最后的这一句表示出错了，而且git…","tableOfContents":"","fields":{"slug":"/2014-03-23-git-hook中的$GIT_DIR变量/","featureImageSrc":null},"frontmatter":{"title":"git hook中的$GIT_DIR","date":"2014-03-23","author":null,"tags":["Git"],"use_toc":null,"coverImage":null}}},"pageContext":{"type":"posts","next":{"fields":{"slug":"/2014-03-21-git小技巧七七八八/"},"frontmatter":{"title":"git小技巧七七八八","tags":["git","tip"]},"fileAbsolutePath":"/Users/bytedance/mydemos/gatsby-hello-friend/content/posts/2014-03-21-git小技巧七七八八.md"},"previous":{"fields":{"slug":"/2014-03-31-放过Pygments/"},"frontmatter":{"title":"放过Pygments,让Prism来给Jekyll博客加上代码高亮","tags":["jekyll","外貌协会","折腾"]},"fileAbsolutePath":"/Users/bytedance/mydemos/gatsby-hello-friend/content/posts/2014-03-31-放过Pygments.md"},"slug":"/2014-03-23-git-hook中的$GIT_DIR变量/"}},"staticQueryHashes":["1425477374","3128451518"]}