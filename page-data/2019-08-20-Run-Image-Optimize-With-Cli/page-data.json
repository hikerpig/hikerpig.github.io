{"componentChunkName":"component---src-templates-page-js","path":"/2019-08-20-Run-Image-Optimize-With-Cli/","result":{"data":{"site":{"siteMetadata":{"title":"HP goes FE","author":"@hikerpig"}},"markdownRemark":{"id":"481859b6-a40f-5941-9f1b-78ec2c0a1c0d","html":"<h1 id=\"imagemin-cli\" style=\"position:relative;\"><a href=\"#imagemin-cli\" aria-label=\"imagemin cli permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>imagemin-cli</h1>\n<p><a href=\"https://github.com/imagemin/imagemin-cli\">imagemin/imagemin-cli</a> 是一个用 node.js 写的工具，调用的都是纯 CLI 的开源程序，所以平台兼容性好很多。其依赖的 <a href=\"https://github.com/imagemin/imagemin\">imagemin</a> 项目支持 <code>imagemin-*</code> 形式的 npm package 插件扩展，cli 默认的插件有这 4 个。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\t&#39;gifsicle&#39;\n\t&#39;jpegtran&#39;\n\t&#39;optipng&#39;\n\t&#39;svgo&#39;</code></pre></div>\n<p>使用的时候会检测当前系统变量里有没有对应的可执行文件，没有的话会自动下载安装，真正做到了开箱即用。imagemin 在前端自动化工作流中有诸多支持，例如 <a href=\"https://github.com/Klathmon/imagemin-webpack-plugin\">imagemin-webpack-plugin</a>，<a href=\"https://github.com/sindresorhus/gulp-imagemin\">gulp-imagemin</a>。</p>\n<p>官方维护的插件列表和项目构建支持可见 <a href=\"https://github.com/imagemin\">github 下的 imagemin 组织</a> 。</p>\n<h2 id=\"使用示例\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B\" aria-label=\"使用示例 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用示例</h2>\n<p><code>--help</code> 里给的例子:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  Examples\n    $ imagemin images/* --out-dir=build\n    $ imagemin foo.png &gt; foo-optimized.png\n    $ cat foo.png | imagemin &gt; foo-optimized.png\n    $ imagemin --plugin=pngquant foo.png &gt; foo-optimized.png</code></pre></div>\n<h1 id=\"imageoptim-cli\" style=\"position:relative;\"><a href=\"#imageoptim-cli\" aria-label=\"imageoptim cli permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ImageOptim-CLI</h1>\n<p>仅 Mac 可用，<a href=\"https://github.com/JamieMason/ImageOptim-CLI\">ImageOptim-CLI</a> 包装了几个 Mac 下 GUI/CLI 图片压缩工具的调用，支持调用的 App 有：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Supported Apps:\n\nImageAlpha: https://pngmini.com\nImageOptim: https://imageoptim.com\nJPEGmini Lite: https://itunes.apple.com/us/app/jpegmini-lite/id525742250\nJPEGmini Pro: https://itunes.apple.com/us/app/jpegmini-pro/id887163276\nJPEGmini: https://itunes.apple.com/us/app/jpegmini/id498944723</code></pre></div>\n<p>常见的 JPEG/PNG/GIF/SVG 等格式都可以压缩。</p>\n<p>调用方式很暴力，直接硬编码了应用的路径。\f</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">PNGQUANT_BIN_PATH</span> <span class=\"token operator\">=</span> <span class=\"token string\">'/Applications/ImageAlpha.app/Contents/MacOS/pngquant'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">IMAGEOPTIM_BIN_PATH</span> <span class=\"token operator\">=</span> <span class=\"token string\">'/Applications/ImageOptim.app/Contents/MacOS/ImageOptim'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>所以先要提前安装好相应的 App。</p>\n<h2 id=\"安装\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%85\" aria-label=\"安装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g imageoptim-cli</code></pre></div>\n<p>默认使用的是 <a href=\"https://imageoptim.com/mac\">ImageOptim</a>，一个开源的 GUI 图片压缩工具，集成了针对各种格式图片的优秀开源压缩工具。</p>\n<blockquote>\n<p><a href=\"https://imageoptim.com/\">ImageOptim</a> is a GUI for lossless image optimization tools: Zopfli, PNGOUT, <a href=\"https://crates.rs/crates/oxipng\">OxiPNG</a>, AdvPNG, PNGCrush, <a href=\"https://github.com/tjko/jpegoptim\">JPEGOptim</a>, Jpegtran, <a href=\"https://github.com/google/guetzli\">Guetzli</a>, <a href=\"https://kornel.ski/lossygif\">Gifsicle</a>, <a href=\"https://github.com/svg/svgo\">SVGO</a>, <a href=\"https://github.com/RazrFalcon/svgcleaner\">svgcleaner</a> and <a href=\"https://github.com/mozilla/mozjpeg\">MozJPEG</a>.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew cask <span class=\"token function\">install</span> imageoptim</code></pre></div>\n<h2 id=\"使用\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8\" aria-label=\"使用 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用</h2>\n<p>处理 JPEG 格式还是挺快的。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ imageoptim <span class=\"token string\">'**/*.jpg'</span> <span class=\"token string\">'**/*.jpeg'</span>\ni Running ImageOptim<span class=\"token punctuation\">..</span>.\n✓ coffeetags_tagbar.jpg was: 845kB now: 786kB saving: <span class=\"token number\">58</span>.4kB <span class=\"token punctuation\">(</span><span class=\"token number\">6.91</span>%<span class=\"token punctuation\">)</span>\n✓ compare-shadow-blur.jpg was: <span class=\"token number\">22</span>.4kB now: <span class=\"token number\">22</span>.4kB saving: 0B <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span>%<span class=\"token punctuation\">)</span>\n✓ stack-or-gtfo.jpg was: <span class=\"token number\">98</span>.1kB now: <span class=\"token number\">68</span>.1kB saving: 30kB <span class=\"token punctuation\">(</span><span class=\"token number\">30.59</span>%<span class=\"token punctuation\">)</span>\n✓ truck.jpg was: 449kB now: 401kB saving: <span class=\"token number\">47</span>.7kB <span class=\"token punctuation\">(</span><span class=\"token number\">10.63</span>%<span class=\"token punctuation\">)</span>\n✓ fonts/kosugi-maru-1.jpg was: <span class=\"token number\">22</span>.9kB now: <span class=\"token number\">14</span>.4kB saving: <span class=\"token number\">8</span>.54kB <span class=\"token punctuation\">(</span><span class=\"token number\">37.29</span>%<span class=\"token punctuation\">)</span>\n✓ fonts/noto-sans-jp-1.jpg was: <span class=\"token number\">24</span>.9kB now: <span class=\"token number\">15</span>.8kB saving: <span class=\"token number\">9</span>.17kB <span class=\"token punctuation\">(</span><span class=\"token number\">36.79</span>%<span class=\"token punctuation\">)</span>\n✓ tabs/santa_monica_dream_-_angus_and_julia.jpg was: 263kB now: 189kB saving: <span class=\"token number\">73</span>.4kB <span class=\"token punctuation\">(</span><span class=\"token number\">27.94</span>%<span class=\"token punctuation\">)</span>\n✓ CSS_EX1.jpeg was: 538kB now: 495kB saving: <span class=\"token number\">43</span>.6kB <span class=\"token punctuation\">(</span><span class=\"token number\">8.10</span>%<span class=\"token punctuation\">)</span>\n✓ TOTAL was: <span class=\"token number\">2</span>.26MB now: <span class=\"token number\">1</span>.99MB saving: 271kB <span class=\"token punctuation\">(</span><span class=\"token number\">11.97</span>%<span class=\"token punctuation\">)</span>\n✓ Finished</code></pre></div>\n<p>处理 PNG 时有点慢，可能是因为使用底层的 <a href=\"https://pngquant.org/\">pngquant</a> 时的参数问题，计算量有点大。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">time</span> imageoptim <span class=\"token string\">'**/*.png'</span>\ni Running ImageOptim<span class=\"token punctuation\">..</span>.\n✓ org-mode-code.png was: <span class=\"token number\">36</span>.6kB now: <span class=\"token number\">15</span>.8kB saving: <span class=\"token number\">20</span>.8kB <span class=\"token punctuation\">(</span><span class=\"token number\">56.78</span>%<span class=\"token punctuation\">)</span>\n✓ screenshot.png was: 109kB now: 42kB saving: <span class=\"token number\">67</span>.2kB <span class=\"token punctuation\">(</span><span class=\"token number\">61.55</span>%<span class=\"token punctuation\">)</span>\n✓ vimwiki-code.png was: 34kB now: <span class=\"token number\">14</span>.3kB saving: <span class=\"token number\">19</span>.7kB <span class=\"token punctuation\">(</span><span class=\"token number\">57.90</span>%<span class=\"token punctuation\">)</span>\n✓ TOTAL was: 180kB now: <span class=\"token number\">72</span>.1kB saving: 108kB <span class=\"token punctuation\">(</span><span class=\"token number\">59.89</span>%<span class=\"token punctuation\">)</span>\n✓ Finished\nimageoptim <span class=\"token string\">'**/*.png'</span>  <span class=\"token number\">146</span>.20s user <span class=\"token number\">1</span>.37s system <span class=\"token number\">290</span>% cpu <span class=\"token number\">50.865</span> total</code></pre></div>\n<p>如已经安装了 <a href=\"https://pngmini.com\">ImageAlpha</a> ，加上参数 <code>--imagealpha</code>，先调用 ImageAlpha，处理 PNG 的效率和速度都有很大提升。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">time</span> imageoptim --imagealpha <span class=\"token string\">'**/*.png'</span>\ni Running ImageAlpha<span class=\"token punctuation\">..</span>.\ni Running ImageOptim<span class=\"token punctuation\">..</span>.\n✓ org-mode-code.png was: <span class=\"token number\">36</span>.6kB now: <span class=\"token number\">5</span>.64kB saving: 31kB <span class=\"token punctuation\">(</span><span class=\"token number\">84.60</span>%<span class=\"token punctuation\">)</span>\n✓ screenshot.png was: 109kB now: <span class=\"token number\">15</span>.8kB saving: <span class=\"token number\">93</span>.4kB <span class=\"token punctuation\">(</span><span class=\"token number\">85.56</span>%<span class=\"token punctuation\">)</span>\n✓ vimwiki-code.png was: 34kB now: <span class=\"token number\">4</span>.72kB saving: <span class=\"token number\">29</span>.3kB <span class=\"token punctuation\">(</span><span class=\"token number\">86.11</span>%<span class=\"token punctuation\">)</span>\n✓ TOTAL was: 180kB now: <span class=\"token number\">26</span>.1kB saving: 154kB <span class=\"token punctuation\">(</span><span class=\"token number\">85.47</span>%<span class=\"token punctuation\">)</span>\n✓ Finished\nimageoptim --imagealpha <span class=\"token string\">'**/*.png'</span>  <span class=\"token number\">55</span>.98s user <span class=\"token number\">0</span>.75s system <span class=\"token number\">298</span>% cpu <span class=\"token number\">18.985</span> total</code></pre></div>\n<p>CLI 提供了 <code>--quality</code> 和 <code>--speed</code> 两个细化的调整参数，仔细调整可能有更合适的速度/压缩率组合。</p>\n<p>对于不同工具对不同格式和特性的压缩效果，作者给出了<a href=\"http://jamiemason.github.io/ImageOptim-CLI/\">一份评测数据</a>。</p>","excerpt":"imagemin-cli imagemin/imagemin-cli 是一个用 node.js 写的工具，调用的都是纯 CLI 的开源程序，所以平台兼容性好很多。其依赖的 imagemin 项目支持 imagemin-* 形式的 npm package 插件扩展，cli…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/2019-08-20-Run-Image-Optimize-With-Cli/#imagemin-cli\">imagemin-cli</a></p>\n<ul>\n<li><a href=\"/2019-08-20-Run-Image-Optimize-With-Cli/#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B\">使用示例</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2019-08-20-Run-Image-Optimize-With-Cli/#imageoptim-cli\">ImageOptim-CLI</a></p>\n<ul>\n<li><a href=\"/2019-08-20-Run-Image-Optimize-With-Cli/#%E5%AE%89%E8%A3%85\">安装</a></li>\n<li><a href=\"/2019-08-20-Run-Image-Optimize-With-Cli/#%E4%BD%BF%E7%94%A8\">使用</a></li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/2019-08-20-Run-Image-Optimize-With-Cli/","featureImageSrc":null},"frontmatter":{"title":"命令行下的图片压缩工具","date":"2019-08-20","author":null,"tags":["图片","工具"],"use_toc":true,"coverImage":null}}},"pageContext":{"type":"posts","next":{"fields":{"slug":"/2019-06-17-typescript-powered-vuex/"},"frontmatter":{"title":"使用 Typescript 加强 Vuex 使用体验","tags":["Vuex","Typescript"]},"fileAbsolutePath":"/Users/bytedance/mydemos/gatsby-hello-friend/content/posts/2019-06-17-typescript-powered-vuex.md"},"previous":{"fields":{"slug":"/2019-09-04-Detect-Computer-Resume-From-Sleep-In-Browser/"},"frontmatter":{"title":"在浏览器端检测电脑是否刚从休眠中醒来","tags":["浏览器"]},"fileAbsolutePath":"/Users/bytedance/mydemos/gatsby-hello-friend/content/posts/2019-09-04-Detect-Computer-Resume-From-Sleep-In-Browser.md"},"slug":"/2019-08-20-Run-Image-Optimize-With-Cli/"}},"staticQueryHashes":["1425477374","3128451518"]}